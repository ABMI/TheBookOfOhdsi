<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 11 Building the building blocks: cohorts | The Book of OHDSI</title>
  <meta name="description" content="A book about the Observational Health Data Science and Informatics (OHDS). It described the OHDSI community, open standards and open source software." />
  <meta name="generator" content="bookdown 0.12.1 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 11 Building the building blocks: cohorts | The Book of OHDSI" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://ohdsi.github.io/TheBookOfOhdsi/" />
  <meta property="og:image" content="https://ohdsi.github.io/TheBookOfOhdsi/images/Cover/Cover.png" />
  <meta property="og:description" content="A book about the Observational Health Data Science and Informatics (OHDS). It described the OHDSI community, open standards and open source software." />
  <meta name="github-repo" content="OHDSI/TheBookOfOhdsi" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 11 Building the building blocks: cohorts | The Book of OHDSI" />
  
  <meta name="twitter:description" content="A book about the Observational Health Data Science and Informatics (OHDS). It described the OHDSI community, open standards and open source software." />
  <meta name="twitter:image" content="https://ohdsi.github.io/TheBookOfOhdsi/images/Cover/Cover.png" />

<meta name="author" content="Observational Health Data Science and Informatics" />


<meta name="date" content="2019-08-05" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
<link rel="prev" href="SqlAndR.html"/>
<link rel="next" href="Characterization.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-104086677-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-104086677-2');
</script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">The Book of OHDSI</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#goals-of-this-book"><i class="fa fa-check"></i>Goals of this book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#structure-of-the-book"><i class="fa fa-check"></i>Structure of the book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#contributors"><i class="fa fa-check"></i>Contributors</a></li>
</ul></li>
<li class="part"><span><b>I The OHDSI Community</b></span></li>
<li class="chapter" data-level="1" data-path="MissionVissionValues.html"><a href="MissionVissionValues.html"><i class="fa fa-check"></i><b>1</b> Mission, vision, values</a><ul>
<li class="chapter" data-level="1.1" data-path="MissionVissionValues.html"><a href="MissionVissionValues.html#our-mission"><i class="fa fa-check"></i><b>1.1</b> Our Mission</a></li>
<li class="chapter" data-level="1.2" data-path="MissionVissionValues.html"><a href="MissionVissionValues.html#our-vision"><i class="fa fa-check"></i><b>1.2</b> Our Vision</a></li>
<li class="chapter" data-level="1.3" data-path="MissionVissionValues.html"><a href="MissionVissionValues.html#our-objectives"><i class="fa fa-check"></i><b>1.3</b> Our Objectives</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="Collaborators.html"><a href="Collaborators.html"><i class="fa fa-check"></i><b>2</b> Collaborators</a></li>
<li class="chapter" data-level="3" data-path="OpenScience.html"><a href="OpenScience.html"><i class="fa fa-check"></i><b>3</b> Open Science</a><ul>
<li class="chapter" data-level="3.1" data-path="OpenScience.html"><a href="OpenScience.html#open-science"><i class="fa fa-check"></i><b>3.1</b> Open Science</a></li>
<li class="chapter" data-level="3.2" data-path="OpenScience.html"><a href="OpenScience.html#open-science-in-action-the-study-a-thon"><i class="fa fa-check"></i><b>3.2</b> Open Science in Action: the Study-a-thon</a></li>
<li class="chapter" data-level="3.3" data-path="OpenScience.html"><a href="OpenScience.html#open-standards"><i class="fa fa-check"></i><b>3.3</b> Open Standards</a></li>
<li class="chapter" data-level="3.4" data-path="OpenScience.html"><a href="OpenScience.html#open-source"><i class="fa fa-check"></i><b>3.4</b> Open Source</a></li>
<li class="chapter" data-level="3.5" data-path="OpenScience.html"><a href="OpenScience.html#open-data"><i class="fa fa-check"></i><b>3.5</b> Open Data</a></li>
<li class="chapter" data-level="3.6" data-path="OpenScience.html"><a href="OpenScience.html#open-discourse"><i class="fa fa-check"></i><b>3.6</b> Open Discourse</a></li>
<li class="chapter" data-level="3.7" data-path="OpenScience.html"><a href="OpenScience.html#ohdsi-and-the-fair-guiding-principles"><i class="fa fa-check"></i><b>3.7</b> OHDSI and the FAIR Guiding Principles</a><ul>
<li class="chapter" data-level="3.7.1" data-path="OpenScience.html"><a href="OpenScience.html#findability"><i class="fa fa-check"></i><b>3.7.1</b> Findability</a></li>
<li class="chapter" data-level="3.7.2" data-path="OpenScience.html"><a href="OpenScience.html#accessibility"><i class="fa fa-check"></i><b>3.7.2</b> Accessibility</a></li>
<li class="chapter" data-level="3.7.3" data-path="OpenScience.html"><a href="OpenScience.html#interoperability"><i class="fa fa-check"></i><b>3.7.3</b> Interoperability</a></li>
<li class="chapter" data-level="3.7.4" data-path="OpenScience.html"><a href="OpenScience.html#reusability"><i class="fa fa-check"></i><b>3.7.4</b> Reusability</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="OpenScience.html"><a href="OpenScience.html#conclusions"><i class="fa fa-check"></i><b>3.8</b> Conclusions</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="WhereToBegin.html"><a href="WhereToBegin.html"><i class="fa fa-check"></i><b>4</b> Where to begin</a><ul>
<li class="chapter" data-level="4.1" data-path="WhereToBegin.html"><a href="WhereToBegin.html#joining-the-journey"><i class="fa fa-check"></i><b>4.1</b> Joining the Journey</a><ul>
<li class="chapter" data-level="4.1.1" data-path="WhereToBegin.html"><a href="WhereToBegin.html#ohdsi-community-calls"><i class="fa fa-check"></i><b>4.1.1</b> OHDSI Community Calls</a></li>
<li class="chapter" data-level="4.1.2" data-path="WhereToBegin.html"><a href="WhereToBegin.html#ohdsi-workgroups"><i class="fa fa-check"></i><b>4.1.2</b> OHDSI Workgroups</a></li>
<li class="chapter" data-level="4.1.3" data-path="WhereToBegin.html"><a href="WhereToBegin.html#ohdsi-regional-chapters"><i class="fa fa-check"></i><b>4.1.3</b> OHDSI Regional Chapters</a></li>
<li class="chapter" data-level="4.1.4" data-path="WhereToBegin.html"><a href="WhereToBegin.html#ohdsi-research-network"><i class="fa fa-check"></i><b>4.1.4</b> OHDSI Research Network</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="WhereToBegin.html"><a href="WhereToBegin.html#navigating-your-odyssey-in-ohdsi"><i class="fa fa-check"></i><b>4.2</b> Navigating Your Odyssey in OHDSI</a><ul>
<li class="chapter" data-level="4.2.1" data-path="WhereToBegin.html"><a href="WhereToBegin.html#how-to-translate-your-research-question-into-an-ohdsi-framework"><i class="fa fa-check"></i><b>4.2.1</b> How to Translate Your Research Question into an OHDSI Framework</a></li>
<li class="chapter" data-level="4.2.2" data-path="WhereToBegin.html"><a href="WhereToBegin.html#example-of-a-study-in-ohdsi-speak"><i class="fa fa-check"></i><b>4.2.2</b> Example of a Study in OHDSI-speak</a></li>
<li class="chapter" data-level="4.2.3" data-path="WhereToBegin.html"><a href="WhereToBegin.html#more-real-example-questions"><i class="fa fa-check"></i><b>4.2.3</b> More real example questions</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="WhereToBegin.html"><a href="WhereToBegin.html#summary"><i class="fa fa-check"></i><b>4.3</b> Summary</a></li>
</ul></li>
<li class="part"><span><b>II Uniform Data Representation</b></span></li>
<li class="chapter" data-level="5" data-path="CommonDataModel.html"><a href="CommonDataModel.html"><i class="fa fa-check"></i><b>5</b> The Common Data Model</a><ul>
<li class="chapter" data-level="5.1" data-path="CommonDataModel.html"><a href="CommonDataModel.html#design-principles"><i class="fa fa-check"></i><b>5.1</b> Design Principles</a></li>
<li class="chapter" data-level="5.2" data-path="CommonDataModel.html"><a href="CommonDataModel.html#data-model-conventions"><i class="fa fa-check"></i><b>5.2</b> Data Model Conventions</a><ul>
<li class="chapter" data-level="5.2.1" data-path="CommonDataModel.html"><a href="CommonDataModel.html#model-conv"><i class="fa fa-check"></i><b>5.2.1</b> General conventions of the model</a></li>
<li class="chapter" data-level="5.2.2" data-path="CommonDataModel.html"><a href="CommonDataModel.html#general-conventions-of-schemas"><i class="fa fa-check"></i><b>5.2.2</b> General conventions of schemas</a></li>
<li class="chapter" data-level="5.2.3" data-path="CommonDataModel.html"><a href="CommonDataModel.html#general-conventions-of-data-tables"><i class="fa fa-check"></i><b>5.2.3</b> General conventions of data tables</a></li>
<li class="chapter" data-level="5.2.4" data-path="CommonDataModel.html"><a href="CommonDataModel.html#general-conventions-of-domains"><i class="fa fa-check"></i><b>5.2.4</b> General conventions of domains</a></li>
<li class="chapter" data-level="5.2.5" data-path="CommonDataModel.html"><a href="CommonDataModel.html#general-conventions-of-fields"><i class="fa fa-check"></i><b>5.2.5</b> General conventions of fields</a></li>
<li class="chapter" data-level="5.2.6" data-path="CommonDataModel.html"><a href="CommonDataModel.html#representation-of-content-through-concepts"><i class="fa fa-check"></i><b>5.2.6</b> Representation of content through Concepts</a></li>
<li class="chapter" data-level="5.2.7" data-path="CommonDataModel.html"><a href="CommonDataModel.html#concepts-sources"><i class="fa fa-check"></i><b>5.2.7</b> Difference between Concept IDs and Source Values</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="CommonDataModel.html"><a href="CommonDataModel.html#omop-cdm-standardized-tables"><i class="fa fa-check"></i><b>5.3</b> OMOP CDM Standardized Tables</a><ul>
<li class="chapter" data-level="5.3.1" data-path="CommonDataModel.html"><a href="CommonDataModel.html#running-example-endometriosis"><i class="fa fa-check"></i><b>5.3.1</b> Running Example: Endometriosis</a></li>
<li class="chapter" data-level="5.3.2" data-path="CommonDataModel.html"><a href="CommonDataModel.html#person"><i class="fa fa-check"></i><b>5.3.2</b> PERSON table</a></li>
<li class="chapter" data-level="5.3.3" data-path="CommonDataModel.html"><a href="CommonDataModel.html#observationPeriod"><i class="fa fa-check"></i><b>5.3.3</b> OBSERVATION_PERIOD table</a></li>
<li class="chapter" data-level="5.3.4" data-path="CommonDataModel.html"><a href="CommonDataModel.html#visitOccurrence"><i class="fa fa-check"></i><b>5.3.4</b> VISIT_OCCURRENCE</a></li>
<li class="chapter" data-level="5.3.5" data-path="CommonDataModel.html"><a href="CommonDataModel.html#conditionOccurrence"><i class="fa fa-check"></i><b>5.3.5</b> CONDITION_OCCURRENCE</a></li>
<li class="chapter" data-level="5.3.6" data-path="CommonDataModel.html"><a href="CommonDataModel.html#drugExposure"><i class="fa fa-check"></i><b>5.3.6</b> DRUG_EXPOSURE</a></li>
<li class="chapter" data-level="5.3.7" data-path="CommonDataModel.html"><a href="CommonDataModel.html#procedureOccurrence"><i class="fa fa-check"></i><b>5.3.7</b> PROCEDURE_OCCURRENCE</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="CommonDataModel.html"><a href="CommonDataModel.html#additional-information"><i class="fa fa-check"></i><b>5.4</b> Additional Information</a></li>
<li class="chapter" data-level="5.5" data-path="CommonDataModel.html"><a href="CommonDataModel.html#summary-1"><i class="fa fa-check"></i><b>5.5</b> Summary</a></li>
<li class="chapter" data-level="5.6" data-path="CommonDataModel.html"><a href="CommonDataModel.html#exercises"><i class="fa fa-check"></i><b>5.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html"><i class="fa fa-check"></i><b>6</b> Standardized Vocabularies</a></li>
<li class="chapter" data-level="7" data-path="ExtractTransformLoad.html"><a href="ExtractTransformLoad.html"><i class="fa fa-check"></i><b>7</b> Extract Transform Load</a><ul>
<li class="chapter" data-level="7.1" data-path="ExtractTransformLoad.html"><a href="ExtractTransformLoad.html#introduction"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="ExtractTransformLoad.html"><a href="ExtractTransformLoad.html#etl-step-1---data-experts-and-cdm-experts-together-design-the-etl"><i class="fa fa-check"></i><b>7.2</b> ETL Step 1 - Data experts and CDM experts together design the ETL</a><ul>
<li class="chapter" data-level="7.2.1" data-path="ExtractTransformLoad.html"><a href="ExtractTransformLoad.html#white-rabbit"><i class="fa fa-check"></i><b>7.2.1</b> White Rabbit</a></li>
<li class="chapter" data-level="7.2.2" data-path="ExtractTransformLoad.html"><a href="ExtractTransformLoad.html#rabbit-in-a-hat"><i class="fa fa-check"></i><b>7.2.2</b> Rabbit-In-a-Hat</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="ExtractTransformLoad.html"><a href="ExtractTransformLoad.html#etl-step-2---people-with-medical-knowledge-create-the-code-mappings"><i class="fa fa-check"></i><b>7.3</b> ETL Step 2 - People with medical knowledge create the code mappings</a></li>
<li class="chapter" data-level="7.4" data-path="ExtractTransformLoad.html"><a href="ExtractTransformLoad.html#etl-step-3---a-technical-person-implements-the-etl"><i class="fa fa-check"></i><b>7.4</b> ETL Step 3 - A technical person implements the ETL</a></li>
<li class="chapter" data-level="7.5" data-path="ExtractTransformLoad.html"><a href="ExtractTransformLoad.html#etl-step-4---all-are-involved-in-quality-control"><i class="fa fa-check"></i><b>7.5</b> ETL Step 4 - All are involved in quality control</a></li>
<li class="chapter" data-level="7.6" data-path="ExtractTransformLoad.html"><a href="ExtractTransformLoad.html#final-thoughts-on-etl"><i class="fa fa-check"></i><b>7.6</b> Final thoughts on ETL</a></li>
<li class="chapter" data-level="7.7" data-path="ExtractTransformLoad.html"><a href="ExtractTransformLoad.html#summary-2"><i class="fa fa-check"></i><b>7.7</b> Summary</a></li>
</ul></li>
<li class="part"><span><b>III Data Analytics</b></span></li>
<li class="chapter" data-level="8" data-path="DataAnalyticsUseCases.html"><a href="DataAnalyticsUseCases.html"><i class="fa fa-check"></i><b>8</b> Data Analytics Use Cases</a><ul>
<li class="chapter" data-level="8.1" data-path="DataAnalyticsUseCases.html"><a href="DataAnalyticsUseCases.html#characterization"><i class="fa fa-check"></i><b>8.1</b> Characterization</a></li>
<li class="chapter" data-level="8.2" data-path="DataAnalyticsUseCases.html"><a href="DataAnalyticsUseCases.html#population-level-estimation"><i class="fa fa-check"></i><b>8.2</b> Population-level estimation</a></li>
<li class="chapter" data-level="8.3" data-path="DataAnalyticsUseCases.html"><a href="DataAnalyticsUseCases.html#patient-level-prediction"><i class="fa fa-check"></i><b>8.3</b> Patient-Level prediction</a></li>
<li class="chapter" data-level="8.4" data-path="DataAnalyticsUseCases.html"><a href="DataAnalyticsUseCases.html#limitations-of-observational-research"><i class="fa fa-check"></i><b>8.4</b> Limitations of observational research</a><ul>
<li class="chapter" data-level="8.4.1" data-path="DataAnalyticsUseCases.html"><a href="DataAnalyticsUseCases.html#missing-data"><i class="fa fa-check"></i><b>8.4.1</b> Missing data</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="DataAnalyticsUseCases.html"><a href="DataAnalyticsUseCases.html#summary-3"><i class="fa fa-check"></i><b>8.5</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html"><i class="fa fa-check"></i><b>9</b> OHDSI Analytics Tools</a><ul>
<li class="chapter" data-level="9.1" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#analysisImplementation"><i class="fa fa-check"></i><b>9.1</b> Analysis implementation</a></li>
<li class="chapter" data-level="9.2" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#analysis-strategy"><i class="fa fa-check"></i><b>9.2</b> Analysis strategy</a></li>
<li class="chapter" data-level="9.3" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#atlas"><i class="fa fa-check"></i><b>9.3</b> ATLAS</a><ul>
<li class="chapter" data-level="9.3.1" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#security"><i class="fa fa-check"></i><b>9.3.1</b> Security</a></li>
<li class="chapter" data-level="9.3.2" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#documentation"><i class="fa fa-check"></i><b>9.3.2</b> Documentation</a></li>
<li class="chapter" data-level="9.3.3" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#how-to-install"><i class="fa fa-check"></i><b>9.3.3</b> How to install</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#methods-library"><i class="fa fa-check"></i><b>9.4</b> Methods Library</a><ul>
<li class="chapter" data-level="9.4.1" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#support-for-large-scale-analytics"><i class="fa fa-check"></i><b>9.4.1</b> Support for large-scale analytics</a></li>
<li class="chapter" data-level="9.4.2" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#BigDataSupport"><i class="fa fa-check"></i><b>9.4.2</b> Support for big data</a></li>
<li class="chapter" data-level="9.4.3" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#documentation-1"><i class="fa fa-check"></i><b>9.4.3</b> Documentation</a></li>
<li class="chapter" data-level="9.4.4" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#system-requirements"><i class="fa fa-check"></i><b>9.4.4</b> System requirements</a></li>
<li class="chapter" data-level="9.4.5" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#installR"><i class="fa fa-check"></i><b>9.4.5</b> How to install</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#deployment-strategies"><i class="fa fa-check"></i><b>9.5</b> Deployment strategies</a><ul>
<li class="chapter" data-level="9.5.1" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#broadsea"><i class="fa fa-check"></i><b>9.5.1</b> Broadsea</a></li>
<li class="chapter" data-level="9.5.2" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#amazon-aws"><i class="fa fa-check"></i><b>9.5.2</b> Amazon AWS</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#summary-4"><i class="fa fa-check"></i><b>9.6</b> Summary</a></li>
<li class="chapter" data-level="9.7" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#exercises-1"><i class="fa fa-check"></i><b>9.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="SqlAndR.html"><a href="SqlAndR.html"><i class="fa fa-check"></i><b>10</b> SQL and R</a><ul>
<li class="chapter" data-level="10.1" data-path="SqlAndR.html"><a href="SqlAndR.html#SqlRender"><i class="fa fa-check"></i><b>10.1</b> SqlRender</a><ul>
<li class="chapter" data-level="10.1.1" data-path="SqlAndR.html"><a href="SqlAndR.html#sql-parameterization"><i class="fa fa-check"></i><b>10.1.1</b> SQL parameterization</a></li>
<li class="chapter" data-level="10.1.2" data-path="SqlAndR.html"><a href="SqlAndR.html#translation-to-other-sql-dialects"><i class="fa fa-check"></i><b>10.1.2</b> Translation to other SQL dialects</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="SqlAndR.html"><a href="SqlAndR.html#DatabaseConnector"><i class="fa fa-check"></i><b>10.2</b> DatabaseConnector</a><ul>
<li class="chapter" data-level="10.2.1" data-path="SqlAndR.html"><a href="SqlAndR.html#creating-a-connection"><i class="fa fa-check"></i><b>10.2.1</b> Creating a connection</a></li>
<li class="chapter" data-level="10.2.2" data-path="SqlAndR.html"><a href="SqlAndR.html#querying"><i class="fa fa-check"></i><b>10.2.2</b> Querying</a></li>
<li class="chapter" data-level="10.2.3" data-path="SqlAndR.html"><a href="SqlAndR.html#querying-using-ffdf-objects"><i class="fa fa-check"></i><b>10.2.3</b> Querying using ffdf objects</a></li>
<li class="chapter" data-level="10.2.4" data-path="SqlAndR.html"><a href="SqlAndR.html#querying-different-platforms-using-the-same-sql"><i class="fa fa-check"></i><b>10.2.4</b> Querying different platforms using the same SQL</a></li>
<li class="chapter" data-level="10.2.5" data-path="SqlAndR.html"><a href="SqlAndR.html#inserting-tables"><i class="fa fa-check"></i><b>10.2.5</b> Inserting tables</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="SqlAndR.html"><a href="SqlAndR.html#QueryTheCdm"><i class="fa fa-check"></i><b>10.3</b> Querying the CDM</a></li>
<li class="chapter" data-level="10.4" data-path="SqlAndR.html"><a href="SqlAndR.html#using-the-vocabulary-when-querying"><i class="fa fa-check"></i><b>10.4</b> Using the vocabulary when querying</a></li>
<li class="chapter" data-level="10.5" data-path="SqlAndR.html"><a href="SqlAndR.html#querylibrary"><i class="fa fa-check"></i><b>10.5</b> QueryLibrary</a></li>
<li class="chapter" data-level="10.6" data-path="SqlAndR.html"><a href="SqlAndR.html#designing-a-simple-study"><i class="fa fa-check"></i><b>10.6</b> Designing a simple study</a><ul>
<li class="chapter" data-level="10.6.1" data-path="SqlAndR.html"><a href="SqlAndR.html#problem-definition"><i class="fa fa-check"></i><b>10.6.1</b> Problem definition</a></li>
<li class="chapter" data-level="10.6.2" data-path="SqlAndR.html"><a href="SqlAndR.html#exposure"><i class="fa fa-check"></i><b>10.6.2</b> Exposure</a></li>
<li class="chapter" data-level="10.6.3" data-path="SqlAndR.html"><a href="SqlAndR.html#outcome"><i class="fa fa-check"></i><b>10.6.3</b> Outcome</a></li>
<li class="chapter" data-level="10.6.4" data-path="SqlAndR.html"><a href="SqlAndR.html#time-at-risk"><i class="fa fa-check"></i><b>10.6.4</b> Time-at-risk</a></li>
</ul></li>
<li class="chapter" data-level="10.7" data-path="SqlAndR.html"><a href="SqlAndR.html#implementing-the-study-using-sql-and-r"><i class="fa fa-check"></i><b>10.7</b> Implementing the study using SQL and R</a><ul>
<li class="chapter" data-level="10.7.1" data-path="SqlAndR.html"><a href="SqlAndR.html#exposure-cohort"><i class="fa fa-check"></i><b>10.7.1</b> Exposure cohort</a></li>
<li class="chapter" data-level="10.7.2" data-path="SqlAndR.html"><a href="SqlAndR.html#outcome-cohort"><i class="fa fa-check"></i><b>10.7.2</b> Outcome cohort</a></li>
<li class="chapter" data-level="10.7.3" data-path="SqlAndR.html"><a href="SqlAndR.html#incidence-rate-calculation"><i class="fa fa-check"></i><b>10.7.3</b> Incidence rate calculation</a></li>
<li class="chapter" data-level="10.7.4" data-path="SqlAndR.html"><a href="SqlAndR.html#clean-up"><i class="fa fa-check"></i><b>10.7.4</b> Clean up</a></li>
<li class="chapter" data-level="10.7.5" data-path="SqlAndR.html"><a href="SqlAndR.html#compatibility"><i class="fa fa-check"></i><b>10.7.5</b> Compatibility</a></li>
</ul></li>
<li class="chapter" data-level="10.8" data-path="SqlAndR.html"><a href="SqlAndR.html#summary-5"><i class="fa fa-check"></i><b>10.8</b> Summary</a></li>
<li class="chapter" data-level="10.9" data-path="SqlAndR.html"><a href="SqlAndR.html#exercises-2"><i class="fa fa-check"></i><b>10.9</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="Cohorts.html"><a href="Cohorts.html"><i class="fa fa-check"></i><b>11</b> Building the building blocks: cohorts</a><ul>
<li class="chapter" data-level="11.1" data-path="Cohorts.html"><a href="Cohorts.html#theory"><i class="fa fa-check"></i><b>11.1</b> Theory</a><ul>
<li class="chapter" data-level="11.1.1" data-path="Cohorts.html"><a href="Cohorts.html#rules-based-cohort-design"><i class="fa fa-check"></i><b>11.1.1</b> Rules-based cohort design</a></li>
<li class="chapter" data-level="11.1.2" data-path="Cohorts.html"><a href="Cohorts.html#probabilistic-cohort-design-using-aphrodite"><i class="fa fa-check"></i><b>11.1.2</b> Probabilistic cohort design using APHRODITE</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="Cohorts.html"><a href="Cohorts.html#phenotype-evaluation"><i class="fa fa-check"></i><b>11.2</b> Phenotype Evaluation</a></li>
<li class="chapter" data-level="11.3" data-path="Cohorts.html"><a href="Cohorts.html#ohdsi-gold-standard-phenotype-library"><i class="fa fa-check"></i><b>11.3</b> OHDSI Gold Standard Phenotype Library</a></li>
<li class="chapter" data-level="11.4" data-path="Cohorts.html"><a href="Cohorts.html#practice"><i class="fa fa-check"></i><b>11.4</b> Practice</a><ul>
<li class="chapter" data-level="11.4.1" data-path="Cohorts.html"><a href="Cohorts.html#using-atlas"><i class="fa fa-check"></i><b>11.4.1</b> Using ATLAS</a></li>
<li class="chapter" data-level="11.4.2" data-path="Cohorts.html"><a href="Cohorts.html#using-sql"><i class="fa fa-check"></i><b>11.4.2</b> Using SQL</a></li>
<li class="chapter" data-level="11.4.3" data-path="Cohorts.html"><a href="Cohorts.html#exercises-3"><i class="fa fa-check"></i><b>11.4.3</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="Characterization.html"><a href="Characterization.html"><i class="fa fa-check"></i><b>12</b> Characterization</a><ul>
<li class="chapter" data-level="12.1" data-path="Characterization.html"><a href="Characterization.html#database-level-characterization"><i class="fa fa-check"></i><b>12.1</b> Database Level Characterization</a></li>
<li class="chapter" data-level="12.2" data-path="Characterization.html"><a href="Characterization.html#cohort-characterization"><i class="fa fa-check"></i><b>12.2</b> Cohort characterization</a></li>
<li class="chapter" data-level="12.3" data-path="Characterization.html"><a href="Characterization.html#treatment-pathways"><i class="fa fa-check"></i><b>12.3</b> Treatment Pathways</a></li>
<li class="chapter" data-level="12.4" data-path="Characterization.html"><a href="Characterization.html#incidence"><i class="fa fa-check"></i><b>12.4</b> Incidence</a></li>
<li class="chapter" data-level="12.5" data-path="Characterization.html"><a href="Characterization.html#characterizing-hypertensive-persons"><i class="fa fa-check"></i><b>12.5</b> Characterizing hypertensive persons</a></li>
<li class="chapter" data-level="12.6" data-path="Characterization.html"><a href="Characterization.html#database-characterization-in-atlas"><i class="fa fa-check"></i><b>12.6</b> Database characterization in ATLAS</a></li>
<li class="chapter" data-level="12.7" data-path="Characterization.html"><a href="Characterization.html#cohort-characterization-in-atlas"><i class="fa fa-check"></i><b>12.7</b> Cohort characterization in ATLAS</a><ul>
<li class="chapter" data-level="12.7.1" data-path="Characterization.html"><a href="Characterization.html#design"><i class="fa fa-check"></i><b>12.7.1</b> Design</a></li>
<li class="chapter" data-level="12.7.2" data-path="Characterization.html"><a href="Characterization.html#executions"><i class="fa fa-check"></i><b>12.7.2</b> Executions</a></li>
<li class="chapter" data-level="12.7.3" data-path="Characterization.html"><a href="Characterization.html#results"><i class="fa fa-check"></i><b>12.7.3</b> Results</a></li>
<li class="chapter" data-level="12.7.4" data-path="Characterization.html"><a href="Characterization.html#defining-custom-features"><i class="fa fa-check"></i><b>12.7.4</b> Defining custom features</a></li>
</ul></li>
<li class="chapter" data-level="12.8" data-path="Characterization.html"><a href="Characterization.html#cohort-characterization-in-r"><i class="fa fa-check"></i><b>12.8</b> Cohort characterization in R</a><ul>
<li class="chapter" data-level="12.8.1" data-path="Characterization.html"><a href="Characterization.html#cohort-instantiation"><i class="fa fa-check"></i><b>12.8.1</b> Cohort instantiation</a></li>
<li class="chapter" data-level="12.8.2" data-path="Characterization.html"><a href="Characterization.html#data-extraction"><i class="fa fa-check"></i><b>12.8.2</b> Data extraction</a></li>
<li class="chapter" data-level="12.8.3" data-path="Characterization.html"><a href="Characterization.html#using-prespecified-analyses"><i class="fa fa-check"></i><b>12.8.3</b> Using prespecified analyses</a></li>
<li class="chapter" data-level="12.8.4" data-path="Characterization.html"><a href="Characterization.html#creating-aggregated-covariates"><i class="fa fa-check"></i><b>12.8.4</b> Creating aggregated covariates</a></li>
<li class="chapter" data-level="12.8.5" data-path="Characterization.html"><a href="Characterization.html#output-format"><i class="fa fa-check"></i><b>12.8.5</b> Output format</a></li>
<li class="chapter" data-level="12.8.6" data-path="Characterization.html"><a href="Characterization.html#custom-covariates"><i class="fa fa-check"></i><b>12.8.6</b> Custom covariates</a></li>
</ul></li>
<li class="chapter" data-level="12.9" data-path="Characterization.html"><a href="Characterization.html#cohort-pathways-in-atlas"><i class="fa fa-check"></i><b>12.9</b> Cohort pathways in ATLAS</a><ul>
<li class="chapter" data-level="12.9.1" data-path="Characterization.html"><a href="Characterization.html#design-1"><i class="fa fa-check"></i><b>12.9.1</b> Design</a></li>
<li class="chapter" data-level="12.9.2" data-path="Characterization.html"><a href="Characterization.html#executions-1"><i class="fa fa-check"></i><b>12.9.2</b> Executions</a></li>
<li class="chapter" data-level="12.9.3" data-path="Characterization.html"><a href="Characterization.html#viewing-results"><i class="fa fa-check"></i><b>12.9.3</b> Viewing Results</a></li>
</ul></li>
<li class="chapter" data-level="12.10" data-path="Characterization.html"><a href="Characterization.html#incidence-analysis-in-atlas"><i class="fa fa-check"></i><b>12.10</b> Incidence analysis in ATLAS</a><ul>
<li class="chapter" data-level="12.10.1" data-path="Characterization.html"><a href="Characterization.html#design-2"><i class="fa fa-check"></i><b>12.10.1</b> Design</a></li>
<li class="chapter" data-level="12.10.2" data-path="Characterization.html"><a href="Characterization.html#executions-2"><i class="fa fa-check"></i><b>12.10.2</b> Executions</a></li>
<li class="chapter" data-level="12.10.3" data-path="Characterization.html"><a href="Characterization.html#viewing-results-1"><i class="fa fa-check"></i><b>12.10.3</b> Viewing Results</a></li>
</ul></li>
<li class="chapter" data-level="12.11" data-path="Characterization.html"><a href="Characterization.html#summary-6"><i class="fa fa-check"></i><b>12.11</b> Summary</a></li>
<li class="chapter" data-level="12.12" data-path="Characterization.html"><a href="Characterization.html#exercises-4"><i class="fa fa-check"></i><b>12.12</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html"><i class="fa fa-check"></i><b>13</b> Population-level estimation</a><ul>
<li class="chapter" data-level="13.1" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#CohortMethod"><i class="fa fa-check"></i><b>13.1</b> The cohort method design</a><ul>
<li class="chapter" data-level="13.1.1" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#propensity-scores"><i class="fa fa-check"></i><b>13.1.1</b> Propensity scores</a></li>
<li class="chapter" data-level="13.1.2" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#VariableSelection"><i class="fa fa-check"></i><b>13.1.2</b> Variable selection</a></li>
<li class="chapter" data-level="13.1.3" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#caliper"><i class="fa fa-check"></i><b>13.1.3</b> Caliper</a></li>
<li class="chapter" data-level="13.1.4" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#overlap-preference-scores"><i class="fa fa-check"></i><b>13.1.4</b> Overlap: preference scores</a></li>
<li class="chapter" data-level="13.1.5" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#balance"><i class="fa fa-check"></i><b>13.1.5</b> Balance</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#the-self-controlled-cohort-design"><i class="fa fa-check"></i><b>13.2</b> The self-controlled cohort design</a></li>
<li class="chapter" data-level="13.3" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#the-case-control-design"><i class="fa fa-check"></i><b>13.3</b> The case-control design</a></li>
<li class="chapter" data-level="13.4" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#the-case-crossover-design"><i class="fa fa-check"></i><b>13.4</b> The case-crossover design</a></li>
<li class="chapter" data-level="13.5" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#the-self-controlled-case-series-design"><i class="fa fa-check"></i><b>13.5</b> The self-controlled case series design</a></li>
<li class="chapter" data-level="13.6" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#designing-a-hypertension-study"><i class="fa fa-check"></i><b>13.6</b> Designing a hypertension study</a><ul>
<li class="chapter" data-level="13.6.1" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#problem-definition-1"><i class="fa fa-check"></i><b>13.6.1</b> Problem definition</a></li>
<li class="chapter" data-level="13.6.2" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#target-and-comparator"><i class="fa fa-check"></i><b>13.6.2</b> Target and comparator</a></li>
<li class="chapter" data-level="13.6.3" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#outcome-1"><i class="fa fa-check"></i><b>13.6.3</b> Outcome</a></li>
<li class="chapter" data-level="13.6.4" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#time-at-risk-1"><i class="fa fa-check"></i><b>13.6.4</b> Time-at-risk</a></li>
<li class="chapter" data-level="13.6.5" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#model"><i class="fa fa-check"></i><b>13.6.5</b> Model</a></li>
<li class="chapter" data-level="13.6.6" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#study-summary"><i class="fa fa-check"></i><b>13.6.6</b> Study summary</a></li>
<li class="chapter" data-level="13.6.7" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#control-questions"><i class="fa fa-check"></i><b>13.6.7</b> Control questions</a></li>
</ul></li>
<li class="chapter" data-level="13.7" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#PleAtlas"><i class="fa fa-check"></i><b>13.7</b> Implementing the study using ATLAS</a><ul>
<li class="chapter" data-level="13.7.1" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#ComparisonSettings"><i class="fa fa-check"></i><b>13.7.1</b> Comparative cohort settings</a></li>
<li class="chapter" data-level="13.7.2" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#effect-estimation-analysis-settings"><i class="fa fa-check"></i><b>13.7.2</b> Effect estimation analysis settings</a></li>
<li class="chapter" data-level="13.7.3" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#evaluationSettings"><i class="fa fa-check"></i><b>13.7.3</b> Evaluation settings</a></li>
<li class="chapter" data-level="13.7.4" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#running-the-study-package"><i class="fa fa-check"></i><b>13.7.4</b> Running the study package</a></li>
</ul></li>
<li class="chapter" data-level="13.8" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#pleR"><i class="fa fa-check"></i><b>13.8</b> Implementing the study using R</a><ul>
<li class="chapter" data-level="13.8.1" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#cohort-instantiation-1"><i class="fa fa-check"></i><b>13.8.1</b> Cohort instantiation</a></li>
<li class="chapter" data-level="13.8.2" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#data-extraction-1"><i class="fa fa-check"></i><b>13.8.2</b> Data extraction</a></li>
<li class="chapter" data-level="13.8.3" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#defining-the-study-population"><i class="fa fa-check"></i><b>13.8.3</b> Defining the study population</a></li>
<li class="chapter" data-level="13.8.4" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#propensity-scores-1"><i class="fa fa-check"></i><b>13.8.4</b> Propensity scores</a></li>
<li class="chapter" data-level="13.8.5" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#outcome-models"><i class="fa fa-check"></i><b>13.8.5</b> Outcome models</a></li>
<li class="chapter" data-level="13.8.6" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#MultipleAnalyses"><i class="fa fa-check"></i><b>13.8.6</b> Running multiple analyses</a></li>
</ul></li>
<li class="chapter" data-level="13.9" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#studyOutputs"><i class="fa fa-check"></i><b>13.9</b> Study outputs</a><ul>
<li class="chapter" data-level="13.9.1" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#propensity-scores-and-model"><i class="fa fa-check"></i><b>13.9.1</b> Propensity scores and model</a></li>
<li class="chapter" data-level="13.9.2" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#covariate-balance"><i class="fa fa-check"></i><b>13.9.2</b> Covariate balance</a></li>
<li class="chapter" data-level="13.9.3" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#follow-up-and-power"><i class="fa fa-check"></i><b>13.9.3</b> Follow up and power</a></li>
<li class="chapter" data-level="13.9.4" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#kaplan-meier"><i class="fa fa-check"></i><b>13.9.4</b> Kaplan-Meier</a></li>
<li class="chapter" data-level="13.9.5" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#effect-size-estimate"><i class="fa fa-check"></i><b>13.9.5</b> Effect size estimate</a></li>
</ul></li>
<li class="chapter" data-level="13.10" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#summary-7"><i class="fa fa-check"></i><b>13.10</b> Summary</a></li>
<li class="chapter" data-level="13.11" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#excercises"><i class="fa fa-check"></i><b>13.11</b> Excercises</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html"><i class="fa fa-check"></i><b>14</b> Patient Level Prediction</a><ul>
<li class="chapter" data-level="14.1" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#the-prediction-problem"><i class="fa fa-check"></i><b>14.1</b> The prediction problem</a></li>
<li class="chapter" data-level="14.2" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#data-extraction-2"><i class="fa fa-check"></i><b>14.2</b> Data extraction</a><ul>
<li class="chapter" data-level="14.2.1" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#data-extraction-example"><i class="fa fa-check"></i><b>14.2.1</b> Data extraction example</a></li>
<li class="chapter" data-level="14.2.2" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#missingness"><i class="fa fa-check"></i><b>14.2.2</b> Missingness</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#modelFitting"><i class="fa fa-check"></i><b>14.3</b> Fitting the model</a><ul>
<li class="chapter" data-level="14.3.1" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#regularized-logistic-regression"><i class="fa fa-check"></i><b>14.3.1</b> Regularized logistic regression</a></li>
<li class="chapter" data-level="14.3.2" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#gradient-boosting-machines"><i class="fa fa-check"></i><b>14.3.2</b> Gradient boosting machines</a></li>
<li class="chapter" data-level="14.3.3" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#random-forest"><i class="fa fa-check"></i><b>14.3.3</b> Random forest</a></li>
<li class="chapter" data-level="14.3.4" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#k-nearest-neighbors"><i class="fa fa-check"></i><b>14.3.4</b> K-nearest neighbors</a></li>
<li class="chapter" data-level="14.3.5" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#naive-bayes"><i class="fa fa-check"></i><b>14.3.5</b> Naive Bayes</a></li>
<li class="chapter" data-level="14.3.6" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#adaboost"><i class="fa fa-check"></i><b>14.3.6</b> AdaBoost</a></li>
<li class="chapter" data-level="14.3.7" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#decision-tree"><i class="fa fa-check"></i><b>14.3.7</b> Decision Tree</a></li>
<li class="chapter" data-level="14.3.8" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#multilayer-perceptron"><i class="fa fa-check"></i><b>14.3.8</b> Multilayer Perceptron</a></li>
<li class="chapter" data-level="14.3.9" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#deep-learning"><i class="fa fa-check"></i><b>14.3.9</b> Deep Learning</a></li>
<li class="chapter" data-level="14.3.10" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#other-algorithms"><i class="fa fa-check"></i><b>14.3.10</b> Other algorithms</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#evaluating-prediction-models"><i class="fa fa-check"></i><b>14.4</b> Evaluating prediction models</a><ul>
<li class="chapter" data-level="14.4.1" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#evaluation-types"><i class="fa fa-check"></i><b>14.4.1</b> Evaluation Types</a></li>
<li class="chapter" data-level="14.4.2" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#performance"><i class="fa fa-check"></i><b>14.4.2</b> Performance Metrics</a></li>
</ul></li>
<li class="chapter" data-level="14.5" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#designing-a-patient-level-prediction-study"><i class="fa fa-check"></i><b>14.5</b> Designing a patient-level prediction Study</a><ul>
<li class="chapter" data-level="14.5.1" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#problem-definition-2"><i class="fa fa-check"></i><b>14.5.1</b> Problem definition</a></li>
<li class="chapter" data-level="14.5.2" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#study-population-definition"><i class="fa fa-check"></i><b>14.5.2</b> Study population definition</a></li>
<li class="chapter" data-level="14.5.3" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#model-development-settings"><i class="fa fa-check"></i><b>14.5.3</b> Model development settings</a></li>
<li class="chapter" data-level="14.5.4" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#model-evaluation"><i class="fa fa-check"></i><b>14.5.4</b> Model evaluation</a></li>
<li class="chapter" data-level="14.5.5" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#study-summary-1"><i class="fa fa-check"></i><b>14.5.5</b> Study summary</a></li>
</ul></li>
<li class="chapter" data-level="14.6" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#implementing-the-study-in-atlas"><i class="fa fa-check"></i><b>14.6</b> Implementing the study in ATLAS</a><ul>
<li class="chapter" data-level="14.6.1" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#prediction-problem-settings"><i class="fa fa-check"></i><b>14.6.1</b> Prediction Problem Settings</a></li>
<li class="chapter" data-level="14.6.2" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#analysis-settings"><i class="fa fa-check"></i><b>14.6.2</b> Analysis Settings</a></li>
<li class="chapter" data-level="14.6.3" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#execution-settings"><i class="fa fa-check"></i><b>14.6.3</b> Execution settings</a></li>
<li class="chapter" data-level="14.6.4" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#training-settings"><i class="fa fa-check"></i><b>14.6.4</b> Training settings</a></li>
<li class="chapter" data-level="14.6.5" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#importing-and-exporting-a-study"><i class="fa fa-check"></i><b>14.6.5</b> Importing and exporting a study</a></li>
<li class="chapter" data-level="14.6.6" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#downloading-the-study-package"><i class="fa fa-check"></i><b>14.6.6</b> Downloading the study package</a></li>
<li class="chapter" data-level="14.6.7" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#running-the-study"><i class="fa fa-check"></i><b>14.6.7</b> Running the study</a></li>
</ul></li>
<li class="chapter" data-level="14.7" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#implementing-the-study-in-r"><i class="fa fa-check"></i><b>14.7</b> Implementing the study in R</a><ul>
<li class="chapter" data-level="14.7.1" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#cohort-instantiation-2"><i class="fa fa-check"></i><b>14.7.1</b> Cohort instantiation</a></li>
<li class="chapter" data-level="14.7.2" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#data-extraction-3"><i class="fa fa-check"></i><b>14.7.2</b> Data extraction</a></li>
<li class="chapter" data-level="14.7.3" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#additional-inclusion-criteria"><i class="fa fa-check"></i><b>14.7.3</b> Additional inclusion criteria</a></li>
<li class="chapter" data-level="14.7.4" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#model-development"><i class="fa fa-check"></i><b>14.7.4</b> Model Development</a></li>
<li class="chapter" data-level="14.7.5" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#internal-validation"><i class="fa fa-check"></i><b>14.7.5</b> Internal Validation</a></li>
</ul></li>
<li class="chapter" data-level="14.8" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#single-model-viewer-app"><i class="fa fa-check"></i><b>14.8</b> Single model viewer app</a></li>
<li class="chapter" data-level="14.9" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#multiple-model-viewer-app"><i class="fa fa-check"></i><b>14.9</b> Multiple model viewer app</a><ul>
<li class="chapter" data-level="14.9.1" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#viewing-the-model-summary-and-settings"><i class="fa fa-check"></i><b>14.9.1</b> Viewing the model summary and settings</a></li>
<li class="chapter" data-level="14.9.2" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#viewing-model-performance"><i class="fa fa-check"></i><b>14.9.2</b> Viewing model performance</a></li>
<li class="chapter" data-level="14.9.3" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#viewing-the-model"><i class="fa fa-check"></i><b>14.9.3</b> Viewing the model</a></li>
</ul></li>
<li class="chapter" data-level="14.10" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#additional-patient-level-prediction-features"><i class="fa fa-check"></i><b>14.10</b> Additional Patient-level Prediction Features</a><ul>
<li class="chapter" data-level="14.10.1" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#journal-paper-generation"><i class="fa fa-check"></i><b>14.10.1</b> Journal paper generation</a></li>
</ul></li>
<li class="chapter" data-level="14.11" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#summary-8"><i class="fa fa-check"></i><b>14.11</b> Summary</a></li>
<li class="chapter" data-level="14.12" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#excercises-1"><i class="fa fa-check"></i><b>14.12</b> Excercises</a></li>
</ul></li>
<li class="part"><span><b>IV Evidence Quality</b></span></li>
<li class="chapter" data-level="15" data-path="EvidenceQuality.html"><a href="EvidenceQuality.html"><i class="fa fa-check"></i><b>15</b> Evidence Quality</a><ul>
<li class="chapter" data-level="15.1" data-path="EvidenceQuality.html"><a href="EvidenceQuality.html#understanding-evidence-quality"><i class="fa fa-check"></i><b>15.1</b> Understanding Evidence Quality</a></li>
<li class="chapter" data-level="15.2" data-path="EvidenceQuality.html"><a href="EvidenceQuality.html#communicating-evidence-quality"><i class="fa fa-check"></i><b>15.2</b> Communicating Evidence Quality</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="DataQuality.html"><a href="DataQuality.html"><i class="fa fa-check"></i><b>16</b> Data Quality</a><ul>
<li class="chapter" data-level="16.1" data-path="DataQuality.html"><a href="DataQuality.html#introduction-1"><i class="fa fa-check"></i><b>16.1</b> Introduction</a></li>
<li class="chapter" data-level="16.2" data-path="DataQuality.html"><a href="DataQuality.html#achilles-heel-tool"><i class="fa fa-check"></i><b>16.2</b> Achilles Heel tool</a><ul>
<li class="chapter" data-level="16.2.1" data-path="DataQuality.html"><a href="DataQuality.html#precomputed-analyses"><i class="fa fa-check"></i><b>16.2.1</b> Precomputed Analyses</a></li>
<li class="chapter" data-level="16.2.2" data-path="DataQuality.html"><a href="DataQuality.html#example-dq-check"><i class="fa fa-check"></i><b>16.2.2</b> Example DQ check</a></li>
<li class="chapter" data-level="16.2.3" data-path="DataQuality.html"><a href="DataQuality.html#overview-of-existing-dq-heel-checks"><i class="fa fa-check"></i><b>16.2.3</b> Overview of existing DQ Heel checks</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="DataQuality.html"><a href="DataQuality.html#study-specific-checks"><i class="fa fa-check"></i><b>16.3</b> Study-specific checks</a><ul>
<li class="chapter" data-level="16.3.1" data-path="DataQuality.html"><a href="DataQuality.html#outcomes"><i class="fa fa-check"></i><b>16.3.1</b> Outcomes</a></li>
<li class="chapter" data-level="16.3.2" data-path="DataQuality.html"><a href="DataQuality.html#laboratory-data"><i class="fa fa-check"></i><b>16.3.2</b> Laboratory data</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="DataQuality.html"><a href="DataQuality.html#etl-unit-testing"><i class="fa fa-check"></i><b>16.4</b> ETL unit testing</a><ul>
<li class="chapter" data-level="16.4.1" data-path="DataQuality.html"><a href="DataQuality.html#unit-testing-framwork-in-rabbit-in-a-hat"><i class="fa fa-check"></i><b>16.4.1</b> Unit testing framwork in Rabbit-in-a-Hat</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="ClinicalValidity.html"><a href="ClinicalValidity.html"><i class="fa fa-check"></i><b>17</b> Clinical Validity</a></li>
<li class="chapter" data-level="18" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html"><i class="fa fa-check"></i><b>18</b> Software Validity</a><ul>
<li class="chapter" data-level="18.1" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#study-code-validity"><i class="fa fa-check"></i><b>18.1</b> Study code validity</a><ul>
<li class="chapter" data-level="18.1.1" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#automation"><i class="fa fa-check"></i><b>18.1.1</b> Automation as a requirement for reproducibility</a></li>
<li class="chapter" data-level="18.1.2" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#programming-best-practices"><i class="fa fa-check"></i><b>18.1.2</b> Programming best practices</a></li>
<li class="chapter" data-level="18.1.3" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#code-validation"><i class="fa fa-check"></i><b>18.1.3</b> Code validation</a></li>
<li class="chapter" data-level="18.1.4" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#using-the-methods-library"><i class="fa fa-check"></i><b>18.1.4</b> Using the Methods Library</a></li>
</ul></li>
<li class="chapter" data-level="18.2" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#methods-library-software-development-process"><i class="fa fa-check"></i><b>18.2</b> Methods Library software development process</a><ul>
<li class="chapter" data-level="18.2.1" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#source-code-management"><i class="fa fa-check"></i><b>18.2.1</b> Source Code Management</a></li>
<li class="chapter" data-level="18.2.2" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#documentation-2"><i class="fa fa-check"></i><b>18.2.2</b> Documentation</a></li>
<li class="chapter" data-level="18.2.3" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#availability-of-current-and-historical-archive-versions"><i class="fa fa-check"></i><b>18.2.3</b> Availability of Current and Historical Archive Versions</a></li>
<li class="chapter" data-level="18.2.4" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#maintenance-support-and-retirement"><i class="fa fa-check"></i><b>18.2.4</b> Maintenance, Support and Retirement</a></li>
<li class="chapter" data-level="18.2.5" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#qualified-personnel"><i class="fa fa-check"></i><b>18.2.5</b> Qualified Personnel</a></li>
<li class="chapter" data-level="18.2.6" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#physical-and-logical-security"><i class="fa fa-check"></i><b>18.2.6</b> Physical and Logical Security</a></li>
<li class="chapter" data-level="18.2.7" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#disaster-recovery"><i class="fa fa-check"></i><b>18.2.7</b> Disaster Recovery</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#methods-library-testing"><i class="fa fa-check"></i><b>18.3</b> Methods Library testing</a><ul>
<li class="chapter" data-level="18.3.1" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#unit-test"><i class="fa fa-check"></i><b>18.3.1</b> Unit test</a></li>
<li class="chapter" data-level="18.3.2" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#simulation"><i class="fa fa-check"></i><b>18.3.2</b> Simulation</a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#summary-9"><i class="fa fa-check"></i><b>18.4</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="MethodValidity.html"><a href="MethodValidity.html"><i class="fa fa-check"></i><b>19</b> Method Validity</a><ul>
<li class="chapter" data-level="19.1" data-path="MethodValidity.html"><a href="MethodValidity.html#design-specific-diagnostics"><i class="fa fa-check"></i><b>19.1</b> Design-specific diagnostics</a></li>
<li class="chapter" data-level="19.2" data-path="MethodValidity.html"><a href="MethodValidity.html#diagnostics-for-all-estimation"><i class="fa fa-check"></i><b>19.2</b> Diagnostics for all estimation</a><ul>
<li class="chapter" data-level="19.2.1" data-path="MethodValidity.html"><a href="MethodValidity.html#NegativeControls"><i class="fa fa-check"></i><b>19.2.1</b> Negative controls</a></li>
<li class="chapter" data-level="19.2.2" data-path="MethodValidity.html"><a href="MethodValidity.html#PositiveControls"><i class="fa fa-check"></i><b>19.2.2</b> Positive controls</a></li>
<li class="chapter" data-level="19.2.3" data-path="MethodValidity.html"><a href="MethodValidity.html#metrics"><i class="fa fa-check"></i><b>19.2.3</b> Empirical evaluation</a></li>
<li class="chapter" data-level="19.2.4" data-path="MethodValidity.html"><a href="MethodValidity.html#p-value-calibration"><i class="fa fa-check"></i><b>19.2.4</b> P-value calibration</a></li>
<li class="chapter" data-level="19.2.5" data-path="MethodValidity.html"><a href="MethodValidity.html#confidence-interval-calibration"><i class="fa fa-check"></i><b>19.2.5</b> Confidence interval calibration</a></li>
<li class="chapter" data-level="19.2.6" data-path="MethodValidity.html"><a href="MethodValidity.html#replication-across-sites"><i class="fa fa-check"></i><b>19.2.6</b> Replication across sites</a></li>
<li class="chapter" data-level="19.2.7" data-path="MethodValidity.html"><a href="MethodValidity.html#sensitivity-analyses"><i class="fa fa-check"></i><b>19.2.7</b> Sensitivity analyses</a></li>
</ul></li>
<li class="chapter" data-level="19.3" data-path="MethodValidity.html"><a href="MethodValidity.html#method-validation-in-practice"><i class="fa fa-check"></i><b>19.3</b> Method validation in practice</a><ul>
<li class="chapter" data-level="19.3.1" data-path="MethodValidity.html"><a href="MethodValidity.html#selecting-negative-controls"><i class="fa fa-check"></i><b>19.3.1</b> Selecting negative controls</a></li>
<li class="chapter" data-level="19.3.2" data-path="MethodValidity.html"><a href="MethodValidity.html#including-controls"><i class="fa fa-check"></i><b>19.3.2</b> Including controls</a></li>
<li class="chapter" data-level="19.3.3" data-path="MethodValidity.html"><a href="MethodValidity.html#empirical-performance"><i class="fa fa-check"></i><b>19.3.3</b> Empirical performance</a></li>
<li class="chapter" data-level="19.3.4" data-path="MethodValidity.html"><a href="MethodValidity.html#p-value-calibration-1"><i class="fa fa-check"></i><b>19.3.4</b> P-value calibration</a></li>
<li class="chapter" data-level="19.3.5" data-path="MethodValidity.html"><a href="MethodValidity.html#confidence-interval-calibration-1"><i class="fa fa-check"></i><b>19.3.5</b> Confidence interval calibration</a></li>
<li class="chapter" data-level="19.3.6" data-path="MethodValidity.html"><a href="MethodValidity.html#between-database-heterogeneity"><i class="fa fa-check"></i><b>19.3.6</b> Between-database heterogeneity</a></li>
<li class="chapter" data-level="19.3.7" data-path="MethodValidity.html"><a href="MethodValidity.html#sensitivity-analyses-1"><i class="fa fa-check"></i><b>19.3.7</b> Sensitivity analyses</a></li>
</ul></li>
<li class="chapter" data-level="19.4" data-path="MethodValidity.html"><a href="MethodValidity.html#ohdsi-methods-benchmark"><i class="fa fa-check"></i><b>19.4</b> OHDSI Methods Benchmark</a></li>
<li class="chapter" data-level="19.5" data-path="MethodValidity.html"><a href="MethodValidity.html#summary-10"><i class="fa fa-check"></i><b>19.5</b> Summary</a></li>
<li class="chapter" data-level="19.6" data-path="MethodValidity.html"><a href="MethodValidity.html#exercises-5"><i class="fa fa-check"></i><b>19.6</b> Exercises</a></li>
</ul></li>
<li class="part"><span><b>V OHDSI Studies</b></span></li>
<li class="chapter" data-level="20" data-path="StudySteps.html"><a href="StudySteps.html"><i class="fa fa-check"></i><b>20</b> Study steps</a></li>
<li class="chapter" data-level="21" data-path="NetworkResearch.html"><a href="NetworkResearch.html"><i class="fa fa-check"></i><b>21</b> OHDSI Network Research</a><ul>
<li class="chapter" data-level="21.1" data-path="NetworkResearch.html"><a href="NetworkResearch.html#what-is-the-ohdsi-research-network"><i class="fa fa-check"></i><b>21.1</b> What is the OHDSI Research Network?</a></li>
<li class="chapter" data-level="21.2" data-path="NetworkResearch.html"><a href="NetworkResearch.html#what-is-an-ohdsi-network-study"><i class="fa fa-check"></i><b>21.2</b> What is an OHDSI Network Study?</a></li>
<li class="chapter" data-level="21.3" data-path="NetworkResearch.html"><a href="NetworkResearch.html#executing-an-ohdsi-network-study"><i class="fa fa-check"></i><b>21.3</b> Executing an OHDSI Network Study</a><ul>
<li class="chapter" data-level="21.3.1" data-path="NetworkResearch.html"><a href="NetworkResearch.html#study-feasibility-and-design"><i class="fa fa-check"></i><b>21.3.1</b> Study Feasibility and Design</a></li>
<li class="chapter" data-level="21.3.2" data-path="NetworkResearch.html"><a href="NetworkResearch.html#study-execution"><i class="fa fa-check"></i><b>21.3.2</b> Study Execution</a></li>
<li class="chapter" data-level="21.3.3" data-path="NetworkResearch.html"><a href="NetworkResearch.html#results-dissemination-and-publication"><i class="fa fa-check"></i><b>21.3.3</b> Results Dissemination and Publication</a></li>
</ul></li>
<li class="chapter" data-level="21.4" data-path="NetworkResearch.html"><a href="NetworkResearch.html#types-of-network-studies"><i class="fa fa-check"></i><b>21.4</b> Types of Network Studies</a></li>
<li class="chapter" data-level="21.5" data-path="NetworkResearch.html"><a href="NetworkResearch.html#forward-looking-using-network-study-automation"><i class="fa fa-check"></i><b>21.5</b> Forward Looking: Using Network Study Automation</a></li>
<li class="chapter" data-level="21.6" data-path="NetworkResearch.html"><a href="NetworkResearch.html#best-practices-for-network-research"><i class="fa fa-check"></i><b>21.6</b> Best Practices for Network Research</a></li>
<li class="chapter" data-level="21.7" data-path="NetworkResearch.html"><a href="NetworkResearch.html#example-legend---hypertension"><i class="fa fa-check"></i><b>21.7</b> Example: LEGEND - Hypertension</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="Glossary.html"><a href="Glossary.html"><i class="fa fa-check"></i><b>A</b> Glossary</a></li>
<li class="chapter" data-level="B" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html"><i class="fa fa-check"></i><b>B</b> Cohort definitions</a><ul>
<li class="chapter" data-level="B.1" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#AceInhibitors"><i class="fa fa-check"></i><b>B.1</b> ACE inhibitors</a></li>
<li class="chapter" data-level="B.2" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#AceInhibitorsMono"><i class="fa fa-check"></i><b>B.2</b> New users of ACE inhibitors as first-line monotherapy for hypertension</a></li>
<li class="chapter" data-level="B.3" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#Ami"><i class="fa fa-check"></i><b>B.3</b> Acute myocardial infarction (AMI)</a></li>
<li class="chapter" data-level="B.4" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#Angioedema"><i class="fa fa-check"></i><b>B.4</b> Angioedema</a></li>
<li class="chapter" data-level="B.5" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#ThiazidesMono"><i class="fa fa-check"></i><b>B.5</b> New users of Thiazide-like diuretics as first-line monotherapy for hypertension</a></li>
<li class="chapter" data-level="B.6" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#HTN1yrFO"><i class="fa fa-check"></i><b>B.6</b> Patients initiating first-line therapy for hypertension with &gt;1 yr follow-up</a></li>
<li class="chapter" data-level="B.7" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#HTN3yrFO"><i class="fa fa-check"></i><b>B.7</b> Patients initiating first-line therapy for hypertension with &gt;3 yr follow-up</a></li>
<li class="chapter" data-level="B.8" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#ACEiUse"><i class="fa fa-check"></i><b>B.8</b> ACE inhibitor use</a></li>
<li class="chapter" data-level="B.9" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#ARBUse"><i class="fa fa-check"></i><b>B.9</b> Angiotensin receptor blocker (ARB) use</a></li>
<li class="chapter" data-level="B.10" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#THZUse"><i class="fa fa-check"></i><b>B.10</b> Thiazide or thiazide-like diuretic use</a></li>
<li class="chapter" data-level="B.11" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#dCCBUse"><i class="fa fa-check"></i><b>B.11</b> dihydropyridine Calcium Channel Blocker (dCCB) use</a></li>
<li class="chapter" data-level="B.12" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#ndCCBUse"><i class="fa fa-check"></i><b>B.12</b> non-dihydropyridine Calcium Channel Blocker (ndCCB) use</a></li>
<li class="chapter" data-level="B.13" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#BBUse"><i class="fa fa-check"></i><b>B.13</b> beta blocker use</a></li>
<li class="chapter" data-level="B.14" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#DLoopUse"><i class="fa fa-check"></i><b>B.14</b> Diuretic-loop use</a></li>
<li class="chapter" data-level="B.15" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#DPUse"><i class="fa fa-check"></i><b>B.15</b> Diuretic-potassium sparing use</a></li>
<li class="chapter" data-level="B.16" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#A1BUse"><i class="fa fa-check"></i><b>B.16</b> alpha-1 blocker use</a></li>
</ul></li>
<li class="chapter" data-level="C" data-path="NegativeControlsAppendix.html"><a href="NegativeControlsAppendix.html"><i class="fa fa-check"></i><b>C</b> Negative controls</a><ul>
<li class="chapter" data-level="C.1" data-path="NegativeControlsAppendix.html"><a href="NegativeControlsAppendix.html#AceiThzNsc"><i class="fa fa-check"></i><b>C.1</b> ACEi and THZ</a></li>
</ul></li>
<li class="chapter" data-level="D" data-path="SuggestedAnswers.html"><a href="SuggestedAnswers.html"><i class="fa fa-check"></i><b>D</b> Suggested Answers</a><ul>
<li class="chapter" data-level="D.1" data-path="SuggestedAnswers.html"><a href="SuggestedAnswers.html#SqlAndRanswers"><i class="fa fa-check"></i><b>D.1</b> SQL and R</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The Book of OHDSI</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="Cohorts" class="section level1">
<h1><span class="header-section-number">Chapter 11</span> Building the building blocks: cohorts</h1>
<p><em>Contributors: Kristin Kostka, Patrick Ryan, Jon Duke, Juan Banda, Joel Swerdel, Elle Palmer</em></p>
<p>Cohorts are used throughout OHDSI analytical tools and network studies as the primary building blocks for running high quality, systematic research. Cohort definitions vary from study to study depending on the research question of interest. Each cohort defines a specific way to represent a person with a condition or exposure using data in an observational health database. Thus, cohorts are an important component in documenting the methods of an observational research study.</p>
<p>The chapter serves to explain what is meant by creating and sharing cohort definitions, the methods for developing cohorts, and examples of how to build your own cohorts using ATLAS (see Chapter <a href="OhdsiAnalyticsTools.html#OhdsiAnalyticsTools">9</a>) and SQL queries against the Common Data Model (CDM).</p>
<div id="theory" class="section level2">
<h2><span class="header-section-number">11.1</span> Theory</h2>

<div class="rmdimportant">
<strong>OHDSI Cohort Definition:</strong> A cohort is defined as a set of persons who satisfy one or more inclusion criteria for a duration of time.
</div>

<p>In many peer-reviewed scientific manuscripts, a cohort definition is suggested to be analogous to a codeset of specific clinical codes (e.g. ICD-9/ICD-10, NDC, HCPCS, etc). While codesets are an important piece to assembling a cohort, a cohort definition is not simply a codeset. A cohort definition requires logic for how to use the codeset in a criteria. A well documented cohort specifies how a patient enters a cohort, a patient exits a cohort and any additional inclusion criteria that impacts how to observe a patient’s time-at-risk.</p>

<div class="rmdimportant">
The term <em>cohort</em> is often interchanged with the term phenotype. The term <em>phenotype</em> is applied to patient characteristics inferred from electronic health record (EHR) data (Hripcsak citation). The goal is to draw conclusions about a target concept based on raw EHR data, claims data, or other clinically relevant data. Thus, a <em>cohort</em> is a set of persons who satisfy one or more inclusion criteria (a phenotype) for a duration of time. A cohort in itself is not a phenotype but a phenotype can be used to create a cohort.
</div>

<p>There are two main approaches to constructing a cohort: <strong>1) rules-based design</strong> or <strong>2) probabilistic design</strong>. A rules-based cohort design relies heavily on the domain expertise of the individual designing the cohort to use their knowledge of the therapeutic area of interest to build rules to qualify potential cohort membership. Conversely, a probabilistic design mines already available data to identify and qualify potential cohort membership through machine-suggested patterns. The next sections will discuss these approaches in further detail.</p>
<div id="rules-based-cohort-design" class="section level3">
<h3><span class="header-section-number">11.1.1</span> Rules-based cohort design</h3>
<p>A rules-based OHDSI cohort definition begins by an expert-consensus stating one or more inclusion criteria (e.g. “people with angioedema”) in a specific duration of time (e.g. “who developed this condition within the last 6 months”).</p>
<p>When creating a cohort definition, you need to ask yourself the following questions:</p>
<ul>
<li><em>What initial event(s) define cohort entry?</em></li>
<li><em>What inclusion criteria are applied to the initial events?</em></li>
<li><em>What defines a person’s cohort exit?</em></li>
</ul>
<p>To visualize the importance of these criteria, think of how this information comes together in a person’s timeline. The OBSERVATION_PERIOD table creates the window for which we see the person in the data.</p>
<div class="figure"><span id="fig:cohortBuild"></span>
<img src="images/Cohorts/cohort-build.png" alt="Cohort Creation" width="100%" />
<p class="caption">
Figure 11.1: Cohort Creation
</p>
</div>
<p><em>Cohort entry criteria:</em> The cohort entry event can be one or many clinical attributes which dictate an individual patient’s eligibility to be included in a cohort. Events are recorded time-stamped observations for the persons, such as drug exposures, conditions, procedures, measurements and visits. The event index date is set to be equal to the event start date. Initial events defined by a domain, concept set, and any domain-specific attributes required.</p>
<p><em>Inclusion criteria:</em> The qualifying cohort will be defined as all persons who have an initial event and satisfy all qualifying inclusion criteria. Each inclusion criterion is defined by domain(s), concept set(s), domain-specific attributes, and the temporal logic relative to initial events. Each qualifying inclusion criterion can be evaluated to determine the impact of the criteria on the attrition of persons from the initial cohort.</p>
<p><em>Cohort exit criteria:</em> The cohort exit event signifies when a person no longer qualifies for cohort membership. Cohort exit can be defined in multiple ways such as the end of the observation period, a fixed time interval relative to the initial entry event, the last event in a sequence of related observations (e.g. persistent drug exposure) or through other censoring of observation period. Cohort exit strategy will impact whether a person can belong to the cohort multiple times during different time intervals.</p>
<p><em>Time-at-risk:</em> In order to interpret risk of a specific outcome, which will be defined as a separate cohort definition, it is necessary to know the length of time that applies. A time-at-risk criteria states the period of time in which the cohort must be in the data following the cohort entry criteria. The time-at-risk will vary based on whether you’re observing an acute/short term trend or a chronic/long term trend.</p>
<div class="figure"><span id="fig:cohortTar"></span>
<img src="images/Cohorts/cohort-TAR.png" alt="Time-at-Risk Construction" width="100%" />
<p class="caption">
Figure 11.2: Time-at-Risk Construction
</p>
</div>
<p>In traditional study design, we would categorize time-at-risk for ‘on treatment’ as the entirety of the time between when a person meets cohort entry through the cohort exit criteria. An ‘intent-to-treat’ design would be the entirety of the time from the cohort start through the observation period ending (e.g. when the person leaves the data because they’ve switched physicians, insurance carriers, etc).</p>
<p>The use of these criteria may present a number of unique nuances to an OHDSI cohort including:</p>
<ul>
<li>One person may belong to multiple cohorts</li>
<li>One person may belong to the same cohort at multiple different time periods</li>
<li>One person may not belong to the same cohort multiple times during the same period of time</li>
<li>One cohort may have zero or more members</li>
</ul>
<p>Throughout the Book of OHDSI, we will detail how to address these consequences in your overall study design. In each respective methodology, we will discuss how you can configure a methods package to address how one person shows up in multiple cohorts being studied.</p>
</div>
<div id="probabilistic-cohort-design-using-aphrodite" class="section level3">
<h3><span class="header-section-number">11.1.2</span> Probabilistic cohort design using APHRODITE</h3>
<p>Rules-based cohort design are a popular method for assembling cohort definitions. However, assembling necessary expert consensus to create a study cohort can be prohibitively time consuming. Probabilistic cohort design is an alternative, machine-driven method to expedite the selection of cohort attributes. In this method, supervised learning allows a phenotyping algorithm to learn from a set of labeled examples (cases) of what attributes contribute to cohort membership. This algorithm can then be used to better ascertain the defining characteristics of a phenotype and what trade offs occur in overall study accuracy when choosing to modify phenotype criteria.</p>
<p>To apply this approach on OMOP data, OHDSI community researchers created Automated PHenotype Routine for Observational Definition, Identification, Training and Evaluation (APHRODITE), an R-package cohort building framework that combines the ability of learning from imperfectly labeled data and the Anchor learning framework for improving selected features in the phenotype models, for use with the OHDSI/OMOP CDM (<span class="citation">(Banda et al. <a href="#ref-Banda2017APHRODITE" role="doc-biblioref">2017</a>)</span>). <a href="https://github.com/OHDSI/Aphrodite">APHRODITE</a> is an open-source package (<a href="https://github.com/OHDSI/Aphrodite" class="uri">https://github.com/OHDSI/Aphrodite</a>) available for use which provides the OHDSI data network to the ability to start building electronic phenotype models that leverage machine learning techniques and go beyond traditional rule based approaches to cohort building.</p>
</div>
</div>
<div id="phenotype-evaluation" class="section level2">
<h2><span class="header-section-number">11.2</span> Phenotype Evaluation</h2>
<p>The systematic reuse of cohort definitions and the subsequent evaluation of phenotypes to characterize components of disease remains an ongoing piece of work within the OHDSI Community <span class="citation">(Swerdel, Hripcsak, and Ryan <a href="#ref-Swerdel2019phevaluator" role="doc-biblioref">2019</a>)</span>. A literature review of over 33 studies found significant heterogeneity in phenotype algorithms used, validation methods, and results (<span class="citation">(B. Rubbo et al. <a href="#ref-Rubbo2015phenotypes" role="doc-biblioref">2015</a>)</span>). In general, the validation of a rules-based cohort definition or probabilistic algorithm can be thought of as a test of the proposed cohort compared to some form of “gold standard” reference (e.g. manual chart review of cases).</p>
<div class="figure"><span id="fig:cohortPpv"></span>
<img src="images/Cohorts/cohort-PPV.png" alt="Algorithm Evaluation" width="100%" />
<p class="caption">
Figure 11.3: Algorithm Evaluation
</p>
</div>
<p>For a complete validation of an algorithm, we need to calculate:</p>
<ul>
<li><p><strong>Sensitivity</strong> = True Positive (TP) / (True Positive + False Negative)</p></li>
<li><p><strong>Specificity</strong> = True Negative (TN) / (True Negative + False Positive)</p></li>
<li><p><strong>Positive Predictive Value</strong> = TP / (True Positive + False Positive)</p></li>
</ul>
<p>This framework continues to be utilized across cohort definition research to evaluate the utility of reuse of cohorts across different electronic health data. The PheValuator tool <span class="citation">(Swerdel, Hripcsak, and Ryan <a href="#ref-Swerdel2019phevaluator" role="doc-biblioref">2019</a>)</span> is a recent addition to the OHDSI Community that provides a standard method to efficiently estimate a complete phentoype algorithm evaluation.</p>
</div>
<div id="ohdsi-gold-standard-phenotype-library" class="section level2">
<h2><span class="header-section-number">11.3</span> OHDSI Gold Standard Phenotype Library</h2>
<p>To further assist the community in the inventory and overall evaluation of existing cohort definitions and algorithms, the OHDSI Gold Standard Phenotype Library (GSPL) Workgroup was formed. The purpose of the GSPL workgroup is to provide additional leadership to the development of community-backed cohort libraries from rules-based and probabilistic methods. The GPSL enable members of the OHDSI community to find, evaluate, and utilize community-validated cohort definitions for research and other activities. These “gold standard” definitions will reside in a library, the entries of which are held to specific standards of design and evaluation. For additional information related to the GSPL, consult the OHDSI workgroup page (<a href="https://www.ohdsi.org/web/wiki/doku.php?id=projects:workgroups:gold-library-wg" class="uri">https://www.ohdsi.org/web/wiki/doku.php?id=projects:workgroups:gold-library-wg</a>). Research within this workgroup includes APHRODITE <span class="citation">(Banda et al. <a href="#ref-Banda2017APHRODITE" role="doc-biblioref">2017</a>)</span> and the PheValuator tool, discussed in the prior section, <span class="citation">(Swerdel, Hripcsak, and Ryan <a href="#ref-Swerdel2019phevaluator" role="doc-biblioref">2019</a>)</span> as well as work done to share the Electronic Medical Records and Genomics <a href="https://emerge.mc.vanderbilt.edu/">eMERGE</a> <a href="https://phekb.org/phenotypes">Phenotype Library</a> across the OHDSI network <span class="citation">(Hripcsak et al. <a href="#ref-Hripcsak2019eMERGE" role="doc-biblioref">2019</a>)</span>. If phenotype curation is your interest, consider contributing to this workgroup.</p>
</div>
<div id="practice" class="section level2">
<h2><span class="header-section-number">11.4</span> Practice</h2>
<p>Now that we’ve covered the basics, it’s time to put your cohort building skills to the test. (Note: If you’ve gotten lost on your OHDSI journey and not sure where to start, you can always return to Where to Begin ((Chapter <a href="#WheretoBegin"><strong>??</strong></a>) to recall the way to translate a research question into an OHDSI standard analytics approach.)</p>
<p>When you are building a cohort, you should consider which of these is more important to you: finding all the eligible patients? <em>vs.</em> Getting only the ones you are confident about? Your strategy to construct your cohort will depend on your the clinical stringency of how your expert consensus defines the disease. This is to say, the right cohort design will depend on the question you’re trying to answer. You may opt to build a cohort definition that: uses everything you can get, uses the lowest common denominator so you can share it across OHDSI sites or is a compromise of the two. It is ultimately at the researcher’s discretion what threshold of stringency is necessary to adequately study the cohort of interest.
We begin to practice our cohort skills by putting together a cohort definition using a rules-based approach. In this example, we want to find <em>patients who initiate ACE inhibitors monotherapy as first-line treatments for hypertension</em>
Recall, the components of building a cohort include:</p>
<ul>
<li><strong>Domain</strong>: A Domain defines the set of allowable Concepts for the standardized fields in the CDM tables (refer to Chapter <a href="CommonDataModel.html#CommonDataModel">5</a>). (Ex: Condition, Drug, Procedure, Measurement)</li>
<li><strong>Concept set</strong>: An expression that defines one or more concepts encompassing a clinical entity of interest (Ex: Concepts for type II diabetes, concepts for antidiabetic drugs)</li>
<li><strong>Domain-specific attribute</strong>: Ex: DRUG_EXPOSURE: Days supply; MEASUREMENT: value_as_number, high_range</li>
<li><strong>Temporal logic</strong>: the time intervals within which the relationship between an inclusion criteria and an event is evaluated (Ex: Indicated condition must occur during 365d prior to or on exposure start)</li>
</ul>
<p>As you are building your actual cohort definition, you may find it helpful to think of OMOP domains analogous to building blocks that represent cohort attributes:</p>
<div class="figure"><span id="fig:cohortLegos"></span>
<img src="images/Cohorts/cohort-legos.png" alt="Building Blocks of Cohorts" width="100%" />
<p class="caption">
Figure 11.4: Building Blocks of Cohorts
</p>
</div>
We are now going to build our cohort. As we go through this exercise, we will think about this like a standard attrition chart. Below is a view of the logic we will be building:
<div class="figure"><span id="fig:CohortPractice"></span>
<img src="images/Cohorts/CohortPractice.png" alt="Logical Diagram of Intended Cohort" width="100%" />
<p class="caption">
Figure 11.5: Logical Diagram of Intended Cohort
</p>
</div>
<p>You can build a cohort in the user interface of ATLAS or you can write a query directly against your OMOP CDM. We will discuss both approaches in the next sections.</p>
<div id="using-atlas" class="section level3">
<h3><span class="header-section-number">11.4.1</span> Using ATLAS</h3>
<p>We can build this cohort using the ATLAS interface. To begin in ATLAS, click on the ‘Cohort Definition’ module (located on the left hand panel fifth selection from the top):</p>
<div class="figure"><span id="fig:ATLAScohort"></span>
<img src="images/Cohorts/ATLAS-cohort.png" alt="Navigating to ATLAS Cohort Definition module"  />
<p class="caption">
Figure 11.6: Navigating to ATLAS Cohort Definition module
</p>
</div>
<p>When the module loads, click on the blue botton on the right that says ‘New Cohort’:</p>
<div class="figure"><span id="fig:ATLASnewcohort"></span>
<img src="images/Cohorts/ATLAS-newcohort.png" alt="Navigating to ATLAS New Cohort button"  />
<p class="caption">
Figure 11.7: Navigating to ATLAS New Cohort button
</p>
</div>
<p>The next screen you will see will be an empty cohort definition. It will look like this:</p>
<div class="figure"><span id="fig:ATLASdefineacohort"></span>
<img src="images/Cohorts/ATLAS-defineacohort.png" alt="New Cohort Definition"  />
<p class="caption">
Figure 11.8: New Cohort Definition
</p>
</div>
<p>Before you do anything else, you will need to change the name of the cohort from <em>New Cohort Definition</em> to your own unique name for this cohort. You may opt for a name like <em>New users of ACE inhibitors as first-line monotherapy for hypertension</em>.</p>

<div class="rmdimportant">
ATLAS will not allow two cohorts to have the same exact names. ATLAS will give you a pop-up error message if you choose a name already used by another ATLAS cohort. It is important you pick a name that is not already used by another cohort in ATLAS.
</div>

<p>Once you have chosen a name, you can save the cohort by clicking the green floppy-disk icon. Now we can proceed with defining the initial cohort event. You will click to add to ‘Add an Initial Event’. You now have to pick which domain you are building a criteria around. You may ask yourself, <em>how do I know which domain is the initial cohort event?</em> Let’s figure that out.</p>
<div class="figure"><span id="fig:ATLASinitialevent"></span>
<img src="images/Cohorts/ATLAS-initialevent.png" alt="Adding an Initial Event"  />
<p class="caption">
Figure 11.9: Adding an Initial Event
</p>
</div>
<p>ATLAS provides descriptions below each criteria to help you. If we were building a CONDITION_OCCURRENCE based criteria, our question would be looking for patients with a specific diagnosis. If we were building a DRUG_EXPOSURE based criteria, our question would be looking for patients with a specific drug or drug class. Since we want to find <em>patients who initiate ACE inhibitors monotherapy as first-line treatments for hypertension</em>, we want to choose a DRUG_EXPOSURE criteria. You may say, <em>but we also care about hypertension as a diagnosis</em>. You are correct. Hypertension is another criteria we will build. However, eligibility to enter this cohort is predicated on being a new-user of ACE inhibitors as monotherapy. The diagnosis of hypertension is what we call an <em>additional qualifying criteria</em>. We will return to this once we build this criteria. We will click to add a DRUG_EXPOSURE criteria.</p>
<div class="figure"><span id="fig:ATLASdrugexposure"></span>
<img src="images/Cohorts/ATLAS-drugexposure.png" alt="Building a Drug Exposure Criteria"  />
<p class="caption">
Figure 11.10: Building a Drug Exposure Criteria
</p>
</div>
The screen will update with your selected criteria but you are not done yet. You now need to tell ATLAS which concept set you want to associate with this DRUG_EXPOSURE criteria. You will need to click the down arrow to open the dialogue box to import a concept set.
<div class="figure"><span id="fig:ATLASimportaconcept"></span>
<img src="images/Cohorts/ATLAS-importaconcept.png" alt="Specifying a Concept Set - Step 1"  />
<p class="caption">
Figure 11.11: Specifying a Concept Set - Step 1
</p>
</div>
<p><strong>Scenario 1: You have not built a concept set.</strong> Imagine you’ve got a blank slate here. You have not assembled your concept sets to retrieve to apply to your criteria. At a very basic level, this will require you to utilize the <em>Search</em> function to find and choose the concepts you would like to specify. You can refer back to (see Chapter <a href="#StandardVocabularies"><strong>??</strong></a>) on how to navigate the OMOP vocabularies to find clinical concepts of interest. This chapter will not focus on the assembly of concept sets. You may utilize the OHDSI Resources page to find bite sized ATLAS tutorials that can help you understand how to search and build a concept set.</p>
<strong>Scenario 2: You’ve already built a concept set.</strong> If you’ve already created a concept set and saved it in ATLAS, you can click to <em>‘Import a Concept Set’</em> where you will be then prompted to find your concept in the concept set repository of your ATLAS.
<div class="figure"><span id="fig:ATLASfindyourconcept"></span>
<img src="images/Cohorts/ATLAS-findingyourconcept.png" alt="Specifying a Concept Set - Step 2"  />
<p class="caption">
Figure 11.12: Specifying a Concept Set - Step 2
</p>
</div>
<p>In the above example, the user typed in the name given to this concept set <em>‘ace inhibitors’</em> in the right hand search. This shortened the concept set list to only concepts with matching names. From there, the user can click on the row of the concept set to select it. (Note: the dialogue box will disappear once you have selected a concept set.) You are not done yet. Your question is looking for new users or the first time in someone’s history they are exposed to ACE inhibitors. You need to click to <em>‘Add attribute’</em>.</p>
<div class="figure"><span id="fig:ATLASfirstexposure"></span>
<img src="images/Cohorts/ATLAS-firstexposure.png" alt="Adding Attribute to Initial Criteria - Step 1"  />
<p class="caption">
Figure 11.13: Adding Attribute to Initial Criteria - Step 1
</p>
</div>
<p>You will want to select the <em>First Exposure Criteria</em>. From there, the window will automatically close. Notice, you could specify other attributes of a criteria you build. You could specify an attribute of age at occurrence, the date of occurrence, gender or other attributes related to the drug. Criteria available for selection will look different for each domain.</p>
<div class="figure"><span id="fig:ATLASfirsttimeever"></span>
<img src="images/Cohorts/ATLAS-firsttimeever.png" alt="Adding Attribute to Initial Criteria - Step 2"  />
<p class="caption">
Figure 11.14: Adding Attribute to Initial Criteria - Step 2
</p>
</div>
Once selected, the attribute will show up in the same box as the initial criteria.

<div class="rmdimportant">
The current design of ATLAS may confuse some. Despite its apperance, the red X is not intended to mean “No”. It is an actionable feature to allow the user to delete the criteria. If you click the red X, this criteria will go away. Thus, you need to leave the criteria with the red X to keep the criteria active.
</div>

<p>Now you have built an initial qualifying event. To ensure you are capturing the first exposure, you will want to add a lookback window to know that you are looking at enogh of the patient’s histroy to know what comes first. You can do this by adjusting the continuous observation drop downs. You could also click the box and type in a value to these windows. To ensure this is the first exposure in the patient’s history, we add a lookback of 365 days. The lookback window is the discretion of your expert consensus. You may choose differently in other cohorts. This creates, as best as we are able, a “clean” period to ensure we are capturing the first record. We then also opt limit it to the earliest event per person.</p>
<div class="figure"><span id="fig:ATLASlookback"></span>
<img src="images/Cohorts/ATLAS-lookback.png" alt="Adjusting the Observation Period"  />
<p class="caption">
Figure 11.15: Adjusting the Observation Period
</p>
</div>
<p>By now, you may be confused. <em>Why do I add a first ever criteria in addition to limit to the earliest event?</em> You can think about this using the following chart:</p>
<div class="figure"><span id="fig:EarliestEventExplained"></span>
<img src="images/Cohorts/EarliestEventExplained.png" alt="Patient Eligibility by Criteria Applied"  />
<p class="caption">
Figure 11.16: Patient Eligibility by Criteria Applied
</p>
</div>
<p>In the above diagram, each line represents a patient in our data. The filled in stars represent a time the individual fulfills the specified criteria. As additional criteria is applied, you may see some stars are a lighter shade. This means that these patients have other records that satisfy the criteria but there is another record that proceeds that. By the time we get to the last criteria, we are looking at the cumulative view of patients who have ACE inhibitors for the first time and have 365 days prior to the first time occurrence. This means that if we limit to the earliest event, it must fulfil <strong>all</strong> three criteria (drug exposure, first time in patient’s history and lookback window) and it is the earliest occurrence of all three critera being met. If that still feels confusing, you’re not alone. This is one of the most challenging features of ATLAS that tends to trip up researchers. When you are building your own cohorts, you may opt to engage the Researchers section of the <a href="http://forums.ohdsi.org">OHDSI Forum</a> to get a second opinion on how to construct your cohort logic.</p>
<p>Once we have specified a cohort entry event, you could proceed to one of two places to add your additional qualifying events: <em>Restrict Initial Events</em> and <em>Inclusion Criteria</em>. The fundamental difference between these two options is what interim information you want ATLAS to serve back to you. If you add additional qualifying criteria into the Cohort Entry Event box by selecting <em>Restrict Initial Events</em>, when you choose to generate a count in ATLAS, you will only get back the number of people who meet ALL of these criteria. If you opt to add criteria into the <em>Inclusion Criteria</em>, you will get an attrition chart to show you how many patients are lost by applying additional inclusion criteria. It is highly encouraged to utilize the Inclusion Criteria section so you can understand the impact of each rule on the overall success of the cohort definition. You may find a certian inclusion criteria severely limits the number of people who end up in the cohort. You may choose to relax this criteria to get a larger cohort. This will ultimately be at the discretion of the expert consensus assembling this cohort.</p>
You will now want to click ‘New Inclusion Criteria’ to add a subsequent piece of logic about membership to this cohort. The functionality in this section is identical to the way we discussed building cohort criteria above. You may specific the criteria and add specific attributes. Our first additional criteria is to subset the cohort to only patients: <em>With at least 1 occurrence of hypertension disorder between 365 and 0 days after index date (first initiation of an ACE inhibitor)</em>. If you’re following along, this would come out looking like this:
<div class="figure"><span id="fig:ATLAS-IC1"></span>
<img src="images/Cohorts/ATLAS-IC1.png" alt="Additional Inclusion Criteria #1"  />
<p class="caption">
Figure 11.17: Additional Inclusion Criteria #1
</p>
</div>
You will then want to add another criteria to look for patients: <em>with exactly 0 occurrences of hypertension drugs all days before and 1 day before index start date (no exposure to HT drugs before an ACE inhibitor)</em>. If you’re following along, this would come out looking like this:
<div class="figure"><span id="fig:ATLAS-IC2"></span>
<img src="images/Cohorts/ATLAS-IC2.png" alt="Additional Inclusion Criteria #2"  />
<p class="caption">
Figure 11.18: Additional Inclusion Criteria #2
</p>
</div>
You may be confused why “having no occurrences” is coded as “exactly 0 occurrences.” This is a nuance of how ATLAS consumes knowledge. ATLAS only consumes inclusion criteria. You must use logical operators to indicate when you want the absence of a specific attribute such as: “Exactly 0”. While this may be somewhat unintuitive, over time, you will become more familiar with the logical operators available in ATLAS criteria. Lastly, you will want to add your another criteria to look for patients: *with exactly 1 occurrence of hypertension drugs between 0 days before and 7 days after index start date AND can only start one HT drug (an ACE inhibitor)
<div class="figure"><span id="fig:ATLAS-IC3"></span>
<img src="images/Cohorts/ATLAS-IC3.png" alt="Additional Inclusion Criteria #3"  />
<p class="caption">
Figure 11.19: Additional Inclusion Criteria #3
</p>
</div>
You have now added all of your qualifying inclusion criteria. You must now specify your cohort exit criteria. You will ask yourself, <em>when are people no longer eligible to be included in this cohort?“* In this cohort, we are following new-users of a drug exposure. We want to look at all available observation time following meeting the inclusion criteria. As such, the exit criteria is simply following for the entirety of the continuous drug exposure. If there is a subsequent break in the drug exposure, the patient will exit the cohort at this time as we cannot determine what happened to the person during the break in the drug exposure. We can also set a criteria on the persistence window to specify an”allowable" gap between drug exposures. In this case, our expert consensus concluded that a maximum of 30 days between exposure records when inferring the era of persistence exposure. We can configure this by selecting the Event will persist </em>until the end of a drug exposure*. We then will add our persistence window and append the concept set for ACE inhibitors. The resulting logic looks like this:
<div class="figure"><span id="fig:ATLAS-cohortexit"></span>
<img src="images/Cohorts/ATLAS-cohortexit.png" alt="Cohort Exit Criteria"  />
<p class="caption">
Figure 11.20: Cohort Exit Criteria
</p>
</div>
<p>In the case of this cohort, there are no other censoring events. However, you may build other cohorts where you need to specify this criteria. You would proceed similarly to the way we have added other attributes to this cohort definition. You have now successfully finished creating your cohort. Congratulations! Building a cohort is the most important part of answering a question in the OHDSI tools. You can now use the Export tab to share your cohort definiton to other collaborators in the form of code or JSON files to load into ATLAS. For more information on how to utilize ATLAS, you should consult the OHDSI Resources.</p>
</div>
<div id="using-sql" class="section level3">
<h3><span class="header-section-number">11.4.2</span> Using SQL</h3>
<p>If you’d prefer to query a database directly, you may write a SQL query to directly look for your particular cohort. OHDSI does not require a specific data layer. Where possible, you shoudl utilize <a href="https://github.com/OHDSI/SqlRender">SQL Render</a> to render parameterized SQL, and translating it to different SQL dialects so you can share your cohort definition across network sites. Below is an example of how to write a query directly to a database for your cohort:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb67-1"><a href="Cohorts.html#cb67-1"></a><span class="kw">CREATE</span> <span class="kw">TABLE</span> #Codesets (</span>
<span id="cb67-2"><a href="Cohorts.html#cb67-2"></a>  codeset_id <span class="dt">int</span> <span class="kw">NOT</span> <span class="kw">NULL</span>,</span>
<span id="cb67-3"><a href="Cohorts.html#cb67-3"></a>  concept_id bigint <span class="kw">NOT</span> <span class="kw">NULL</span></span>
<span id="cb67-4"><a href="Cohorts.html#cb67-4"></a>)</span>
<span id="cb67-5"><a href="Cohorts.html#cb67-5"></a>;</span>
<span id="cb67-6"><a href="Cohorts.html#cb67-6"></a></span>
<span id="cb67-7"><a href="Cohorts.html#cb67-7"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> #Codesets (codeset_id, concept_id)</span>
<span id="cb67-8"><a href="Cohorts.html#cb67-8"></a><span class="kw">SELECT</span> <span class="dv">0</span> <span class="kw">as</span> codeset_id, c.concept_id <span class="kw">FROM</span> (<span class="kw">select</span> <span class="kw">distinct</span> I.concept_id <span class="kw">FROM</span></span>
<span id="cb67-9"><a href="Cohorts.html#cb67-9"></a>( </span>
<span id="cb67-10"><a href="Cohorts.html#cb67-10"></a>  <span class="kw">select</span> concept_id <span class="kw">from</span> @vocabulary_database_schema.CONCEPT <span class="kw">where</span> concept_id <span class="kw">in</span> (<span class="dv">316866</span>)</span>
<span id="cb67-11"><a href="Cohorts.html#cb67-11"></a><span class="kw">UNION</span>  <span class="kw">select</span> c.concept_id</span>
<span id="cb67-12"><a href="Cohorts.html#cb67-12"></a>  <span class="kw">from</span> @vocabulary_database_schema.CONCEPT c</span>
<span id="cb67-13"><a href="Cohorts.html#cb67-13"></a>  <span class="kw">join</span> @vocabulary_database_schema.CONCEPT_ANCESTOR ca <span class="kw">on</span> c.concept_id <span class="op">=</span> ca.descendant_concept_id</span>
<span id="cb67-14"><a href="Cohorts.html#cb67-14"></a>  <span class="kw">and</span> ca.ancestor_concept_id <span class="kw">in</span> (<span class="dv">316866</span>)</span>
<span id="cb67-15"><a href="Cohorts.html#cb67-15"></a>  <span class="kw">and</span> c.invalid_reason <span class="kw">is</span> <span class="kw">null</span></span>
<span id="cb67-16"><a href="Cohorts.html#cb67-16"></a></span>
<span id="cb67-17"><a href="Cohorts.html#cb67-17"></a>) I</span>
<span id="cb67-18"><a href="Cohorts.html#cb67-18"></a>) C;</span>
<span id="cb67-19"><a href="Cohorts.html#cb67-19"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> #Codesets (codeset_id, concept_id)</span>
<span id="cb67-20"><a href="Cohorts.html#cb67-20"></a><span class="kw">SELECT</span> <span class="dv">2</span> <span class="kw">as</span> codeset_id, c.concept_id <span class="kw">FROM</span> (<span class="kw">select</span> <span class="kw">distinct</span> I.concept_id <span class="kw">FROM</span></span>
<span id="cb67-21"><a href="Cohorts.html#cb67-21"></a>( </span>
<span id="cb67-22"><a href="Cohorts.html#cb67-22"></a>  <span class="kw">select</span> concept_id <span class="kw">from</span> @vocabulary_database_schema.CONCEPT <span class="kw">where</span> concept_id <span class="kw">in</span> (<span class="dv">1319998</span>,<span class="dv">1317967</span>,<span class="dv">991382</span>,<span class="dv">1332418</span>,<span class="dv">1314002</span>,<span class="dv">40235485</span>,<span class="dv">1335471</span>,<span class="dv">1322081</span>,<span class="dv">1338005</span>,<span class="dv">932745</span>,<span class="dv">1351557</span>,<span class="dv">1340128</span>,<span class="dv">1346823</span>,<span class="dv">1395058</span>,<span class="dv">1398937</span>,<span class="dv">1328165</span>,<span class="dv">1363053</span>,<span class="dv">1341927</span>,<span class="dv">1309799</span>,<span class="dv">1346686</span>,<span class="dv">1353776</span>,<span class="dv">1363749</span>,<span class="dv">956874</span>,<span class="dv">1344965</span>,<span class="dv">1373928</span>,<span class="dv">974166</span>,<span class="dv">978555</span>,<span class="dv">1347384</span>,<span class="dv">1326012</span>,<span class="dv">1386957</span>,<span class="dv">1308216</span>,<span class="dv">1367500</span>,<span class="dv">1305447</span>,<span class="dv">907013</span>,<span class="dv">1307046</span>,<span class="dv">1309068</span>,<span class="dv">1310756</span>,<span class="dv">1313200</span>,<span class="dv">1314577</span>,<span class="dv">1318137</span>,<span class="dv">1318853</span>,<span class="dv">1319880</span>,<span class="dv">40226742</span>,<span class="dv">1327978</span>,<span class="dv">1373225</span>,<span class="dv">1345858</span>,<span class="dv">1350489</span>,<span class="dv">1353766</span>,<span class="dv">1331235</span>,<span class="dv">1334456</span>,<span class="dv">970250</span>,<span class="dv">1317640</span>,<span class="dv">1341238</span>,<span class="dv">942350</span>,<span class="dv">1342439</span>,<span class="dv">904542</span>,<span class="dv">1308842</span>,<span class="dv">1307863</span>)</span>
<span id="cb67-23"><a href="Cohorts.html#cb67-23"></a><span class="kw">UNION</span>  <span class="kw">select</span> c.concept_id</span>
<span id="cb67-24"><a href="Cohorts.html#cb67-24"></a>  <span class="kw">from</span> @vocabulary_database_schema.CONCEPT c</span>
<span id="cb67-25"><a href="Cohorts.html#cb67-25"></a>  <span class="kw">join</span> @vocabulary_database_schema.CONCEPT_ANCESTOR ca <span class="kw">on</span> c.concept_id <span class="op">=</span> ca.descendant_concept_id</span>
<span id="cb67-26"><a href="Cohorts.html#cb67-26"></a>  <span class="kw">and</span> ca.ancestor_concept_id <span class="kw">in</span> (<span class="dv">1319998</span>,<span class="dv">1317967</span>,<span class="dv">991382</span>,<span class="dv">1332418</span>,<span class="dv">1314002</span>,<span class="dv">40235485</span>,<span class="dv">1335471</span>,<span class="dv">1322081</span>,<span class="dv">1338005</span>,<span class="dv">932745</span>,<span class="dv">1351557</span>,<span class="dv">1340128</span>,<span class="dv">1346823</span>,<span class="dv">1395058</span>,<span class="dv">1398937</span>,<span class="dv">1328165</span>,<span class="dv">1363053</span>,<span class="dv">1341927</span>,<span class="dv">1309799</span>,<span class="dv">1346686</span>,<span class="dv">1353776</span>,<span class="dv">1363749</span>,<span class="dv">956874</span>,<span class="dv">1344965</span>,<span class="dv">1373928</span>,<span class="dv">974166</span>,<span class="dv">978555</span>,<span class="dv">1347384</span>,<span class="dv">1326012</span>,<span class="dv">1386957</span>,<span class="dv">1308216</span>,<span class="dv">1367500</span>,<span class="dv">1305447</span>,<span class="dv">907013</span>,<span class="dv">1307046</span>,<span class="dv">1309068</span>,<span class="dv">1310756</span>,<span class="dv">1313200</span>,<span class="dv">1314577</span>,<span class="dv">1318137</span>,<span class="dv">1318853</span>,<span class="dv">1319880</span>,<span class="dv">40226742</span>,<span class="dv">1327978</span>,<span class="dv">1373225</span>,<span class="dv">1345858</span>,<span class="dv">1350489</span>,<span class="dv">1353766</span>,<span class="dv">1331235</span>,<span class="dv">1334456</span>,<span class="dv">970250</span>,<span class="dv">1317640</span>,<span class="dv">1341238</span>,<span class="dv">942350</span>,<span class="dv">1342439</span>,<span class="dv">904542</span>,<span class="dv">1308842</span>,<span class="dv">1307863</span>)</span>
<span id="cb67-27"><a href="Cohorts.html#cb67-27"></a>  <span class="kw">and</span> c.invalid_reason <span class="kw">is</span> <span class="kw">null</span></span>
<span id="cb67-28"><a href="Cohorts.html#cb67-28"></a></span>
<span id="cb67-29"><a href="Cohorts.html#cb67-29"></a>) I</span>
<span id="cb67-30"><a href="Cohorts.html#cb67-30"></a>) C;</span>
<span id="cb67-31"><a href="Cohorts.html#cb67-31"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> #Codesets (codeset_id, concept_id)</span>
<span id="cb67-32"><a href="Cohorts.html#cb67-32"></a><span class="kw">SELECT</span> <span class="dv">3</span> <span class="kw">as</span> codeset_id, c.concept_id <span class="kw">FROM</span> (<span class="kw">select</span> <span class="kw">distinct</span> I.concept_id <span class="kw">FROM</span></span>
<span id="cb67-33"><a href="Cohorts.html#cb67-33"></a>( </span>
<span id="cb67-34"><a href="Cohorts.html#cb67-34"></a>  <span class="kw">select</span> concept_id <span class="kw">from</span> @vocabulary_database_schema.CONCEPT <span class="kw">where</span> concept_id <span class="kw">in</span> (<span class="dv">1335471</span>,<span class="dv">1340128</span>,<span class="dv">1341927</span>,<span class="dv">1363749</span>,<span class="dv">1308216</span>,<span class="dv">1310756</span>,<span class="dv">1373225</span>,<span class="dv">1331235</span>,<span class="dv">1334456</span>,<span class="dv">1342439</span>)</span>
<span id="cb67-35"><a href="Cohorts.html#cb67-35"></a><span class="kw">UNION</span>  <span class="kw">select</span> c.concept_id</span>
<span id="cb67-36"><a href="Cohorts.html#cb67-36"></a>  <span class="kw">from</span> @vocabulary_database_schema.CONCEPT c</span>
<span id="cb67-37"><a href="Cohorts.html#cb67-37"></a>  <span class="kw">join</span> @vocabulary_database_schema.CONCEPT_ANCESTOR ca <span class="kw">on</span> c.concept_id <span class="op">=</span> ca.descendant_concept_id</span>
<span id="cb67-38"><a href="Cohorts.html#cb67-38"></a>  <span class="kw">and</span> ca.ancestor_concept_id <span class="kw">in</span> (<span class="dv">1335471</span>,<span class="dv">1340128</span>,<span class="dv">1341927</span>,<span class="dv">1363749</span>,<span class="dv">1308216</span>,<span class="dv">1310756</span>,<span class="dv">1373225</span>,<span class="dv">1331235</span>,<span class="dv">1334456</span>,<span class="dv">1342439</span>)</span>
<span id="cb67-39"><a href="Cohorts.html#cb67-39"></a>  <span class="kw">and</span> c.invalid_reason <span class="kw">is</span> <span class="kw">null</span></span>
<span id="cb67-40"><a href="Cohorts.html#cb67-40"></a></span>
<span id="cb67-41"><a href="Cohorts.html#cb67-41"></a>) I</span>
<span id="cb67-42"><a href="Cohorts.html#cb67-42"></a>) C;</span>
<span id="cb67-43"><a href="Cohorts.html#cb67-43"></a></span>
<span id="cb67-44"><a href="Cohorts.html#cb67-44"></a></span>
<span id="cb67-45"><a href="Cohorts.html#cb67-45"></a><span class="kw">with</span> primary_events (event_id, person_id, start_date, end_date, op_start_date, op_end_date, visit_occurrence_id) <span class="kw">as</span></span>
<span id="cb67-46"><a href="Cohorts.html#cb67-46"></a>(</span>
<span id="cb67-47"><a href="Cohorts.html#cb67-47"></a><span class="co">-- Begin Primary Events</span></span>
<span id="cb67-48"><a href="Cohorts.html#cb67-48"></a><span class="kw">select</span> P.ordinal <span class="kw">as</span> event_id, P.person_id, P.start_date, P.end_date, op_start_date, op_end_date, <span class="fu">cast</span>(P.visit_occurrence_id <span class="kw">as</span> bigint) <span class="kw">as</span> visit_occurrence_id</span>
<span id="cb67-49"><a href="Cohorts.html#cb67-49"></a><span class="kw">FROM</span></span>
<span id="cb67-50"><a href="Cohorts.html#cb67-50"></a>(</span>
<span id="cb67-51"><a href="Cohorts.html#cb67-51"></a>  <span class="kw">select</span> E.person_id, E.start_date, E.end_date, <span class="fu">row_number</span>() <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> E.person_id <span class="kw">ORDER</span> <span class="kw">BY</span> E.start_date <span class="kw">ASC</span>) ordinal, OP.observation_period_start_date <span class="kw">as</span> op_start_date, OP.observation_period_end_date <span class="kw">as</span> op_end_date, <span class="fu">cast</span>(E.visit_occurrence_id <span class="kw">as</span> bigint) <span class="kw">as</span> visit_occurrence_id</span>
<span id="cb67-52"><a href="Cohorts.html#cb67-52"></a>  <span class="kw">FROM</span> </span>
<span id="cb67-53"><a href="Cohorts.html#cb67-53"></a>  (</span>
<span id="cb67-54"><a href="Cohorts.html#cb67-54"></a>  <span class="co">-- Begin Drug Exposure Criteria</span></span>
<span id="cb67-55"><a href="Cohorts.html#cb67-55"></a><span class="kw">select</span> C.person_id, C.drug_exposure_id <span class="kw">as</span> event_id, C.drug_exposure_start_date <span class="kw">as</span> start_date, <span class="fu">COALESCE</span>(C.drug_exposure_end_date, DATEADD(<span class="dt">day</span>, <span class="dv">1</span>, C.drug_exposure_start_date)) <span class="kw">as</span> end_date, C.drug_concept_id <span class="kw">as</span> TARGET_CONCEPT_ID, C.visit_occurrence_id</span>
<span id="cb67-56"><a href="Cohorts.html#cb67-56"></a><span class="kw">from</span> </span>
<span id="cb67-57"><a href="Cohorts.html#cb67-57"></a>(</span>
<span id="cb67-58"><a href="Cohorts.html#cb67-58"></a>  <span class="kw">select</span> de.<span class="op">*</span> , <span class="fu">row_number</span>() <span class="kw">over</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> de.person_id <span class="kw">ORDER</span> <span class="kw">BY</span> de.drug_exposure_start_date, de.drug_exposure_id) <span class="kw">as</span> ordinal</span>
<span id="cb67-59"><a href="Cohorts.html#cb67-59"></a>  <span class="kw">FROM</span> @cdm_database_schema.DRUG_EXPOSURE de</span>
<span id="cb67-60"><a href="Cohorts.html#cb67-60"></a><span class="kw">JOIN</span> #Codesets codesets <span class="kw">on</span> ((de.drug_concept_id <span class="op">=</span> codesets.concept_id <span class="kw">and</span> codesets.codeset_id <span class="op">=</span> <span class="dv">3</span>))</span>
<span id="cb67-61"><a href="Cohorts.html#cb67-61"></a>) C</span>
<span id="cb67-62"><a href="Cohorts.html#cb67-62"></a></span>
<span id="cb67-63"><a href="Cohorts.html#cb67-63"></a><span class="kw">WHERE</span> C.ordinal <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb67-64"><a href="Cohorts.html#cb67-64"></a><span class="co">-- End Drug Exposure Criteria</span></span>
<span id="cb67-65"><a href="Cohorts.html#cb67-65"></a></span>
<span id="cb67-66"><a href="Cohorts.html#cb67-66"></a>  ) E</span>
<span id="cb67-67"><a href="Cohorts.html#cb67-67"></a>    <span class="kw">JOIN</span> @cdm_database_schema.observation_period OP <span class="kw">on</span> E.person_id <span class="op">=</span> OP.person_id <span class="kw">and</span> E.start_date <span class="op">&gt;=</span>  OP.observation_period_start_date <span class="kw">and</span> E.start_date <span class="op">&lt;=</span> op.observation_period_end_date</span>
<span id="cb67-68"><a href="Cohorts.html#cb67-68"></a>  <span class="kw">WHERE</span> DATEADD(<span class="dt">day</span>,<span class="dv">365</span>,OP.OBSERVATION_PERIOD_START_DATE) <span class="op">&lt;=</span> E.START_DATE <span class="kw">AND</span> DATEADD(<span class="dt">day</span>,<span class="dv">0</span>,E.START_DATE) <span class="op">&lt;=</span> OP.OBSERVATION_PERIOD_END_DATE</span>
<span id="cb67-69"><a href="Cohorts.html#cb67-69"></a>) P</span>
<span id="cb67-70"><a href="Cohorts.html#cb67-70"></a><span class="kw">WHERE</span> P.ordinal <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb67-71"><a href="Cohorts.html#cb67-71"></a><span class="co">-- End Primary Events</span></span>
<span id="cb67-72"><a href="Cohorts.html#cb67-72"></a></span>
<span id="cb67-73"><a href="Cohorts.html#cb67-73"></a>)</span>
<span id="cb67-74"><a href="Cohorts.html#cb67-74"></a><span class="kw">SELECT</span> event_id, person_id, start_date, end_date, op_start_date, op_end_date, visit_occurrence_id</span>
<span id="cb67-75"><a href="Cohorts.html#cb67-75"></a><span class="kw">INTO</span> #qualified_events</span>
<span id="cb67-76"><a href="Cohorts.html#cb67-76"></a><span class="kw">FROM</span> </span>
<span id="cb67-77"><a href="Cohorts.html#cb67-77"></a>(</span>
<span id="cb67-78"><a href="Cohorts.html#cb67-78"></a>  <span class="kw">select</span> pe.event_id, pe.person_id, pe.start_date, pe.end_date, pe.op_start_date, pe.op_end_date, <span class="fu">row_number</span>() <span class="kw">over</span> (<span class="kw">partition</span> <span class="kw">by</span> pe.person_id <span class="kw">order</span> <span class="kw">by</span> pe.start_date <span class="kw">ASC</span>) <span class="kw">as</span> ordinal, <span class="fu">cast</span>(pe.visit_occurrence_id <span class="kw">as</span> bigint) <span class="kw">as</span> visit_occurrence_id</span>
<span id="cb67-79"><a href="Cohorts.html#cb67-79"></a>  <span class="kw">FROM</span> primary_events pe</span>
<span id="cb67-80"><a href="Cohorts.html#cb67-80"></a>  </span>
<span id="cb67-81"><a href="Cohorts.html#cb67-81"></a>) QE</span>
<span id="cb67-82"><a href="Cohorts.html#cb67-82"></a></span>
<span id="cb67-83"><a href="Cohorts.html#cb67-83"></a>;</span>
<span id="cb67-84"><a href="Cohorts.html#cb67-84"></a></span>
<span id="cb67-85"><a href="Cohorts.html#cb67-85"></a><span class="co">--- Inclusion Rule Inserts</span></span>
<span id="cb67-86"><a href="Cohorts.html#cb67-86"></a></span>
<span id="cb67-87"><a href="Cohorts.html#cb67-87"></a><span class="kw">select</span> <span class="dv">0</span> <span class="kw">as</span> inclusion_rule_id, person_id, event_id</span>
<span id="cb67-88"><a href="Cohorts.html#cb67-88"></a><span class="kw">INTO</span> #Inclusion_0</span>
<span id="cb67-89"><a href="Cohorts.html#cb67-89"></a><span class="kw">FROM</span> </span>
<span id="cb67-90"><a href="Cohorts.html#cb67-90"></a>(</span>
<span id="cb67-91"><a href="Cohorts.html#cb67-91"></a>  <span class="kw">select</span> pe.person_id, pe.event_id</span>
<span id="cb67-92"><a href="Cohorts.html#cb67-92"></a>  <span class="kw">FROM</span> #qualified_events pe</span>
<span id="cb67-93"><a href="Cohorts.html#cb67-93"></a>  </span>
<span id="cb67-94"><a href="Cohorts.html#cb67-94"></a><span class="kw">JOIN</span> (</span>
<span id="cb67-95"><a href="Cohorts.html#cb67-95"></a><span class="co">-- Begin Criteria Group</span></span>
<span id="cb67-96"><a href="Cohorts.html#cb67-96"></a><span class="kw">select</span> <span class="dv">0</span> <span class="kw">as</span> index_id, person_id, event_id</span>
<span id="cb67-97"><a href="Cohorts.html#cb67-97"></a><span class="kw">FROM</span></span>
<span id="cb67-98"><a href="Cohorts.html#cb67-98"></a>(</span>
<span id="cb67-99"><a href="Cohorts.html#cb67-99"></a>  <span class="kw">select</span> E.person_id, E.event_id </span>
<span id="cb67-100"><a href="Cohorts.html#cb67-100"></a>  <span class="kw">FROM</span> #qualified_events E</span>
<span id="cb67-101"><a href="Cohorts.html#cb67-101"></a>  <span class="kw">INNER</span> <span class="kw">JOIN</span></span>
<span id="cb67-102"><a href="Cohorts.html#cb67-102"></a>  (</span>
<span id="cb67-103"><a href="Cohorts.html#cb67-103"></a>    <span class="co">-- Begin Correlated Criteria</span></span>
<span id="cb67-104"><a href="Cohorts.html#cb67-104"></a><span class="kw">SELECT</span> <span class="dv">0</span> <span class="kw">as</span> index_id, p.person_id, p.event_id</span>
<span id="cb67-105"><a href="Cohorts.html#cb67-105"></a><span class="kw">FROM</span> #qualified_events P</span>
<span id="cb67-106"><a href="Cohorts.html#cb67-106"></a><span class="kw">INNER</span> <span class="kw">JOIN</span></span>
<span id="cb67-107"><a href="Cohorts.html#cb67-107"></a>(</span>
<span id="cb67-108"><a href="Cohorts.html#cb67-108"></a>  <span class="co">-- Begin Condition Occurrence Criteria</span></span>
<span id="cb67-109"><a href="Cohorts.html#cb67-109"></a><span class="kw">SELECT</span> C.person_id, C.condition_occurrence_id <span class="kw">as</span> event_id, C.condition_start_date <span class="kw">as</span> start_date, <span class="fu">COALESCE</span>(C.condition_end_date, DATEADD(<span class="dt">day</span>,<span class="dv">1</span>,C.condition_start_date)) <span class="kw">as</span> end_date, C.CONDITION_CONCEPT_ID <span class="kw">as</span> TARGET_CONCEPT_ID, C.visit_occurrence_id</span>
<span id="cb67-110"><a href="Cohorts.html#cb67-110"></a><span class="kw">FROM</span> </span>
<span id="cb67-111"><a href="Cohorts.html#cb67-111"></a>(</span>
<span id="cb67-112"><a href="Cohorts.html#cb67-112"></a>  <span class="kw">SELECT</span> co.<span class="op">*</span> </span>
<span id="cb67-113"><a href="Cohorts.html#cb67-113"></a>  <span class="kw">FROM</span> @cdm_database_schema.CONDITION_OCCURRENCE co</span>
<span id="cb67-114"><a href="Cohorts.html#cb67-114"></a>  <span class="kw">JOIN</span> #Codesets codesets <span class="kw">on</span> ((co.condition_concept_id <span class="op">=</span> codesets.concept_id <span class="kw">and</span> codesets.codeset_id <span class="op">=</span> <span class="dv">0</span>))</span>
<span id="cb67-115"><a href="Cohorts.html#cb67-115"></a>) C</span>
<span id="cb67-116"><a href="Cohorts.html#cb67-116"></a></span>
<span id="cb67-117"><a href="Cohorts.html#cb67-117"></a></span>
<span id="cb67-118"><a href="Cohorts.html#cb67-118"></a><span class="co">-- End Condition Occurrence Criteria</span></span>
<span id="cb67-119"><a href="Cohorts.html#cb67-119"></a></span>
<span id="cb67-120"><a href="Cohorts.html#cb67-120"></a>) A <span class="kw">on</span> A.person_id <span class="op">=</span> P.person_id  <span class="kw">AND</span> A.START_DATE <span class="op">&gt;=</span> P.OP_START_DATE <span class="kw">AND</span> A.START_DATE <span class="op">&lt;=</span> P.OP_END_DATE <span class="kw">AND</span> A.START_DATE <span class="op">&gt;=</span> DATEADD(<span class="dt">day</span>,<span class="op">-</span><span class="dv">365</span>,P.START_DATE) <span class="kw">AND</span> A.START_DATE <span class="op">&lt;=</span> DATEADD(<span class="dt">day</span>,<span class="dv">0</span>,P.START_DATE)</span>
<span id="cb67-121"><a href="Cohorts.html#cb67-121"></a><span class="kw">GROUP</span> <span class="kw">BY</span> p.person_id, p.event_id</span>
<span id="cb67-122"><a href="Cohorts.html#cb67-122"></a><span class="kw">HAVING</span> <span class="fu">COUNT</span>(A.TARGET_CONCEPT_ID) <span class="op">&gt;=</span> <span class="dv">1</span></span>
<span id="cb67-123"><a href="Cohorts.html#cb67-123"></a><span class="co">-- End Correlated Criteria</span></span>
<span id="cb67-124"><a href="Cohorts.html#cb67-124"></a></span>
<span id="cb67-125"><a href="Cohorts.html#cb67-125"></a>  ) CQ <span class="kw">on</span> E.person_id <span class="op">=</span> CQ.person_id <span class="kw">and</span> E.event_id <span class="op">=</span> CQ.event_id</span>
<span id="cb67-126"><a href="Cohorts.html#cb67-126"></a>  <span class="kw">GROUP</span> <span class="kw">BY</span> E.person_id, E.event_id</span>
<span id="cb67-127"><a href="Cohorts.html#cb67-127"></a>  <span class="kw">HAVING</span> <span class="fu">COUNT</span>(index_id) <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb67-128"><a href="Cohorts.html#cb67-128"></a>) G</span>
<span id="cb67-129"><a href="Cohorts.html#cb67-129"></a><span class="co">-- End Criteria Group</span></span>
<span id="cb67-130"><a href="Cohorts.html#cb67-130"></a>) AC <span class="kw">on</span> AC.person_id <span class="op">=</span> pe.person_id <span class="kw">AND</span> AC.event_id <span class="op">=</span> pe.event_id</span>
<span id="cb67-131"><a href="Cohorts.html#cb67-131"></a>) Results</span>
<span id="cb67-132"><a href="Cohorts.html#cb67-132"></a>;</span>
<span id="cb67-133"><a href="Cohorts.html#cb67-133"></a></span>
<span id="cb67-134"><a href="Cohorts.html#cb67-134"></a><span class="kw">select</span> <span class="dv">1</span> <span class="kw">as</span> inclusion_rule_id, person_id, event_id</span>
<span id="cb67-135"><a href="Cohorts.html#cb67-135"></a><span class="kw">INTO</span> #Inclusion_1</span>
<span id="cb67-136"><a href="Cohorts.html#cb67-136"></a><span class="kw">FROM</span> </span>
<span id="cb67-137"><a href="Cohorts.html#cb67-137"></a>(</span>
<span id="cb67-138"><a href="Cohorts.html#cb67-138"></a>  <span class="kw">select</span> pe.person_id, pe.event_id</span>
<span id="cb67-139"><a href="Cohorts.html#cb67-139"></a>  <span class="kw">FROM</span> #qualified_events pe</span>
<span id="cb67-140"><a href="Cohorts.html#cb67-140"></a>  </span>
<span id="cb67-141"><a href="Cohorts.html#cb67-141"></a><span class="kw">JOIN</span> (</span>
<span id="cb67-142"><a href="Cohorts.html#cb67-142"></a><span class="co">-- Begin Criteria Group</span></span>
<span id="cb67-143"><a href="Cohorts.html#cb67-143"></a><span class="kw">select</span> <span class="dv">0</span> <span class="kw">as</span> index_id, person_id, event_id</span>
<span id="cb67-144"><a href="Cohorts.html#cb67-144"></a><span class="kw">FROM</span></span>
<span id="cb67-145"><a href="Cohorts.html#cb67-145"></a>(</span>
<span id="cb67-146"><a href="Cohorts.html#cb67-146"></a>  <span class="kw">select</span> E.person_id, E.event_id </span>
<span id="cb67-147"><a href="Cohorts.html#cb67-147"></a>  <span class="kw">FROM</span> #qualified_events E</span>
<span id="cb67-148"><a href="Cohorts.html#cb67-148"></a>  <span class="kw">INNER</span> <span class="kw">JOIN</span></span>
<span id="cb67-149"><a href="Cohorts.html#cb67-149"></a>  (</span>
<span id="cb67-150"><a href="Cohorts.html#cb67-150"></a>    <span class="co">-- Begin Correlated Criteria</span></span>
<span id="cb67-151"><a href="Cohorts.html#cb67-151"></a><span class="kw">SELECT</span> <span class="dv">0</span> <span class="kw">as</span> index_id, p.person_id, p.event_id</span>
<span id="cb67-152"><a href="Cohorts.html#cb67-152"></a><span class="kw">FROM</span> #qualified_events P</span>
<span id="cb67-153"><a href="Cohorts.html#cb67-153"></a><span class="kw">LEFT</span> <span class="kw">JOIN</span></span>
<span id="cb67-154"><a href="Cohorts.html#cb67-154"></a>(</span>
<span id="cb67-155"><a href="Cohorts.html#cb67-155"></a>  <span class="co">-- Begin Drug Exposure Criteria</span></span>
<span id="cb67-156"><a href="Cohorts.html#cb67-156"></a><span class="kw">select</span> C.person_id, C.drug_exposure_id <span class="kw">as</span> event_id, C.drug_exposure_start_date <span class="kw">as</span> start_date, <span class="fu">COALESCE</span>(C.drug_exposure_end_date, DATEADD(<span class="dt">day</span>, <span class="dv">1</span>, C.drug_exposure_start_date)) <span class="kw">as</span> end_date, C.drug_concept_id <span class="kw">as</span> TARGET_CONCEPT_ID, C.visit_occurrence_id</span>
<span id="cb67-157"><a href="Cohorts.html#cb67-157"></a><span class="kw">from</span> </span>
<span id="cb67-158"><a href="Cohorts.html#cb67-158"></a>(</span>
<span id="cb67-159"><a href="Cohorts.html#cb67-159"></a>  <span class="kw">select</span> de.<span class="op">*</span> </span>
<span id="cb67-160"><a href="Cohorts.html#cb67-160"></a>  <span class="kw">FROM</span> @cdm_database_schema.DRUG_EXPOSURE de</span>
<span id="cb67-161"><a href="Cohorts.html#cb67-161"></a><span class="kw">JOIN</span> #Codesets codesets <span class="kw">on</span> ((de.drug_concept_id <span class="op">=</span> codesets.concept_id <span class="kw">and</span> codesets.codeset_id <span class="op">=</span> <span class="dv">2</span>))</span>
<span id="cb67-162"><a href="Cohorts.html#cb67-162"></a>) C</span>
<span id="cb67-163"><a href="Cohorts.html#cb67-163"></a></span>
<span id="cb67-164"><a href="Cohorts.html#cb67-164"></a></span>
<span id="cb67-165"><a href="Cohorts.html#cb67-165"></a><span class="co">-- End Drug Exposure Criteria</span></span>
<span id="cb67-166"><a href="Cohorts.html#cb67-166"></a></span>
<span id="cb67-167"><a href="Cohorts.html#cb67-167"></a>) A <span class="kw">on</span> A.person_id <span class="op">=</span> P.person_id  <span class="kw">AND</span> A.START_DATE <span class="op">&gt;=</span> P.OP_START_DATE <span class="kw">AND</span> A.START_DATE <span class="op">&lt;=</span> P.OP_END_DATE <span class="kw">AND</span> A.START_DATE <span class="op">&gt;=</span> P.OP_START_DATE <span class="kw">AND</span> A.START_DATE <span class="op">&lt;=</span> DATEADD(<span class="dt">day</span>,<span class="op">-</span><span class="dv">1</span>,P.START_DATE)</span>
<span id="cb67-168"><a href="Cohorts.html#cb67-168"></a><span class="kw">GROUP</span> <span class="kw">BY</span> p.person_id, p.event_id</span>
<span id="cb67-169"><a href="Cohorts.html#cb67-169"></a><span class="kw">HAVING</span> <span class="fu">COUNT</span>(A.TARGET_CONCEPT_ID) <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb67-170"><a href="Cohorts.html#cb67-170"></a><span class="co">-- End Correlated Criteria</span></span>
<span id="cb67-171"><a href="Cohorts.html#cb67-171"></a></span>
<span id="cb67-172"><a href="Cohorts.html#cb67-172"></a>  ) CQ <span class="kw">on</span> E.person_id <span class="op">=</span> CQ.person_id <span class="kw">and</span> E.event_id <span class="op">=</span> CQ.event_id</span>
<span id="cb67-173"><a href="Cohorts.html#cb67-173"></a>  <span class="kw">GROUP</span> <span class="kw">BY</span> E.person_id, E.event_id</span>
<span id="cb67-174"><a href="Cohorts.html#cb67-174"></a>  <span class="kw">HAVING</span> <span class="fu">COUNT</span>(index_id) <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb67-175"><a href="Cohorts.html#cb67-175"></a>) G</span>
<span id="cb67-176"><a href="Cohorts.html#cb67-176"></a><span class="co">-- End Criteria Group</span></span>
<span id="cb67-177"><a href="Cohorts.html#cb67-177"></a>) AC <span class="kw">on</span> AC.person_id <span class="op">=</span> pe.person_id <span class="kw">AND</span> AC.event_id <span class="op">=</span> pe.event_id</span>
<span id="cb67-178"><a href="Cohorts.html#cb67-178"></a>) Results</span>
<span id="cb67-179"><a href="Cohorts.html#cb67-179"></a>;</span>
<span id="cb67-180"><a href="Cohorts.html#cb67-180"></a></span>
<span id="cb67-181"><a href="Cohorts.html#cb67-181"></a><span class="kw">select</span> <span class="dv">2</span> <span class="kw">as</span> inclusion_rule_id, person_id, event_id</span>
<span id="cb67-182"><a href="Cohorts.html#cb67-182"></a><span class="kw">INTO</span> #Inclusion_2</span>
<span id="cb67-183"><a href="Cohorts.html#cb67-183"></a><span class="kw">FROM</span> </span>
<span id="cb67-184"><a href="Cohorts.html#cb67-184"></a>(</span>
<span id="cb67-185"><a href="Cohorts.html#cb67-185"></a>  <span class="kw">select</span> pe.person_id, pe.event_id</span>
<span id="cb67-186"><a href="Cohorts.html#cb67-186"></a>  <span class="kw">FROM</span> #qualified_events pe</span>
<span id="cb67-187"><a href="Cohorts.html#cb67-187"></a>  </span>
<span id="cb67-188"><a href="Cohorts.html#cb67-188"></a><span class="kw">JOIN</span> (</span>
<span id="cb67-189"><a href="Cohorts.html#cb67-189"></a><span class="co">-- Begin Criteria Group</span></span>
<span id="cb67-190"><a href="Cohorts.html#cb67-190"></a><span class="kw">select</span> <span class="dv">0</span> <span class="kw">as</span> index_id, person_id, event_id</span>
<span id="cb67-191"><a href="Cohorts.html#cb67-191"></a><span class="kw">FROM</span></span>
<span id="cb67-192"><a href="Cohorts.html#cb67-192"></a>(</span>
<span id="cb67-193"><a href="Cohorts.html#cb67-193"></a>  <span class="kw">select</span> E.person_id, E.event_id </span>
<span id="cb67-194"><a href="Cohorts.html#cb67-194"></a>  <span class="kw">FROM</span> #qualified_events E</span>
<span id="cb67-195"><a href="Cohorts.html#cb67-195"></a>  <span class="kw">INNER</span> <span class="kw">JOIN</span></span>
<span id="cb67-196"><a href="Cohorts.html#cb67-196"></a>  (</span>
<span id="cb67-197"><a href="Cohorts.html#cb67-197"></a>    <span class="co">-- Begin Correlated Criteria</span></span>
<span id="cb67-198"><a href="Cohorts.html#cb67-198"></a><span class="kw">SELECT</span> <span class="dv">0</span> <span class="kw">as</span> index_id, p.person_id, p.event_id</span>
<span id="cb67-199"><a href="Cohorts.html#cb67-199"></a><span class="kw">FROM</span> #qualified_events P</span>
<span id="cb67-200"><a href="Cohorts.html#cb67-200"></a><span class="kw">INNER</span> <span class="kw">JOIN</span></span>
<span id="cb67-201"><a href="Cohorts.html#cb67-201"></a>(</span>
<span id="cb67-202"><a href="Cohorts.html#cb67-202"></a>  <span class="co">-- Begin Drug Era Criteria</span></span>
<span id="cb67-203"><a href="Cohorts.html#cb67-203"></a><span class="kw">select</span> C.person_id, C.drug_era_id <span class="kw">as</span> event_id, C.drug_era_start_date <span class="kw">as</span> start_date, C.drug_era_end_date <span class="kw">as</span> end_date, C.drug_concept_id <span class="kw">as</span> TARGET_CONCEPT_ID, <span class="fu">CAST</span>(<span class="kw">NULL</span> <span class="kw">as</span> bigint) <span class="kw">as</span> visit_occurrence_id</span>
<span id="cb67-204"><a href="Cohorts.html#cb67-204"></a><span class="kw">from</span> </span>
<span id="cb67-205"><a href="Cohorts.html#cb67-205"></a>(</span>
<span id="cb67-206"><a href="Cohorts.html#cb67-206"></a>  <span class="kw">select</span> de.<span class="op">*</span> </span>
<span id="cb67-207"><a href="Cohorts.html#cb67-207"></a>  <span class="kw">FROM</span> @cdm_database_schema.DRUG_ERA de</span>
<span id="cb67-208"><a href="Cohorts.html#cb67-208"></a><span class="kw">where</span> de.drug_concept_id <span class="kw">in</span> (<span class="kw">SELECT</span> concept_id <span class="kw">from</span>  #Codesets <span class="kw">where</span> codeset_id <span class="op">=</span> <span class="dv">2</span>)</span>
<span id="cb67-209"><a href="Cohorts.html#cb67-209"></a>) C</span>
<span id="cb67-210"><a href="Cohorts.html#cb67-210"></a></span>
<span id="cb67-211"><a href="Cohorts.html#cb67-211"></a></span>
<span id="cb67-212"><a href="Cohorts.html#cb67-212"></a><span class="co">-- End Drug Era Criteria</span></span>
<span id="cb67-213"><a href="Cohorts.html#cb67-213"></a></span>
<span id="cb67-214"><a href="Cohorts.html#cb67-214"></a>) A <span class="kw">on</span> A.person_id <span class="op">=</span> P.person_id  <span class="kw">AND</span> A.START_DATE <span class="op">&gt;=</span> P.OP_START_DATE <span class="kw">AND</span> A.START_DATE <span class="op">&lt;=</span> P.OP_END_DATE <span class="kw">AND</span> A.START_DATE <span class="op">&gt;=</span> DATEADD(<span class="dt">day</span>,<span class="dv">0</span>,P.START_DATE) <span class="kw">AND</span> A.START_DATE <span class="op">&lt;=</span> DATEADD(<span class="dt">day</span>,<span class="dv">7</span>,P.START_DATE)</span>
<span id="cb67-215"><a href="Cohorts.html#cb67-215"></a><span class="kw">GROUP</span> <span class="kw">BY</span> p.person_id, p.event_id</span>
<span id="cb67-216"><a href="Cohorts.html#cb67-216"></a><span class="kw">HAVING</span> <span class="fu">COUNT</span>(<span class="kw">DISTINCT</span> A.TARGET_CONCEPT_ID) <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb67-217"><a href="Cohorts.html#cb67-217"></a><span class="co">-- End Correlated Criteria</span></span>
<span id="cb67-218"><a href="Cohorts.html#cb67-218"></a></span>
<span id="cb67-219"><a href="Cohorts.html#cb67-219"></a>  ) CQ <span class="kw">on</span> E.person_id <span class="op">=</span> CQ.person_id <span class="kw">and</span> E.event_id <span class="op">=</span> CQ.event_id</span>
<span id="cb67-220"><a href="Cohorts.html#cb67-220"></a>  <span class="kw">GROUP</span> <span class="kw">BY</span> E.person_id, E.event_id</span>
<span id="cb67-221"><a href="Cohorts.html#cb67-221"></a>  <span class="kw">HAVING</span> <span class="fu">COUNT</span>(index_id) <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb67-222"><a href="Cohorts.html#cb67-222"></a>) G</span>
<span id="cb67-223"><a href="Cohorts.html#cb67-223"></a><span class="co">-- End Criteria Group</span></span>
<span id="cb67-224"><a href="Cohorts.html#cb67-224"></a>) AC <span class="kw">on</span> AC.person_id <span class="op">=</span> pe.person_id <span class="kw">AND</span> AC.event_id <span class="op">=</span> pe.event_id</span>
<span id="cb67-225"><a href="Cohorts.html#cb67-225"></a>) Results</span>
<span id="cb67-226"><a href="Cohorts.html#cb67-226"></a>;</span>
<span id="cb67-227"><a href="Cohorts.html#cb67-227"></a></span>
<span id="cb67-228"><a href="Cohorts.html#cb67-228"></a><span class="kw">SELECT</span> inclusion_rule_id, person_id, event_id</span>
<span id="cb67-229"><a href="Cohorts.html#cb67-229"></a><span class="kw">INTO</span> #inclusion_events</span>
<span id="cb67-230"><a href="Cohorts.html#cb67-230"></a><span class="kw">FROM</span> (<span class="kw">select</span> inclusion_rule_id, person_id, event_id <span class="kw">from</span> #Inclusion_0</span>
<span id="cb67-231"><a href="Cohorts.html#cb67-231"></a><span class="kw">UNION</span> <span class="kw">ALL</span></span>
<span id="cb67-232"><a href="Cohorts.html#cb67-232"></a><span class="kw">select</span> inclusion_rule_id, person_id, event_id <span class="kw">from</span> #Inclusion_1</span>
<span id="cb67-233"><a href="Cohorts.html#cb67-233"></a><span class="kw">UNION</span> <span class="kw">ALL</span></span>
<span id="cb67-234"><a href="Cohorts.html#cb67-234"></a><span class="kw">select</span> inclusion_rule_id, person_id, event_id <span class="kw">from</span> #Inclusion_2) I;</span>
<span id="cb67-235"><a href="Cohorts.html#cb67-235"></a><span class="kw">TRUNCATE</span> <span class="kw">TABLE</span> #Inclusion_0;</span>
<span id="cb67-236"><a href="Cohorts.html#cb67-236"></a><span class="kw">DROP</span> <span class="kw">TABLE</span> #Inclusion_0;</span>
<span id="cb67-237"><a href="Cohorts.html#cb67-237"></a></span>
<span id="cb67-238"><a href="Cohorts.html#cb67-238"></a><span class="kw">TRUNCATE</span> <span class="kw">TABLE</span> #Inclusion_1;</span>
<span id="cb67-239"><a href="Cohorts.html#cb67-239"></a><span class="kw">DROP</span> <span class="kw">TABLE</span> #Inclusion_1;</span>
<span id="cb67-240"><a href="Cohorts.html#cb67-240"></a></span>
<span id="cb67-241"><a href="Cohorts.html#cb67-241"></a><span class="kw">TRUNCATE</span> <span class="kw">TABLE</span> #Inclusion_2;</span>
<span id="cb67-242"><a href="Cohorts.html#cb67-242"></a><span class="kw">DROP</span> <span class="kw">TABLE</span> #Inclusion_2;</span>
<span id="cb67-243"><a href="Cohorts.html#cb67-243"></a></span>
<span id="cb67-244"><a href="Cohorts.html#cb67-244"></a></span>
<span id="cb67-245"><a href="Cohorts.html#cb67-245"></a><span class="kw">with</span> cteIncludedEvents(event_id, person_id, start_date, end_date, op_start_date, op_end_date, ordinal) <span class="kw">as</span></span>
<span id="cb67-246"><a href="Cohorts.html#cb67-246"></a>(</span>
<span id="cb67-247"><a href="Cohorts.html#cb67-247"></a>  <span class="kw">SELECT</span> event_id, person_id, start_date, end_date, op_start_date, op_end_date, <span class="fu">row_number</span>() <span class="kw">over</span> (<span class="kw">partition</span> <span class="kw">by</span> person_id <span class="kw">order</span> <span class="kw">by</span> start_date <span class="kw">ASC</span>) <span class="kw">as</span> ordinal</span>
<span id="cb67-248"><a href="Cohorts.html#cb67-248"></a>  <span class="kw">from</span></span>
<span id="cb67-249"><a href="Cohorts.html#cb67-249"></a>  (</span>
<span id="cb67-250"><a href="Cohorts.html#cb67-250"></a>    <span class="kw">select</span> Q.event_id, Q.person_id, Q.start_date, Q.end_date, Q.op_start_date, Q.op_end_date, <span class="fu">SUM</span>(<span class="fu">coalesce</span>(<span class="fu">POWER</span>(<span class="fu">cast</span>(<span class="dv">2</span> <span class="kw">as</span> bigint), I.inclusion_rule_id), <span class="dv">0</span>)) <span class="kw">as</span> inclusion_rule_mask</span>
<span id="cb67-251"><a href="Cohorts.html#cb67-251"></a>    <span class="kw">from</span> #qualified_events Q</span>
<span id="cb67-252"><a href="Cohorts.html#cb67-252"></a>    <span class="kw">LEFT</span> <span class="kw">JOIN</span> #inclusion_events I <span class="kw">on</span> I.person_id <span class="op">=</span> Q.person_id <span class="kw">and</span> I.event_id <span class="op">=</span> Q.event_id</span>
<span id="cb67-253"><a href="Cohorts.html#cb67-253"></a>    <span class="kw">GROUP</span> <span class="kw">BY</span> Q.event_id, Q.person_id, Q.start_date, Q.end_date, Q.op_start_date, Q.op_end_date</span>
<span id="cb67-254"><a href="Cohorts.html#cb67-254"></a>  ) MG <span class="co">-- matching groups</span></span>
<span id="cb67-255"><a href="Cohorts.html#cb67-255"></a></span>
<span id="cb67-256"><a href="Cohorts.html#cb67-256"></a>  <span class="co">-- the matching group with all bits set ( POWER(2,# of inclusion rules) - 1 = inclusion_rule_mask</span></span>
<span id="cb67-257"><a href="Cohorts.html#cb67-257"></a>  <span class="kw">WHERE</span> (MG.inclusion_rule_mask <span class="op">=</span> <span class="fu">POWER</span>(<span class="fu">cast</span>(<span class="dv">2</span> <span class="kw">as</span> bigint),<span class="dv">3</span>)<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb67-258"><a href="Cohorts.html#cb67-258"></a></span>
<span id="cb67-259"><a href="Cohorts.html#cb67-259"></a>)</span>
<span id="cb67-260"><a href="Cohorts.html#cb67-260"></a><span class="kw">select</span> event_id, person_id, start_date, end_date, op_start_date, op_end_date</span>
<span id="cb67-261"><a href="Cohorts.html#cb67-261"></a><span class="kw">into</span> #included_events</span>
<span id="cb67-262"><a href="Cohorts.html#cb67-262"></a><span class="kw">FROM</span> cteIncludedEvents Results</span>
<span id="cb67-263"><a href="Cohorts.html#cb67-263"></a><span class="kw">WHERE</span> Results.ordinal <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb67-264"><a href="Cohorts.html#cb67-264"></a>;</span>
<span id="cb67-265"><a href="Cohorts.html#cb67-265"></a></span>
<span id="cb67-266"><a href="Cohorts.html#cb67-266"></a><span class="co">-- custom era strategy</span></span>
<span id="cb67-267"><a href="Cohorts.html#cb67-267"></a></span>
<span id="cb67-268"><a href="Cohorts.html#cb67-268"></a><span class="kw">with</span> ctePersons(person_id) <span class="kw">as</span> (</span>
<span id="cb67-269"><a href="Cohorts.html#cb67-269"></a>    <span class="kw">select</span> <span class="kw">distinct</span> person_id <span class="kw">from</span> #included_events</span>
<span id="cb67-270"><a href="Cohorts.html#cb67-270"></a>)</span>
<span id="cb67-271"><a href="Cohorts.html#cb67-271"></a></span>
<span id="cb67-272"><a href="Cohorts.html#cb67-272"></a><span class="kw">select</span> person_id, drug_exposure_start_date, drug_exposure_end_date</span>
<span id="cb67-273"><a href="Cohorts.html#cb67-273"></a><span class="kw">INTO</span> #drugTarget</span>
<span id="cb67-274"><a href="Cohorts.html#cb67-274"></a><span class="kw">FROM</span> (</span>
<span id="cb67-275"><a href="Cohorts.html#cb67-275"></a>    <span class="kw">select</span> de.PERSON_ID, DRUG_EXPOSURE_START_DATE,  <span class="fu">COALESCE</span>(DRUG_EXPOSURE_END_DATE, DATEADD(<span class="dt">day</span>,DAYS_SUPPLY,DRUG_EXPOSURE_START_DATE), DATEADD(<span class="dt">day</span>,<span class="dv">1</span>,DRUG_EXPOSURE_START_DATE)) <span class="kw">as</span> DRUG_EXPOSURE_END_DATE </span>
<span id="cb67-276"><a href="Cohorts.html#cb67-276"></a>    <span class="kw">FROM</span> @cdm_database_schema.DRUG_EXPOSURE de</span>
<span id="cb67-277"><a href="Cohorts.html#cb67-277"></a>    <span class="kw">JOIN</span> ctePersons p <span class="kw">on</span> de.person_id <span class="op">=</span> p.person_id</span>
<span id="cb67-278"><a href="Cohorts.html#cb67-278"></a>    <span class="kw">JOIN</span> #Codesets cs <span class="kw">on</span> cs.codeset_id <span class="op">=</span> <span class="dv">3</span> <span class="kw">AND</span> de.drug_concept_id <span class="op">=</span> cs.concept_id</span>
<span id="cb67-279"><a href="Cohorts.html#cb67-279"></a></span>
<span id="cb67-280"><a href="Cohorts.html#cb67-280"></a>    <span class="kw">UNION</span> <span class="kw">ALL</span></span>
<span id="cb67-281"><a href="Cohorts.html#cb67-281"></a></span>
<span id="cb67-282"><a href="Cohorts.html#cb67-282"></a>    <span class="kw">select</span> de.PERSON_ID, DRUG_EXPOSURE_START_DATE,  <span class="fu">COALESCE</span>(DRUG_EXPOSURE_END_DATE, DATEADD(<span class="dt">day</span>,DAYS_SUPPLY,DRUG_EXPOSURE_START_DATE), DATEADD(<span class="dt">day</span>,<span class="dv">1</span>,DRUG_EXPOSURE_START_DATE)) <span class="kw">as</span> DRUG_EXPOSURE_END_DATE </span>
<span id="cb67-283"><a href="Cohorts.html#cb67-283"></a>    <span class="kw">FROM</span> @cdm_database_schema.DRUG_EXPOSURE de</span>
<span id="cb67-284"><a href="Cohorts.html#cb67-284"></a>    <span class="kw">JOIN</span> ctePersons p <span class="kw">on</span> de.person_id <span class="op">=</span> p.person_id</span>
<span id="cb67-285"><a href="Cohorts.html#cb67-285"></a>    <span class="kw">JOIN</span> #Codesets cs <span class="kw">on</span> cs.codeset_id <span class="op">=</span> <span class="dv">3</span> <span class="kw">AND</span> de.drug_source_concept_id <span class="op">=</span> cs.concept_id</span>
<span id="cb67-286"><a href="Cohorts.html#cb67-286"></a>) E</span>
<span id="cb67-287"><a href="Cohorts.html#cb67-287"></a>;</span>
<span id="cb67-288"><a href="Cohorts.html#cb67-288"></a></span>
<span id="cb67-289"><a href="Cohorts.html#cb67-289"></a><span class="kw">select</span> et.event_id, et.person_id, ERAS.era_end_date <span class="kw">as</span> end_date</span>
<span id="cb67-290"><a href="Cohorts.html#cb67-290"></a><span class="kw">INTO</span> #strategy_ends</span>
<span id="cb67-291"><a href="Cohorts.html#cb67-291"></a><span class="kw">from</span> #included_events et</span>
<span id="cb67-292"><a href="Cohorts.html#cb67-292"></a><span class="kw">JOIN</span> </span>
<span id="cb67-293"><a href="Cohorts.html#cb67-293"></a>(</span>
<span id="cb67-294"><a href="Cohorts.html#cb67-294"></a>  <span class="kw">select</span> ENDS.person_id, <span class="fu">min</span>(drug_exposure_start_date) <span class="kw">as</span> era_start_date, DATEADD(<span class="dt">day</span>,<span class="dv">0</span>, ENDS.era_end_date) <span class="kw">as</span> era_end_date</span>
<span id="cb67-295"><a href="Cohorts.html#cb67-295"></a>  <span class="kw">from</span></span>
<span id="cb67-296"><a href="Cohorts.html#cb67-296"></a>  (</span>
<span id="cb67-297"><a href="Cohorts.html#cb67-297"></a>    <span class="kw">select</span> de.person_id, de.drug_exposure_start_date, <span class="fu">MIN</span>(e.END_DATE) <span class="kw">as</span> era_end_date</span>
<span id="cb67-298"><a href="Cohorts.html#cb67-298"></a>    <span class="kw">FROM</span> #drugTarget DE</span>
<span id="cb67-299"><a href="Cohorts.html#cb67-299"></a>    <span class="kw">JOIN</span> </span>
<span id="cb67-300"><a href="Cohorts.html#cb67-300"></a>    (</span>
<span id="cb67-301"><a href="Cohorts.html#cb67-301"></a>      <span class="co">--cteEndDates</span></span>
<span id="cb67-302"><a href="Cohorts.html#cb67-302"></a>      <span class="kw">select</span> PERSON_ID, DATEADD(<span class="dt">day</span>,<span class="op">-</span><span class="dv">1</span> <span class="op">*</span> <span class="dv">30</span>,EVENT_DATE) <span class="kw">as</span> END_DATE <span class="co">-- unpad the end date by 30</span></span>
<span id="cb67-303"><a href="Cohorts.html#cb67-303"></a>      <span class="kw">FROM</span></span>
<span id="cb67-304"><a href="Cohorts.html#cb67-304"></a>      (</span>
<span id="cb67-305"><a href="Cohorts.html#cb67-305"></a>                <span class="kw">select</span> PERSON_ID, EVENT_DATE, EVENT_TYPE, </span>
<span id="cb67-306"><a href="Cohorts.html#cb67-306"></a>                <span class="fu">MAX</span>(START_ORDINAL) <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> PERSON_ID <span class="kw">ORDER</span> <span class="kw">BY</span> event_date, event_type <span class="kw">ROWS</span> <span class="kw">UNBOUNDED</span> <span class="kw">PRECEDING</span>) <span class="kw">AS</span> start_ordinal,</span>
<span id="cb67-307"><a href="Cohorts.html#cb67-307"></a>                <span class="fu">ROW_NUMBER</span>() <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> PERSON_ID <span class="kw">ORDER</span> <span class="kw">BY</span> EVENT_DATE, EVENT_TYPE) <span class="kw">AS</span> OVERALL_ORD <span class="co">-- this re-numbers the inner UNION so all rows are numbered ordered by the event date</span></span>
<span id="cb67-308"><a href="Cohorts.html#cb67-308"></a>                <span class="kw">from</span></span>
<span id="cb67-309"><a href="Cohorts.html#cb67-309"></a>                (</span>
<span id="cb67-310"><a href="Cohorts.html#cb67-310"></a>                    <span class="co">-- select the start dates, assigning a row number to each</span></span>
<span id="cb67-311"><a href="Cohorts.html#cb67-311"></a>                    <span class="kw">Select</span> PERSON_ID, DRUG_EXPOSURE_START_DATE <span class="kw">AS</span> EVENT_DATE, <span class="dv">0</span> <span class="kw">as</span> EVENT_TYPE, <span class="fu">ROW_NUMBER</span>() <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> PERSON_ID <span class="kw">ORDER</span> <span class="kw">BY</span> DRUG_EXPOSURE_START_DATE) <span class="kw">as</span> START_ORDINAL</span>
<span id="cb67-312"><a href="Cohorts.html#cb67-312"></a>                    <span class="kw">from</span> #drugTarget D</span>
<span id="cb67-313"><a href="Cohorts.html#cb67-313"></a></span>
<span id="cb67-314"><a href="Cohorts.html#cb67-314"></a>                    <span class="kw">UNION</span> <span class="kw">ALL</span></span>
<span id="cb67-315"><a href="Cohorts.html#cb67-315"></a></span>
<span id="cb67-316"><a href="Cohorts.html#cb67-316"></a>                    <span class="co">-- add the end dates with NULL as the row number, padding the end dates by 30 to allow a grace period for overlapping ranges.</span></span>
<span id="cb67-317"><a href="Cohorts.html#cb67-317"></a>                    <span class="kw">select</span> PERSON_ID, DATEADD(<span class="dt">day</span>,<span class="dv">30</span>,DRUG_EXPOSURE_END_DATE), <span class="dv">1</span> <span class="kw">as</span> EVENT_TYPE, <span class="kw">NULL</span></span>
<span id="cb67-318"><a href="Cohorts.html#cb67-318"></a>                    <span class="kw">FROM</span> #drugTarget D</span>
<span id="cb67-319"><a href="Cohorts.html#cb67-319"></a>                ) RAWDATA</span>
<span id="cb67-320"><a href="Cohorts.html#cb67-320"></a>      ) E</span>
<span id="cb67-321"><a href="Cohorts.html#cb67-321"></a>      <span class="kw">WHERE</span> <span class="dv">2</span> <span class="op">*</span> E.START_ORDINAL <span class="op">-</span> E.OVERALL_ORD <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb67-322"><a href="Cohorts.html#cb67-322"></a>    ) E <span class="kw">on</span> DE.PERSON_ID <span class="op">=</span> E.PERSON_ID <span class="kw">and</span> E.END_DATE <span class="op">&gt;=</span> DE.DRUG_EXPOSURE_START_DATE</span>
<span id="cb67-323"><a href="Cohorts.html#cb67-323"></a>    <span class="kw">GROUP</span> <span class="kw">BY</span> de.person_id, de.drug_exposure_start_date</span>
<span id="cb67-324"><a href="Cohorts.html#cb67-324"></a>  ) ENDS</span>
<span id="cb67-325"><a href="Cohorts.html#cb67-325"></a>  <span class="kw">GROUP</span> <span class="kw">BY</span> ENDS.person_id, ENDS.era_end_date</span>
<span id="cb67-326"><a href="Cohorts.html#cb67-326"></a>) ERAS <span class="kw">on</span> ERAS.person_id <span class="op">=</span> et.person_id </span>
<span id="cb67-327"><a href="Cohorts.html#cb67-327"></a><span class="kw">WHERE</span> et.start_date <span class="kw">between</span> ERAS.era_start_date <span class="kw">and</span> ERAS.era_end_date;</span>
<span id="cb67-328"><a href="Cohorts.html#cb67-328"></a></span>
<span id="cb67-329"><a href="Cohorts.html#cb67-329"></a><span class="kw">TRUNCATE</span> <span class="kw">TABLE</span> #drugTarget;</span>
<span id="cb67-330"><a href="Cohorts.html#cb67-330"></a><span class="kw">DROP</span> <span class="kw">TABLE</span> #drugTarget;</span>
<span id="cb67-331"><a href="Cohorts.html#cb67-331"></a></span>
<span id="cb67-332"><a href="Cohorts.html#cb67-332"></a></span>
<span id="cb67-333"><a href="Cohorts.html#cb67-333"></a><span class="co">-- generate cohort periods into #final_cohort</span></span>
<span id="cb67-334"><a href="Cohorts.html#cb67-334"></a><span class="kw">with</span> cohort_ends (event_id, person_id, end_date) <span class="kw">as</span></span>
<span id="cb67-335"><a href="Cohorts.html#cb67-335"></a>(</span>
<span id="cb67-336"><a href="Cohorts.html#cb67-336"></a>    <span class="co">-- cohort exit dates</span></span>
<span id="cb67-337"><a href="Cohorts.html#cb67-337"></a>  <span class="co">-- By default, cohort exit at the event&#39;s op end date</span></span>
<span id="cb67-338"><a href="Cohorts.html#cb67-338"></a><span class="kw">select</span> event_id, person_id, op_end_date <span class="kw">as</span> end_date <span class="kw">from</span> #included_events</span>
<span id="cb67-339"><a href="Cohorts.html#cb67-339"></a><span class="kw">UNION</span> <span class="kw">ALL</span></span>
<span id="cb67-340"><a href="Cohorts.html#cb67-340"></a><span class="co">-- End Date Strategy</span></span>
<span id="cb67-341"><a href="Cohorts.html#cb67-341"></a><span class="kw">SELECT</span> event_id, person_id, end_date <span class="kw">from</span> #strategy_ends</span>
<span id="cb67-342"><a href="Cohorts.html#cb67-342"></a></span>
<span id="cb67-343"><a href="Cohorts.html#cb67-343"></a>),</span>
<span id="cb67-344"><a href="Cohorts.html#cb67-344"></a>first_ends (person_id, start_date, end_date) <span class="kw">as</span></span>
<span id="cb67-345"><a href="Cohorts.html#cb67-345"></a>(</span>
<span id="cb67-346"><a href="Cohorts.html#cb67-346"></a>    <span class="kw">select</span> F.person_id, F.start_date, F.end_date</span>
<span id="cb67-347"><a href="Cohorts.html#cb67-347"></a>    <span class="kw">FROM</span> (</span>
<span id="cb67-348"><a href="Cohorts.html#cb67-348"></a>      <span class="kw">select</span> I.event_id, I.person_id, I.start_date, E.end_date, <span class="fu">row_number</span>() <span class="kw">over</span> (<span class="kw">partition</span> <span class="kw">by</span> I.person_id, I.event_id <span class="kw">order</span> <span class="kw">by</span> E.end_date) <span class="kw">as</span> ordinal </span>
<span id="cb67-349"><a href="Cohorts.html#cb67-349"></a>      <span class="kw">from</span> #included_events I</span>
<span id="cb67-350"><a href="Cohorts.html#cb67-350"></a>      <span class="kw">join</span> cohort_ends E <span class="kw">on</span> I.event_id <span class="op">=</span> E.event_id <span class="kw">and</span> I.person_id <span class="op">=</span> E.person_id <span class="kw">and</span> E.end_date <span class="op">&gt;=</span> I.start_date</span>
<span id="cb67-351"><a href="Cohorts.html#cb67-351"></a>    ) F</span>
<span id="cb67-352"><a href="Cohorts.html#cb67-352"></a>    <span class="kw">WHERE</span> F.ordinal <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb67-353"><a href="Cohorts.html#cb67-353"></a>)</span>
<span id="cb67-354"><a href="Cohorts.html#cb67-354"></a><span class="kw">select</span> person_id, start_date, end_date</span>
<span id="cb67-355"><a href="Cohorts.html#cb67-355"></a><span class="kw">INTO</span> #cohort_rows</span>
<span id="cb67-356"><a href="Cohorts.html#cb67-356"></a><span class="kw">from</span> first_ends;</span>
<span id="cb67-357"><a href="Cohorts.html#cb67-357"></a></span>
<span id="cb67-358"><a href="Cohorts.html#cb67-358"></a><span class="kw">with</span> cteEndDates (person_id, end_date) <span class="kw">AS</span> <span class="co">-- the magic</span></span>
<span id="cb67-359"><a href="Cohorts.html#cb67-359"></a>(   </span>
<span id="cb67-360"><a href="Cohorts.html#cb67-360"></a>    <span class="kw">SELECT</span></span>
<span id="cb67-361"><a href="Cohorts.html#cb67-361"></a>        person_id</span>
<span id="cb67-362"><a href="Cohorts.html#cb67-362"></a>        , DATEADD(<span class="dt">day</span>,<span class="op">-</span><span class="dv">1</span> <span class="op">*</span> <span class="dv">0</span>, event_date)  <span class="kw">as</span> end_date</span>
<span id="cb67-363"><a href="Cohorts.html#cb67-363"></a>    <span class="kw">FROM</span></span>
<span id="cb67-364"><a href="Cohorts.html#cb67-364"></a>    (</span>
<span id="cb67-365"><a href="Cohorts.html#cb67-365"></a>        <span class="kw">SELECT</span></span>
<span id="cb67-366"><a href="Cohorts.html#cb67-366"></a>            person_id</span>
<span id="cb67-367"><a href="Cohorts.html#cb67-367"></a>            , event_date</span>
<span id="cb67-368"><a href="Cohorts.html#cb67-368"></a>            , event_type</span>
<span id="cb67-369"><a href="Cohorts.html#cb67-369"></a>            , <span class="fu">MAX</span>(start_ordinal) <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> person_id <span class="kw">ORDER</span> <span class="kw">BY</span> event_date, event_type <span class="kw">ROWS</span> <span class="kw">UNBOUNDED</span> <span class="kw">PRECEDING</span>) <span class="kw">AS</span> start_ordinal </span>
<span id="cb67-370"><a href="Cohorts.html#cb67-370"></a>            , <span class="fu">ROW_NUMBER</span>() <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> person_id <span class="kw">ORDER</span> <span class="kw">BY</span> event_date, event_type) <span class="kw">AS</span> overall_ord</span>
<span id="cb67-371"><a href="Cohorts.html#cb67-371"></a>        <span class="kw">FROM</span></span>
<span id="cb67-372"><a href="Cohorts.html#cb67-372"></a>        (</span>
<span id="cb67-373"><a href="Cohorts.html#cb67-373"></a>            <span class="kw">SELECT</span></span>
<span id="cb67-374"><a href="Cohorts.html#cb67-374"></a>                person_id</span>
<span id="cb67-375"><a href="Cohorts.html#cb67-375"></a>                , start_date <span class="kw">AS</span> event_date</span>
<span id="cb67-376"><a href="Cohorts.html#cb67-376"></a>                , <span class="op">-</span><span class="dv">1</span> <span class="kw">AS</span> event_type</span>
<span id="cb67-377"><a href="Cohorts.html#cb67-377"></a>                , <span class="fu">ROW_NUMBER</span>() <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> person_id <span class="kw">ORDER</span> <span class="kw">BY</span> start_date) <span class="kw">AS</span> start_ordinal</span>
<span id="cb67-378"><a href="Cohorts.html#cb67-378"></a>            <span class="kw">FROM</span> #cohort_rows</span>
<span id="cb67-379"><a href="Cohorts.html#cb67-379"></a>        </span>
<span id="cb67-380"><a href="Cohorts.html#cb67-380"></a>            <span class="kw">UNION</span> <span class="kw">ALL</span></span>
<span id="cb67-381"><a href="Cohorts.html#cb67-381"></a>        </span>
<span id="cb67-382"><a href="Cohorts.html#cb67-382"></a></span>
<span id="cb67-383"><a href="Cohorts.html#cb67-383"></a>            <span class="kw">SELECT</span></span>
<span id="cb67-384"><a href="Cohorts.html#cb67-384"></a>                person_id</span>
<span id="cb67-385"><a href="Cohorts.html#cb67-385"></a>                , DATEADD(<span class="dt">day</span>,<span class="dv">0</span>,end_date) <span class="kw">as</span> end_date</span>
<span id="cb67-386"><a href="Cohorts.html#cb67-386"></a>                , <span class="dv">1</span> <span class="kw">AS</span> event_type</span>
<span id="cb67-387"><a href="Cohorts.html#cb67-387"></a>                , <span class="kw">NULL</span></span>
<span id="cb67-388"><a href="Cohorts.html#cb67-388"></a>            <span class="kw">FROM</span> #cohort_rows</span>
<span id="cb67-389"><a href="Cohorts.html#cb67-389"></a>        ) RAWDATA</span>
<span id="cb67-390"><a href="Cohorts.html#cb67-390"></a>    ) e</span>
<span id="cb67-391"><a href="Cohorts.html#cb67-391"></a>    <span class="kw">WHERE</span> (<span class="dv">2</span> <span class="op">*</span> e.start_ordinal) <span class="op">-</span> e.overall_ord <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb67-392"><a href="Cohorts.html#cb67-392"></a>),</span>
<span id="cb67-393"><a href="Cohorts.html#cb67-393"></a>cteEnds (person_id, start_date, end_date) <span class="kw">AS</span></span>
<span id="cb67-394"><a href="Cohorts.html#cb67-394"></a>(</span>
<span id="cb67-395"><a href="Cohorts.html#cb67-395"></a>    <span class="kw">SELECT</span></span>
<span id="cb67-396"><a href="Cohorts.html#cb67-396"></a>         c.person_id</span>
<span id="cb67-397"><a href="Cohorts.html#cb67-397"></a>        , c.start_date</span>
<span id="cb67-398"><a href="Cohorts.html#cb67-398"></a>        , <span class="fu">MIN</span>(e.end_date) <span class="kw">AS</span> era_end_date</span>
<span id="cb67-399"><a href="Cohorts.html#cb67-399"></a>    <span class="kw">FROM</span> #cohort_rows c</span>
<span id="cb67-400"><a href="Cohorts.html#cb67-400"></a>    <span class="kw">JOIN</span> cteEndDates e <span class="kw">ON</span> c.person_id <span class="op">=</span> e.person_id <span class="kw">AND</span> e.end_date <span class="op">&gt;=</span> c.start_date</span>
<span id="cb67-401"><a href="Cohorts.html#cb67-401"></a>    <span class="kw">GROUP</span> <span class="kw">BY</span> c.person_id, c.start_date</span>
<span id="cb67-402"><a href="Cohorts.html#cb67-402"></a>)</span>
<span id="cb67-403"><a href="Cohorts.html#cb67-403"></a><span class="kw">select</span> person_id, <span class="fu">min</span>(start_date) <span class="kw">as</span> start_date, end_date</span>
<span id="cb67-404"><a href="Cohorts.html#cb67-404"></a><span class="kw">into</span> #final_cohort</span>
<span id="cb67-405"><a href="Cohorts.html#cb67-405"></a><span class="kw">from</span> cteEnds</span>
<span id="cb67-406"><a href="Cohorts.html#cb67-406"></a><span class="kw">group</span> <span class="kw">by</span> person_id, end_date</span>
<span id="cb67-407"><a href="Cohorts.html#cb67-407"></a>;</span>
<span id="cb67-408"><a href="Cohorts.html#cb67-408"></a></span>
<span id="cb67-409"><a href="Cohorts.html#cb67-409"></a><span class="kw">DELETE</span> <span class="kw">FROM</span> @target_database_schema.@target_cohort_table <span class="kw">where</span> cohort_definition_id <span class="op">=</span> @target_cohort_id;</span>
<span id="cb67-410"><a href="Cohorts.html#cb67-410"></a><span class="kw">INSERT</span> <span class="kw">INTO</span> @target_database_schema.@target_cohort_table (cohort_definition_id, subject_id, cohort_start_date, cohort_end_date)</span>
<span id="cb67-411"><a href="Cohorts.html#cb67-411"></a><span class="kw">select</span> @target_cohort_id <span class="kw">as</span> cohort_definition_id, person_id, start_date, end_date </span>
<span id="cb67-412"><a href="Cohorts.html#cb67-412"></a><span class="kw">FROM</span> #final_cohort CO</span>
<span id="cb67-413"><a href="Cohorts.html#cb67-413"></a>;</span>
<span id="cb67-414"><a href="Cohorts.html#cb67-414"></a></span>
<span id="cb67-415"><a href="Cohorts.html#cb67-415"></a></span>
<span id="cb67-416"><a href="Cohorts.html#cb67-416"></a></span>
<span id="cb67-417"><a href="Cohorts.html#cb67-417"></a><span class="kw">TRUNCATE</span> <span class="kw">TABLE</span> #strategy_ends;</span>
<span id="cb67-418"><a href="Cohorts.html#cb67-418"></a><span class="kw">DROP</span> <span class="kw">TABLE</span> #strategy_ends;</span>
<span id="cb67-419"><a href="Cohorts.html#cb67-419"></a></span>
<span id="cb67-420"><a href="Cohorts.html#cb67-420"></a></span>
<span id="cb67-421"><a href="Cohorts.html#cb67-421"></a><span class="kw">TRUNCATE</span> <span class="kw">TABLE</span> #cohort_rows;</span>
<span id="cb67-422"><a href="Cohorts.html#cb67-422"></a><span class="kw">DROP</span> <span class="kw">TABLE</span> #cohort_rows;</span>
<span id="cb67-423"><a href="Cohorts.html#cb67-423"></a></span>
<span id="cb67-424"><a href="Cohorts.html#cb67-424"></a><span class="kw">TRUNCATE</span> <span class="kw">TABLE</span> #final_cohort;</span>
<span id="cb67-425"><a href="Cohorts.html#cb67-425"></a><span class="kw">DROP</span> <span class="kw">TABLE</span> #final_cohort;</span>
<span id="cb67-426"><a href="Cohorts.html#cb67-426"></a></span>
<span id="cb67-427"><a href="Cohorts.html#cb67-427"></a><span class="kw">TRUNCATE</span> <span class="kw">TABLE</span> #inclusion_events;</span>
<span id="cb67-428"><a href="Cohorts.html#cb67-428"></a><span class="kw">DROP</span> <span class="kw">TABLE</span> #inclusion_events;</span>
<span id="cb67-429"><a href="Cohorts.html#cb67-429"></a></span>
<span id="cb67-430"><a href="Cohorts.html#cb67-430"></a><span class="kw">TRUNCATE</span> <span class="kw">TABLE</span> #qualified_events;</span>
<span id="cb67-431"><a href="Cohorts.html#cb67-431"></a><span class="kw">DROP</span> <span class="kw">TABLE</span> #qualified_events;</span>
<span id="cb67-432"><a href="Cohorts.html#cb67-432"></a></span>
<span id="cb67-433"><a href="Cohorts.html#cb67-433"></a><span class="kw">TRUNCATE</span> <span class="kw">TABLE</span> #included_events;</span>
<span id="cb67-434"><a href="Cohorts.html#cb67-434"></a><span class="kw">DROP</span> <span class="kw">TABLE</span> #included_events;</span>
<span id="cb67-435"><a href="Cohorts.html#cb67-435"></a></span>
<span id="cb67-436"><a href="Cohorts.html#cb67-436"></a><span class="kw">TRUNCATE</span> <span class="kw">TABLE</span> #Codesets;</span>
<span id="cb67-437"><a href="Cohorts.html#cb67-437"></a><span class="kw">DROP</span> <span class="kw">TABLE</span> #Codesets;</span></code></pre></div>
</div>
<div id="exercises-3" class="section level3">
<h3><span class="header-section-number">11.4.3</span> Exercises</h3>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-Banda2017APHRODITE">
<p>Banda, J. M., Y. Halpern, D. Sontag, and N. H. Shah. 2017. “Electronic phenotyping with APHRODITE and the Observational Health Sciences and Informatics (OHDSI) data network.” <em>AMIA Jt Summits Transl Sci Proc</em> 2017: 48–57.</p>
</div>
<div id="ref-Hripcsak2019eMERGE">
<p>Hripcsak, G., N. Shang, P. L. Peissig, L. V. Rasmussen, C. Liu, B. Benoit, R. J. Carroll, et al. 2019. “Facilitating phenotype transfer using a common data model.” <em>J Biomed Inform</em>, July, 103253.</p>
</div>
<div id="ref-Rubbo2015phenotypes">
<p>Rubbo, B., N. K. Fitzpatrick, S. Denaxas, M. Daskalopoulou, N. Yu, R. S. Patel, H. Hemingway, et al. 2015. “Use of electronic health records to ascertain, validate and phenotype acute myocardial infarction: A systematic review and recommendations.” <em>Int. J. Cardiol.</em> 187: 705–11.</p>
</div>
<div id="ref-Swerdel2019phevaluator">
<p>Swerdel, J. N., G. Hripcsak, and P. B. Ryan. 2019. “FPheValuator: Development and Evaluation of a Phenotype Algorithm Evaluator.” <em>J Biomed Inform</em>, July, 103258.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="SqlAndR.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="Characterization.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/OHDSI/TheBookOfOhdsi/edit/master/Cohorts.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": ["TheBookOfOhdsi.pdf", "TheBookOfOhdsi.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
