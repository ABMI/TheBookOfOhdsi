<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 10 SQL and R | The Book of OHDSI</title>
  <meta name="description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.11.1 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 10 SQL and R | The Book of OHDSI" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://ohdsi.github.io/TheBookOfOhdsi/" />
  <meta property="og:image" content="https://ohdsi.github.io/TheBookOfOhdsi/images/Cover/Cover.png" />
  <meta property="og:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="github-repo" content="OHDSI/TheBookOfOhdsi" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 10 SQL and R | The Book of OHDSI" />
  
  <meta name="twitter:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="twitter:image" content="https://ohdsi.github.io/TheBookOfOhdsi/images/Cover/Cover.png" />

<meta name="author" content="Observational Health Data Science and Informatics" />


<meta name="date" content="2019-06-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
<link rel="prev" href="OhdsiAnalyticsTools.html">
<link rel="next" href="Cohorts.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-104086677-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-104086677-2');
</script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">The Book of OHDSI</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#goals-of-this-book"><i class="fa fa-check"></i>Goals of this book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#structure-of-the-book"><i class="fa fa-check"></i>Structure of the book</a></li>
</ul></li>
<li class="part"><span><b>I The OHDSI Community</b></span></li>
<li class="chapter" data-level="1" data-path="MissionVissionValues.html"><a href="MissionVissionValues.html"><i class="fa fa-check"></i><b>1</b> Mission, vision, values</a><ul>
<li class="chapter" data-level="1.1" data-path="MissionVissionValues.html"><a href="MissionVissionValues.html#our-mission"><i class="fa fa-check"></i><b>1.1</b> Our Mission</a></li>
<li class="chapter" data-level="1.2" data-path="MissionVissionValues.html"><a href="MissionVissionValues.html#our-vision"><i class="fa fa-check"></i><b>1.2</b> Our Vision</a></li>
<li class="chapter" data-level="1.3" data-path="MissionVissionValues.html"><a href="MissionVissionValues.html#our-objectives"><i class="fa fa-check"></i><b>1.3</b> Our Objectives</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="Collaborators.html"><a href="Collaborators.html"><i class="fa fa-check"></i><b>2</b> Collaborators</a></li>
<li class="chapter" data-level="3" data-path="OpenScience.html"><a href="OpenScience.html"><i class="fa fa-check"></i><b>3</b> Open Science</a></li>
<li class="chapter" data-level="4" data-path="WhereToBegin.html"><a href="WhereToBegin.html"><i class="fa fa-check"></i><b>4</b> Where to begin</a></li>
<li class="part"><span><b>II Uniform Data Representation</b></span></li>
<li class="chapter" data-level="5" data-path="CommonDataModel.html"><a href="CommonDataModel.html"><i class="fa fa-check"></i><b>5</b> The Common Data Model</a><ul>
<li class="chapter" data-level="5.1" data-path="CommonDataModel.html"><a href="CommonDataModel.html#design-principles"><i class="fa fa-check"></i><b>5.1</b> Design Principles</a></li>
<li class="chapter" data-level="5.2" data-path="CommonDataModel.html"><a href="CommonDataModel.html#data-model-conventions"><i class="fa fa-check"></i><b>5.2</b> Data Model Conventions</a><ul>
<li class="chapter" data-level="5.2.1" data-path="CommonDataModel.html"><a href="CommonDataModel.html#model-conv"><i class="fa fa-check"></i><b>5.2.1</b> General conventions of the model</a></li>
<li class="chapter" data-level="5.2.2" data-path="CommonDataModel.html"><a href="CommonDataModel.html#general-conventions-of-schemas"><i class="fa fa-check"></i><b>5.2.2</b> General conventions of schemas</a></li>
<li class="chapter" data-level="5.2.3" data-path="CommonDataModel.html"><a href="CommonDataModel.html#general-conventions-of-data-tables"><i class="fa fa-check"></i><b>5.2.3</b> General conventions of data tables</a></li>
<li class="chapter" data-level="5.2.4" data-path="CommonDataModel.html"><a href="CommonDataModel.html#general-conventions-of-fields"><i class="fa fa-check"></i><b>5.2.4</b> General conventions of fields</a></li>
<li class="chapter" data-level="5.2.5" data-path="CommonDataModel.html"><a href="CommonDataModel.html#representation-of-content-through-concepts"><i class="fa fa-check"></i><b>5.2.5</b> Representation of content through Concepts</a></li>
<li class="chapter" data-level="5.2.6" data-path="CommonDataModel.html"><a href="CommonDataModel.html#difference-between-concept-ids-and-source-values"><i class="fa fa-check"></i><b>5.2.6</b> Difference between Concept IDs and Source Values</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="CommonDataModel.html"><a href="CommonDataModel.html#omop-cdm-standardized-tables"><i class="fa fa-check"></i><b>5.3</b> OMOP CDM Standardized Tables</a><ul>
<li class="chapter" data-level="5.3.1" data-path="CommonDataModel.html"><a href="CommonDataModel.html#running-example-endometriosis"><i class="fa fa-check"></i><b>5.3.1</b> Running Example: Endometriosis</a></li>
<li class="chapter" data-level="5.3.2" data-path="CommonDataModel.html"><a href="CommonDataModel.html#person"><i class="fa fa-check"></i><b>5.3.2</b> PERSON table</a></li>
<li class="chapter" data-level="5.3.3" data-path="CommonDataModel.html"><a href="CommonDataModel.html#observationPeriod"><i class="fa fa-check"></i><b>5.3.3</b> OBSERVATION_PERIOD table</a></li>
<li class="chapter" data-level="5.3.4" data-path="CommonDataModel.html"><a href="CommonDataModel.html#visitOccurrence"><i class="fa fa-check"></i><b>5.3.4</b> VISIT_OCCURRENCE</a></li>
<li class="chapter" data-level="5.3.5" data-path="CommonDataModel.html"><a href="CommonDataModel.html#conditionOccurrence"><i class="fa fa-check"></i><b>5.3.5</b> CONDITION_OCCURRENCE</a></li>
<li class="chapter" data-level="5.3.6" data-path="CommonDataModel.html"><a href="CommonDataModel.html#drugExposure"><i class="fa fa-check"></i><b>5.3.6</b> DRUG_EXPOSURE</a></li>
<li class="chapter" data-level="5.3.7" data-path="CommonDataModel.html"><a href="CommonDataModel.html#procedureOccurrence"><i class="fa fa-check"></i><b>5.3.7</b> PROCEDURE_OCCURRENCE</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html"><i class="fa fa-check"></i><b>6</b> Standardized Vocabularies</a></li>
<li class="chapter" data-level="7" data-path="ExtractTransformLoad.html"><a href="ExtractTransformLoad.html"><i class="fa fa-check"></i><b>7</b> Extract Transform Load</a></li>
<li class="part"><span><b>III Data Analytics</b></span></li>
<li class="chapter" data-level="8" data-path="DataAnalyticsUseCases.html"><a href="DataAnalyticsUseCases.html"><i class="fa fa-check"></i><b>8</b> Data Analytics Use Cases</a></li>
<li class="chapter" data-level="9" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html"><i class="fa fa-check"></i><b>9</b> OHDSI Analytics Tools</a></li>
<li class="chapter" data-level="10" data-path="SqlAndR.html"><a href="SqlAndR.html"><i class="fa fa-check"></i><b>10</b> SQL and R</a><ul>
<li class="chapter" data-level="10.1" data-path="SqlAndR.html"><a href="SqlAndR.html#SqlRender"><i class="fa fa-check"></i><b>10.1</b> SqlRender</a><ul>
<li class="chapter" data-level="10.1.1" data-path="SqlAndR.html"><a href="SqlAndR.html#sql-parameterization"><i class="fa fa-check"></i><b>10.1.1</b> SQL parameterization</a></li>
<li class="chapter" data-level="10.1.2" data-path="SqlAndR.html"><a href="SqlAndR.html#translation-to-other-sql-dialects"><i class="fa fa-check"></i><b>10.1.2</b> Translation to other SQL dialects</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="SqlAndR.html"><a href="SqlAndR.html#DatabaseConnector"><i class="fa fa-check"></i><b>10.2</b> DatabaseConnector</a><ul>
<li class="chapter" data-level="10.2.1" data-path="SqlAndR.html"><a href="SqlAndR.html#creating-a-connection"><i class="fa fa-check"></i><b>10.2.1</b> Creating a connection</a></li>
<li class="chapter" data-level="10.2.2" data-path="SqlAndR.html"><a href="SqlAndR.html#querying"><i class="fa fa-check"></i><b>10.2.2</b> Querying</a></li>
<li class="chapter" data-level="10.2.3" data-path="SqlAndR.html"><a href="SqlAndR.html#querying-using-ffdf-objects"><i class="fa fa-check"></i><b>10.2.3</b> Querying using ffdf objects</a></li>
<li class="chapter" data-level="10.2.4" data-path="SqlAndR.html"><a href="SqlAndR.html#querying-different-platforms-using-the-same-sql"><i class="fa fa-check"></i><b>10.2.4</b> Querying different platforms using the same SQL</a></li>
<li class="chapter" data-level="10.2.5" data-path="SqlAndR.html"><a href="SqlAndR.html#inserting-tables"><i class="fa fa-check"></i><b>10.2.5</b> Inserting tables</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="SqlAndR.html"><a href="SqlAndR.html#querying-the-cdm"><i class="fa fa-check"></i><b>10.3</b> Querying the CDM</a></li>
<li class="chapter" data-level="10.4" data-path="SqlAndR.html"><a href="SqlAndR.html#querying-the-vocabulary"><i class="fa fa-check"></i><b>10.4</b> Querying the vocabulary</a></li>
<li class="chapter" data-level="10.5" data-path="SqlAndR.html"><a href="SqlAndR.html#using-the-vocabulary-when-querying"><i class="fa fa-check"></i><b>10.5</b> Using the vocabulary when querying</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="Cohorts.html"><a href="Cohorts.html"><i class="fa fa-check"></i><b>11</b> Building the building blocks: cohorts</a></li>
<li class="chapter" data-level="12" data-path="Characterization.html"><a href="Characterization.html"><i class="fa fa-check"></i><b>12</b> Characterization</a></li>
<li class="chapter" data-level="13" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html"><i class="fa fa-check"></i><b>13</b> Population-level estimation</a><ul>
<li class="chapter" data-level="13.1" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#study-designs"><i class="fa fa-check"></i><b>13.1</b> Study designs</a><ul>
<li class="chapter" data-level="13.1.1" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#CohortMethod"><i class="fa fa-check"></i><b>13.1.1</b> Cohort method</a></li>
<li class="chapter" data-level="13.1.2" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#self-controlled-cohort"><i class="fa fa-check"></i><b>13.1.2</b> Self-controlled cohort</a></li>
<li class="chapter" data-level="13.1.3" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#case-control"><i class="fa fa-check"></i><b>13.1.3</b> Case-control</a></li>
<li class="chapter" data-level="13.1.4" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#case-crossover"><i class="fa fa-check"></i><b>13.1.4</b> Case-crossover</a></li>
<li class="chapter" data-level="13.1.5" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#self-controlled-case-series"><i class="fa fa-check"></i><b>13.1.5</b> Self-controlled case series</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#designing-a-hypertension-study"><i class="fa fa-check"></i><b>13.2</b> Designing a hypertension study</a><ul>
<li class="chapter" data-level="13.2.1" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#problem-definition"><i class="fa fa-check"></i><b>13.2.1</b> Problem definition</a></li>
<li class="chapter" data-level="13.2.2" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#target-and-comparator"><i class="fa fa-check"></i><b>13.2.2</b> Target and comparator</a></li>
<li class="chapter" data-level="13.2.3" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#outcome"><i class="fa fa-check"></i><b>13.2.3</b> Outcome</a></li>
<li class="chapter" data-level="13.2.4" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#time-at-risk"><i class="fa fa-check"></i><b>13.2.4</b> Time-at-risk</a></li>
<li class="chapter" data-level="13.2.5" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#model"><i class="fa fa-check"></i><b>13.2.5</b> Model</a></li>
<li class="chapter" data-level="13.2.6" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#study-summary"><i class="fa fa-check"></i><b>13.2.6</b> Study summary</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#implementation-the-study-using-atlas"><i class="fa fa-check"></i><b>13.3</b> Implementation the study using ATLAS</a><ul>
<li class="chapter" data-level="13.3.1" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#ComparisonSettings"><i class="fa fa-check"></i><b>13.3.1</b> Comparative cohort settings</a></li>
<li class="chapter" data-level="13.3.2" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#effect-estimation-analysis-settings"><i class="fa fa-check"></i><b>13.3.2</b> Effect estimation analysis settings</a></li>
<li class="chapter" data-level="13.3.3" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#evaluation-settings"><i class="fa fa-check"></i><b>13.3.3</b> Evaluation settings</a></li>
<li class="chapter" data-level="13.3.4" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#running-the-study-package"><i class="fa fa-check"></i><b>13.3.4</b> Running the study package</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#implementation-the-study-using-r"><i class="fa fa-check"></i><b>13.4</b> Implementation the study using R</a><ul>
<li class="chapter" data-level="13.4.1" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#cohort-instantiation"><i class="fa fa-check"></i><b>13.4.1</b> Cohort instantiation</a></li>
<li class="chapter" data-level="13.4.2" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#data-extraction"><i class="fa fa-check"></i><b>13.4.2</b> Data extraction</a></li>
<li class="chapter" data-level="13.4.3" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#defining-the-study-population"><i class="fa fa-check"></i><b>13.4.3</b> Defining the study population</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="14" data-path="propensity-scores.html"><a href="propensity-scores.html"><i class="fa fa-check"></i><b>14</b> Propensity scores</a><ul>
<li class="chapter" data-level="14.1" data-path="propensity-scores.html"><a href="propensity-scores.html#fitting-a-propensity-model"><i class="fa fa-check"></i><b>14.1</b> Fitting a propensity model</a></li>
<li class="chapter" data-level="14.2" data-path="propensity-scores.html"><a href="propensity-scores.html#propensity-score-diagnostics"><i class="fa fa-check"></i><b>14.2</b> Propensity score diagnostics</a></li>
<li class="chapter" data-level="14.3" data-path="propensity-scores.html"><a href="propensity-scores.html#using-the-propensity-score"><i class="fa fa-check"></i><b>14.3</b> Using the propensity score</a></li>
<li class="chapter" data-level="14.4" data-path="propensity-scores.html"><a href="propensity-scores.html#evaluating-covariate-balance"><i class="fa fa-check"></i><b>14.4</b> Evaluating covariate balance</a></li>
<li class="chapter" data-level="14.5" data-path="propensity-scores.html"><a href="propensity-scores.html#inspecting-select-population-characteristics"><i class="fa fa-check"></i><b>14.5</b> Inspecting select population characteristics</a></li>
<li class="chapter" data-level="14.6" data-path="propensity-scores.html"><a href="propensity-scores.html#inserting-the-population-cohort-in-the-database"><i class="fa fa-check"></i><b>14.6</b> Inserting the population cohort in the database</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="follow-up-and-power.html"><a href="follow-up-and-power.html"><i class="fa fa-check"></i><b>15</b> Follow-up and power</a></li>
<li class="chapter" data-level="16" data-path="outcome-models.html"><a href="outcome-models.html"><i class="fa fa-check"></i><b>16</b> Outcome models</a><ul>
<li class="chapter" data-level="16.1" data-path="outcome-models.html"><a href="outcome-models.html#fitting-a-simple-outcome-model"><i class="fa fa-check"></i><b>16.1</b> Fitting a simple outcome model</a></li>
<li class="chapter" data-level="16.2" data-path="outcome-models.html"><a href="outcome-models.html#excercises"><i class="fa fa-check"></i><b>16.2</b> Excercises</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html"><i class="fa fa-check"></i><b>17</b> Patient Level Prediction</a><ul>
<li class="chapter" data-level="17.1" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#designing-a-hypertension-study-1"><i class="fa fa-check"></i><b>17.1</b> Designing a hypertension study</a><ul>
<li class="chapter" data-level="17.1.1" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#problem-definition-1"><i class="fa fa-check"></i><b>17.1.1</b> Problem definition</a></li>
<li class="chapter" data-level="17.1.2" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#study-population-definition"><i class="fa fa-check"></i><b>17.1.2</b> Study population definition</a></li>
<li class="chapter" data-level="17.1.3" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#model-development-settings"><i class="fa fa-check"></i><b>17.1.3</b> Model development settings</a></li>
<li class="chapter" data-level="17.1.4" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#model-evaluation"><i class="fa fa-check"></i><b>17.1.4</b> Model evaluation</a></li>
<li class="chapter" data-level="17.1.5" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#study-summary-1"><i class="fa fa-check"></i><b>17.1.5</b> Study summary</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#implementing-the-study-in-r"><i class="fa fa-check"></i><b>17.2</b> Implementing the study in R</a><ul>
<li class="chapter" data-level="17.2.1" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#cohort-instantiation-1"><i class="fa fa-check"></i><b>17.2.1</b> Cohort instantiation</a></li>
<li class="chapter" data-level="17.2.2" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#data-extraction-1"><i class="fa fa-check"></i><b>17.2.2</b> Data extraction</a></li>
<li class="chapter" data-level="17.2.3" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#additional-inclusion-criteria"><i class="fa fa-check"></i><b>17.2.3</b> Additional inclusion criteria</a></li>
<li class="chapter" data-level="17.2.4" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#model-development"><i class="fa fa-check"></i><b>17.2.4</b> Model Development</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#implementing-the-study-in-atlas"><i class="fa fa-check"></i><b>17.3</b> Implementing the study in ATLAS</a></li>
<li class="chapter" data-level="17.4" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#internal-validation"><i class="fa fa-check"></i><b>17.4</b> Internal validation</a><ul>
<li class="chapter" data-level="17.4.1" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#discrimination"><i class="fa fa-check"></i><b>17.4.1</b> Discrimination</a></li>
<li class="chapter" data-level="17.4.2" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#calibration"><i class="fa fa-check"></i><b>17.4.2</b> Calibration</a></li>
<li class="chapter" data-level="17.4.3" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#smooth-calibration"><i class="fa fa-check"></i><b>17.4.3</b> Smooth Calibration</a></li>
<li class="chapter" data-level="17.4.4" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#preference-distribution"><i class="fa fa-check"></i><b>17.4.4</b> Preference distribution</a></li>
<li class="chapter" data-level="17.4.5" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#predicted-probability-distribution"><i class="fa fa-check"></i><b>17.4.5</b> Predicted probability distribution</a></li>
<li class="chapter" data-level="17.4.6" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#test-train-similarity"><i class="fa fa-check"></i><b>17.4.6</b> Test-Train similarity</a></li>
<li class="chapter" data-level="17.4.7" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#variable-scatter-plot"><i class="fa fa-check"></i><b>17.4.7</b> Variable scatter plot</a></li>
<li class="chapter" data-level="17.4.8" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#precision-recall"><i class="fa fa-check"></i><b>17.4.8</b> Precision recall</a></li>
<li class="chapter" data-level="17.4.9" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#demographic-summary"><i class="fa fa-check"></i><b>17.4.9</b> Demographic summary</a></li>
</ul></li>
<li class="chapter" data-level="17.5" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#external-validation"><i class="fa fa-check"></i><b>17.5</b> External validation</a></li>
<li class="chapter" data-level="17.6" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#journal-paper-generation"><i class="fa fa-check"></i><b>17.6</b> Journal paper generation</a></li>
<li class="chapter" data-level="17.7" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#excercises-1"><i class="fa fa-check"></i><b>17.7</b> Excercises</a></li>
</ul></li>
<li class="part"><span><b>IV Evidence Quality</b></span></li>
<li class="chapter" data-level="18" data-path="EvidenceQuality.html"><a href="EvidenceQuality.html"><i class="fa fa-check"></i><b>18</b> Evidence Quality</a></li>
<li class="chapter" data-level="19" data-path="DataQuality.html"><a href="DataQuality.html"><i class="fa fa-check"></i><b>19</b> Data Quality</a><ul>
<li class="chapter" data-level="19.1" data-path="DataQuality.html"><a href="DataQuality.html#introduction"><i class="fa fa-check"></i><b>19.1</b> Introduction</a></li>
<li class="chapter" data-level="19.2" data-path="DataQuality.html"><a href="DataQuality.html#achilles-heel-tool"><i class="fa fa-check"></i><b>19.2</b> Achilles Heel tool</a><ul>
<li class="chapter" data-level="19.2.1" data-path="DataQuality.html"><a href="DataQuality.html#precomputed-analyses"><i class="fa fa-check"></i><b>19.2.1</b> Precomputed Analyses</a></li>
<li class="chapter" data-level="19.2.2" data-path="DataQuality.html"><a href="DataQuality.html#example-dq-check"><i class="fa fa-check"></i><b>19.2.2</b> Example DQ check</a></li>
<li class="chapter" data-level="19.2.3" data-path="DataQuality.html"><a href="DataQuality.html#overview-of-existing-dq-heel-checks"><i class="fa fa-check"></i><b>19.2.3</b> Overview of existing DQ Heel checks</a></li>
</ul></li>
<li class="chapter" data-level="19.3" data-path="DataQuality.html"><a href="DataQuality.html#study-specific-checks"><i class="fa fa-check"></i><b>19.3</b> Study-specific checks</a><ul>
<li class="chapter" data-level="19.3.1" data-path="DataQuality.html"><a href="DataQuality.html#outcomes"><i class="fa fa-check"></i><b>19.3.1</b> Outcomes</a></li>
<li class="chapter" data-level="19.3.2" data-path="DataQuality.html"><a href="DataQuality.html#laboratory-data"><i class="fa fa-check"></i><b>19.3.2</b> Laboratory data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="20" data-path="ClinicalValidity.html"><a href="ClinicalValidity.html"><i class="fa fa-check"></i><b>20</b> Clinical Validity</a></li>
<li class="chapter" data-level="21" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html"><i class="fa fa-check"></i><b>21</b> Software Validity</a><ul>
<li class="chapter" data-level="21.1" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#software-development-process"><i class="fa fa-check"></i><b>21.1</b> Software Development Process</a><ul>
<li class="chapter" data-level="21.1.1" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#source-code-management"><i class="fa fa-check"></i><b>21.1.1</b> Source Code Management</a></li>
<li class="chapter" data-level="21.1.2" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#documentation"><i class="fa fa-check"></i><b>21.1.2</b> Documentation</a></li>
<li class="chapter" data-level="21.1.3" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#availability-of-current-and-historical-archive-versions"><i class="fa fa-check"></i><b>21.1.3</b> Availability of Current and Historical Archive Versions</a></li>
<li class="chapter" data-level="21.1.4" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#maintenance-support-and-retirement"><i class="fa fa-check"></i><b>21.1.4</b> Maintenance, Support and Retirement</a></li>
<li class="chapter" data-level="21.1.5" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#qualified-personnel"><i class="fa fa-check"></i><b>21.1.5</b> Qualified Personnel</a></li>
<li class="chapter" data-level="21.1.6" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#physical-and-logical-security"><i class="fa fa-check"></i><b>21.1.6</b> Physical and Logical Security</a></li>
<li class="chapter" data-level="21.1.7" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#disaster-recovery"><i class="fa fa-check"></i><b>21.1.7</b> Disaster Recovery</a></li>
</ul></li>
<li class="chapter" data-level="21.2" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#testing"><i class="fa fa-check"></i><b>21.2</b> Testing</a><ul>
<li class="chapter" data-level="21.2.1" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#unit-test"><i class="fa fa-check"></i><b>21.2.1</b> Unit test</a></li>
</ul></li>
<li class="chapter" data-level="21.3" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#conclusions"><i class="fa fa-check"></i><b>21.3</b> Conclusions</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="MethodValidity.html"><a href="MethodValidity.html"><i class="fa fa-check"></i><b>22</b> Method Validity</a><ul>
<li class="chapter" data-level="22.1" data-path="MethodValidity.html"><a href="MethodValidity.html#design-specific-diagnostics"><i class="fa fa-check"></i><b>22.1</b> Design-specific diagnostics</a><ul>
<li class="chapter" data-level="22.1.1" data-path="MethodValidity.html"><a href="MethodValidity.html#diagnostics-for-cohort-method"><i class="fa fa-check"></i><b>22.1.1</b> Diagnostics for cohort method</a></li>
<li class="chapter" data-level="22.1.2" data-path="MethodValidity.html"><a href="MethodValidity.html#diagnostics-for-sccs"><i class="fa fa-check"></i><b>22.1.2</b> Diagnostics for SCCS</a></li>
</ul></li>
<li class="chapter" data-level="22.2" data-path="MethodValidity.html"><a href="MethodValidity.html#diagnostics-for-all-estimation"><i class="fa fa-check"></i><b>22.2</b> Diagnostics for all estimation</a><ul>
<li class="chapter" data-level="22.2.1" data-path="MethodValidity.html"><a href="MethodValidity.html#negative-and-positive-controls"><i class="fa fa-check"></i><b>22.2.1</b> Negative and positive controls</a></li>
<li class="chapter" data-level="22.2.2" data-path="MethodValidity.html"><a href="MethodValidity.html#metrics"><i class="fa fa-check"></i><b>22.2.2</b> Metrics</a></li>
<li class="chapter" data-level="22.2.3" data-path="MethodValidity.html"><a href="MethodValidity.html#empirical-calibration"><i class="fa fa-check"></i><b>22.2.3</b> Empirical calibration</a></li>
<li class="chapter" data-level="22.2.4" data-path="MethodValidity.html"><a href="MethodValidity.html#replication-across-sites"><i class="fa fa-check"></i><b>22.2.4</b> Replication across sites</a></li>
<li class="chapter" data-level="22.2.5" data-path="MethodValidity.html"><a href="MethodValidity.html#sensitivity-analyses"><i class="fa fa-check"></i><b>22.2.5</b> Sensitivity analyses</a></li>
</ul></li>
<li class="chapter" data-level="22.3" data-path="MethodValidity.html"><a href="MethodValidity.html#diagnostics-for-all-prediction"><i class="fa fa-check"></i><b>22.3</b> Diagnostics for all prediction</a></li>
<li class="chapter" data-level="22.4" data-path="MethodValidity.html"><a href="MethodValidity.html#method-validation-in-practice"><i class="fa fa-check"></i><b>22.4</b> Method validation in practice</a></li>
<li class="chapter" data-level="22.5" data-path="MethodValidity.html"><a href="MethodValidity.html#advanced-ohdsi-methods-benchmark"><i class="fa fa-check"></i><b>22.5</b> Advanced: OHDSI Methods Benchmark</a></li>
</ul></li>
<li class="part"><span><b>V OHDSI Studies</b></span></li>
<li class="chapter" data-level="23" data-path="StudySteps.html"><a href="StudySteps.html"><i class="fa fa-check"></i><b>23</b> Study steps</a></li>
<li class="chapter" data-level="24" data-path="NetworkResearch.html"><a href="NetworkResearch.html"><i class="fa fa-check"></i><b>24</b> OHDSI Network Research</a><ul>
<li class="chapter" data-level="24.1" data-path="NetworkResearch.html"><a href="NetworkResearch.html#ohdsi-network-study-examples"><i class="fa fa-check"></i><b>24.1</b> OHDSI Network Study Examples</a><ul>
<li class="chapter" data-level="24.1.1" data-path="NetworkResearch.html"><a href="NetworkResearch.html#endometriosis-study"><i class="fa fa-check"></i><b>24.1.1</b> Endometriosis study</a></li>
</ul></li>
<li class="chapter" data-level="24.2" data-path="NetworkResearch.html"><a href="NetworkResearch.html#excercises-2"><i class="fa fa-check"></i><b>24.2</b> Excercises</a><ul>
<li class="chapter" data-level="24.2.1" data-path="NetworkResearch.html"><a href="NetworkResearch.html#defining-a-cohort"><i class="fa fa-check"></i><b>24.2.1</b> Defining a cohort</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="Glossary.html"><a href="Glossary.html"><i class="fa fa-check"></i><b>A</b> Glossary</a></li>
<li class="chapter" data-level="B" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html"><i class="fa fa-check"></i><b>B</b> Cohort definitions</a><ul>
<li class="chapter" data-level="B.1" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#AceInhibitors"><i class="fa fa-check"></i><b>B.1</b> ACE inhibitors</a></li>
<li class="chapter" data-level="B.2" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#AceInhibitorsMono"><i class="fa fa-check"></i><b>B.2</b> New users of ACE inhibitors as first-line monotherapy for hypertension</a></li>
<li class="chapter" data-level="B.3" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#Ami"><i class="fa fa-check"></i><b>B.3</b> Acute myocardial infarction (AMI)</a></li>
<li class="chapter" data-level="B.4" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#Angioedema"><i class="fa fa-check"></i><b>B.4</b> Angioedema</a></li>
<li class="chapter" data-level="B.5" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#ThiazidesMono"><i class="fa fa-check"></i><b>B.5</b> New users of Thiazide-like diuretics as first-line monotherapy for hypertension</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The Book of OHDSI</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="SqlAndR" class="section level1">
<h1><span class="header-section-number">Chapter 10</span> SQL and R</h1>
<p><em>Chapter lead: Martijn Schuemie</em></p>
<p>The Common Data Model is a relational database model, which means that the data will be stored in a relational database using a software platform like PostgreSQL, Oracle, or Microsoft SQL Server. The various OHDSI tools such as ATLAS and the Methods Library work by querying the database behind the scene, but we can also query the database directly ourselves if we have appropriate access rights. The main reason to do this is to perform analyses that currently are not supported by any existing tool. However, directly querying the database also comes with risks, as the OHDSI tools are often designed to help guide the user to appropriate analysis of the data, and direct queries do not provide such guidance.</p>
<p>The standard language for querying relational databases is SQL (Structured Query Language), which can be used both to query the database as well as to make changes to the data. Although the basic commands in SQL are indeed standard, meaning the same across software platforms, each platform has its own dialect, with subtle changes. For example, to retrieve the top 10 rows of the person table on SQL Server one would type:</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">SELECT</span> TOP <span class="dv">10</span> * <span class="kw">FROM</span> person;</code></pre></div>
<p>Whereas the same query on PostgreSQL would be:</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">SELECT</span> * <span class="kw">FROM</span> person <span class="kw">LIMIT</span> <span class="dv">10</span>;</code></pre></div>
<p>In OHDSI, we would like to be agnostic to the specific dialect a platform uses; We would like to ‘speak’ the same SQL language across all OHDSI databases. For this reason OHDSI developed the <a href="https://ohdsi.github.io/SqlRender/">SqlRender</a> package, an R package that can translate from one standard dialect to any of the supported dialects that will be discussed later in this chapter. This standard dialect - <strong>OHDSI SQL</strong> - is mainly a subset of the SQL Server SQL dialect. The example SQL statements provided throughout this chapter will all use OHDSI SQL.</p>
<p>Each database platform also comes with its own software tools for querying the database using SQL. In OHDSI we developed the <a href="https://ohdsi.github.io/DatabaseConnector/">DatabaseConnector</a> package, a single R package that can connect to a wide range of database platforms. DatabaseConnector will also be discussed later in this chapter.</p>
<p>So although one can query a database that conforms to the CDM without using any OHDSI tools, the recommended path is to use the DatabaseConnector and SqlRender packages. This allows queries that are developed at one site to be used at any other site without modification. R itself also immediately provides features to further analyse the data extracted from the database, such as performing statistical analyses and generating (interactive) plots.</p>
<p>The SqlRender and DatabaseConnector packages are both available on CRAN (the Comprehensive R Archive Network), and can therefore be installed using:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="kw">c</span>(<span class="st">&quot;SqlRender&quot;</span>, <span class="st">&quot;DatabaseConnector&quot;</span>))</code></pre></div>
<p>Both packages support a wide array of technical platforms including traditional database systems (PostgreSQL, Microsoft SQL Server, SQLite, and Oracle), parallel data warehouses (Microsoft APS, IBM Netezza, and Amazon RedShift), as well as Big Data platforms (Hadoop through Impala, and Google BigQuery). Both packages come with package manuals and vignettes that explore the full functionality. Here we describer some of the main features.</p>
<div id="SqlRender" class="section level2">
<h2><span class="header-section-number">10.1</span> SqlRender</h2>
<div id="sql-parameterization" class="section level3">
<h3><span class="header-section-number">10.1.1</span> SQL parameterization</h3>
<p>One of the functions of the package is to support parameterization of SQL. Often, small variations of SQL need to be generated based on some parameters. SqlRender offers a simple markup syntax inside the SQL code to allow parameterization. Rendering the SQL based on parameter values is done using the <code>render()</code> function.</p>
<p><strong>Substituting parameter values</strong></p>
<p>The <code>@</code> character can be used to indicate parameter names that need to be exchange for actual parameter values when rendering. In the following example, a variable called <code>a</code> is mentioned in the SQL. In the call to the render function the value of this parameter is defined:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sql &lt;-<span class="st"> &quot;SELECT * FROM concept WHERE concept_id = @a;&quot;</span>
<span class="kw">render</span>(sql, <span class="dt">a =</span> <span class="dv">123</span>)</code></pre></div>
<pre><code>## [1] &quot;SELECT * FROM concept WHERE concept_id = 123;&quot;</code></pre>
<p>Note that, unlike the parameterization offered by most database management systems, it is just as easy to parameterize table or field names as values:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sql &lt;-<span class="st"> &quot;SELECT * FROM @x WHERE person_id = @a;&quot;</span>
<span class="kw">render</span>(sql, <span class="dt">x =</span> <span class="st">&quot;observation&quot;</span>, <span class="dt">a =</span> <span class="dv">123</span>)</code></pre></div>
<pre><code>## [1] &quot;SELECT * FROM observation WHERE person_id = 123;&quot;</code></pre>
<p>The parameter values can be numbers, strings, booleans, as well as vectors, which are converted to comma-delimited lists:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sql &lt;-<span class="st"> &quot;SELECT * FROM concept WHERE concept_id IN (@a);&quot;</span>
<span class="kw">render</span>(sql, <span class="dt">a =</span> <span class="kw">c</span>(<span class="dv">123</span>, <span class="dv">234</span>, <span class="dv">345</span>))</code></pre></div>
<pre><code>## [1] &quot;SELECT * FROM concept WHERE concept_id IN (123,234,345);&quot;</code></pre>
<p><strong>If-then-else</strong></p>
<p>Sometimes blocks of codes need to be turned on or off based on the values of one or more parameters. This is done using the <code>{Condition} ? {if true} : {if false}</code> syntax. If the <em>condition</em> evaluates to true or 1, the <em>if true</em> block is used, else the <em>if false</em> block is shown (if present).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sql &lt;-<span class="st"> &quot;SELECT * FROM cohort {@x} ? {WHERE subject_id = 1}&quot;</span>
<span class="kw">render</span>(sql, <span class="dt">x =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>## [1] &quot;SELECT * FROM cohort &quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">render</span>(sql, <span class="dt">x =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>## [1] &quot;SELECT * FROM cohort WHERE subject_id = 1&quot;</code></pre>
<p>Simple comparisons are also supported:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sql &lt;-<span class="st"> &quot;SELECT * FROM cohort {@x == 1} ? {WHERE subject_id = 1};&quot;</span>
<span class="kw">render</span>(sql,<span class="dt">x =</span> <span class="dv">1</span>)</code></pre></div>
<pre><code>## [1] &quot;SELECT * FROM cohort WHERE subject_id = 1;&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">render</span>(sql,<span class="dt">x =</span> <span class="dv">2</span>)</code></pre></div>
<pre><code>## [1] &quot;SELECT * FROM cohort ;&quot;</code></pre>
<p>As well as the <code>IN</code> operator:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sql &lt;-<span class="st"> &quot;SELECT * FROM cohort {@x IN (1,2,3)} ? {WHERE subject_id = 1};&quot;</span>
<span class="kw">render</span>(sql,<span class="dt">x =</span> <span class="dv">2</span>)</code></pre></div>
<pre><code>## [1] &quot;SELECT * FROM cohort WHERE subject_id = 1;&quot;</code></pre>
</div>
<div id="translation-to-other-sql-dialects" class="section level3">
<h3><span class="header-section-number">10.1.2</span> Translation to other SQL dialects</h3>
<p>Another function of the <a href="https://ohdsi.github.io/SqlRender/">SqlRender</a> package is to translate from OHDSI SQL to other SQL dialects. For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sql &lt;-<span class="st"> &quot;SELECT TOP 10 * FROM person;&quot;</span>
<span class="kw">translate</span>(sql, <span class="dt">targetDialect =</span> <span class="st">&quot;postgresql&quot;</span>)</code></pre></div>
<pre><code>## [1] &quot;SELECT  * FROM person LIMIT 10;&quot;</code></pre>
<p>The <code>targetDialect</code> parameter can have the following values: “oracle”, “postgresql”, “pdw”, “redshift”, “impala”, “netezza”, “bigquery”, “sqlite”, and “sql server”.</p>
<p>There are limits to what SQL functions and constructs can be translated properly, both because only a limited set of translation rules have been implemented in the package, but also some SQL features do not have an equivalent in all dialects.</p>
<p><strong>Functions and structures supported by translate</strong></p>
<p>These SQL Server functions have been tested and were found to be translated correctly to the various dialects:</p>
<table>
<caption><span id="tab:sqlFunctions">Table 10.1: </span> Functions supported by translate.</caption>
<thead>
<tr class="header">
<th align="left">Function</th>
<th align="left">Function</th>
<th align="left">Function</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">ABS</td>
<td align="left">EXP</td>
<td align="left">RAND</td>
</tr>
<tr class="even">
<td align="left">ACOS</td>
<td align="left">FLOOR</td>
<td align="left">RANK</td>
</tr>
<tr class="odd">
<td align="left">ASIN</td>
<td align="left">GETDATE</td>
<td align="left">RIGHT</td>
</tr>
<tr class="even">
<td align="left">ATAN</td>
<td align="left">HASHBYTES*</td>
<td align="left">ROUND</td>
</tr>
<tr class="odd">
<td align="left">AVG</td>
<td align="left">ISNULL</td>
<td align="left">ROW_NUMBER</td>
</tr>
<tr class="even">
<td align="left">CAST</td>
<td align="left">ISNUMERIC</td>
<td align="left">RTRIM</td>
</tr>
<tr class="odd">
<td align="left">CEILING</td>
<td align="left">LEFT</td>
<td align="left">SIN</td>
</tr>
<tr class="even">
<td align="left">CHARINDEX</td>
<td align="left">LEN</td>
<td align="left">SQRT</td>
</tr>
<tr class="odd">
<td align="left">CONCAT</td>
<td align="left">LOG</td>
<td align="left">SQUARE</td>
</tr>
<tr class="even">
<td align="left">COS</td>
<td align="left">LOG10</td>
<td align="left">STDEV</td>
</tr>
<tr class="odd">
<td align="left">COUNT</td>
<td align="left">LOWER</td>
<td align="left">SUM</td>
</tr>
<tr class="even">
<td align="left">COUNT_BIG</td>
<td align="left">LTRIM</td>
<td align="left">TAN</td>
</tr>
<tr class="odd">
<td align="left">DATEADD</td>
<td align="left">MAX</td>
<td align="left">UPPER</td>
</tr>
<tr class="even">
<td align="left">DATEDIFF</td>
<td align="left">MIN</td>
<td align="left">VAR</td>
</tr>
<tr class="odd">
<td align="left">DATEFROMPARTS</td>
<td align="left">MONTH</td>
<td align="left">YEAR</td>
</tr>
<tr class="even">
<td align="left">DATETIMEFROMPARTS</td>
<td align="left">NEWID</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">DAY</td>
<td align="left">PI</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">EOMONTH</td>
<td align="left">POWER</td>
<td align="left"></td>
</tr>
</tbody>
</table>
<ul>
<li>Requires special privileges on Oracle. Has no equivalent on SQLite.</li>
</ul>
<p>Similarly, many SQL syntax structures are supported. Here is a non-exhaustive lists of things that we know will translate well:</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="co">-- Simple selects:</span>
<span class="kw">SELECT</span> * <span class="kw">FROM</span> <span class="kw">table</span>;

<span class="co">-- Selects with joins:</span>
<span class="kw">SELECT</span> * <span class="kw">FROM</span> table_1 <span class="kw">INNER</span> <span class="kw">JOIN</span> table_2 <span class="kw">ON</span> a = b;

<span class="co">-- Nested queries:</span>
<span class="kw">SELECT</span> * <span class="kw">FROM</span> (<span class="kw">SELECT</span> * <span class="kw">FROM</span> table_1) tmp <span class="kw">WHERE</span> a = b;

<span class="co">-- Limiting to top rows:</span>
<span class="kw">SELECT</span> TOP <span class="dv">10</span> * <span class="kw">FROM</span> <span class="kw">table</span>;

<span class="co">-- Selecting into a new table:</span>
<span class="kw">SELECT</span> * <span class="kw">INTO</span> new_table <span class="kw">FROM</span> <span class="kw">table</span>;

<span class="co">-- Creating tables:</span>
<span class="kw">CREATE</span> <span class="kw">TABLE</span> <span class="kw">table</span> (field <span class="dt">INT</span>);

<span class="co">-- Inserting verbatim values:</span>
<span class="kw">INSERT</span> <span class="kw">INTO</span> other_table (field_1) <span class="kw">VALUES</span> (<span class="dv">1</span>);

<span class="co">-- Inserting from SELECT:</span>
<span class="kw">INSERT</span> <span class="kw">INTO</span> other_table (field_1) <span class="kw">SELECT</span> <span class="fu">value</span> <span class="kw">FROM</span> <span class="kw">table</span>;
  
<span class="co">-- Simple drop commands:</span>
<span class="kw">DROP</span> <span class="kw">TABLE</span> <span class="kw">table</span>;

<span class="co">-- Drop table if it exists:</span>
<span class="kw">IF</span> OBJECT_ID(<span class="st">&#39;ACHILLES_analysis&#39;</span>, <span class="st">&#39;U&#39;</span>) <span class="kw">IS</span> <span class="kw">NOT</span> <span class="kw">NULL</span>
  <span class="kw">DROP</span> <span class="kw">TABLE</span> ACHILLES_analysis;
  
<span class="co">-- Drop temp table if it exists:</span>
<span class="kw">IF</span> OBJECT_ID(<span class="st">&#39;tempdb..#cohorts&#39;</span>, <span class="st">&#39;U&#39;</span>) <span class="kw">IS</span> <span class="kw">NOT</span> <span class="kw">NULL</span>
  <span class="kw">DROP</span> <span class="kw">TABLE</span> #cohorts;  

<span class="co">-- Common table expressions:</span>
<span class="kw">WITH</span> cte <span class="kw">AS</span> (<span class="kw">SELECT</span> * <span class="kw">FROM</span> <span class="kw">table</span>) <span class="kw">SELECT</span> * <span class="kw">FROM</span> cte;

<span class="co">-- OVER clauses:</span>
<span class="kw">SELECT</span> <span class="fu">ROW_NUMBER</span>() <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> a <span class="kw">ORDER</span> <span class="kw">BY</span> b)
  <span class="kw">AS</span> <span class="ot">&quot;Row Number&quot;</span> <span class="kw">FROM</span> <span class="kw">table</span>;
  
<span class="co">-- CASE WHEN clauses:</span>
<span class="kw">SELECT</span> <span class="kw">CASE</span> <span class="kw">WHEN</span> a=<span class="dv">1</span> <span class="kw">THEN</span> a <span class="kw">ELSE</span> <span class="dv">0</span> <span class="kw">END</span> <span class="kw">AS</span> <span class="fu">value</span> <span class="kw">FROM</span> <span class="kw">table</span>;

<span class="co">-- UNIONs:</span>
<span class="kw">SELECT</span> * <span class="kw">FROM</span> a <span class="kw">UNION</span> <span class="kw">SELECT</span> * <span class="kw">FROM</span> b;

<span class="co">-- INTERSECTIONs:</span>
<span class="kw">SELECT</span> * <span class="kw">FROM</span> a <span class="kw">INTERSECT</span> <span class="kw">SELECT</span> * <span class="kw">FROM</span> b;

<span class="co">-- EXCEPT:</span>
<span class="kw">SELECT</span> * <span class="kw">FROM</span> a <span class="kw">EXCEPT</span> <span class="kw">SELECT</span> * <span class="kw">FROM</span> b;</code></pre></div>
<p><strong>String concatenation</strong></p>
<p>String concatenation is one area where SQL Server is less specific than other dialects. In SQL Server, one would write <code>SELECT first_name + ' ' + last_name AS full_name FROM table</code>, but this should be <code>SELECT first_name || ' ' || last_name AS full_name FROM table</code> in PostgreSQL and Oracle. SqlRender tries to guess when values that are being concatenated are strings. In the example above, because we have an explicit string (the space surrounded by single quotation marks), the translation will be correct. However, if the query had been <code>SELECT first_name + last_name AS full_name FROM table</code>, SqlRender would have had no clue the two fields were strings, and would incorrectly leave the plus sign. Another clue that a value is a string is an explicit cast to VARCHAR, so <code>SELECT last_name + CAST(age AS VARCHAR(3)) AS full_name FROM table</code> would also be translated correctly. To avoid ambiguity altogether, it is probable best to use the <code>CONCAT()</code> function to concatenate two or more strings.</p>
<p><strong>Table aliases and the AS keyword</strong></p>
<p>Many SQL dialects allow the use of the <code>AS</code> keyword when defining a table alias, but will also work fine without the keyword. For example, both these SQL statements are fine for SQL Server, PostgreSQL, RedShift, etc.:</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="co">-- Using AS keyword</span>
<span class="kw">SELECT</span> * 
<span class="kw">FROM</span> my_table <span class="kw">AS</span> table_<span class="dv">1</span>
<span class="kw">INNER</span> <span class="kw">JOIN</span> (
  <span class="kw">SELECT</span> * <span class="kw">FROM</span> other_table
) <span class="kw">AS</span> table_<span class="dv">2</span>
<span class="kw">ON</span> table_1.person_id = table_2.person_id;

<span class="co">-- Not using AS keyword</span>
<span class="kw">SELECT</span> * 
<span class="kw">FROM</span> my_table table_<span class="dv">1</span>
<span class="kw">INNER</span> <span class="kw">JOIN</span> (
  <span class="kw">SELECT</span> * <span class="kw">FROM</span> other_table
) table_<span class="dv">2</span>
<span class="kw">ON</span> table_1.person_id = table_2.person_id;</code></pre></div>
<p>However, Oracle will throw an error when the <code>AS</code> keyword is used. In the above example, the first query will fail. It is therefore recommended to not use the <code>AS</code> keyword when aliasing tables. (Note: we can’t make SqlRender handle this, because it can’t easily distinguish between table aliases where Oracle doesn’t allow <code>AS</code> to be used, and field aliases, where Oracle requires <code>AS</code> to be used.)</p>
<p><strong>Temp tables</strong></p>
<p>Temp tables can be very useful to store intermediate results, and when used correctly can be used to dramatically improve performance of queries. On most database platforms temp tables have very nice properties: they’re only visible to the current user, are automatically dropped when the session ends, and can be created even when the user has no write access. Unfortunately, in Oracle temp tables are basically permanent tables, with the only difference that the data inside the table is only visible to the current user. This is why, in Oracle, SqlRender will try to emulate temp tables by</p>
<ol style="list-style-type: decimal">
<li>Adding a random string to the table name so tables from different users will not conflict.</li>
<li>Allowing the user to specify the schema where the temp tables will be created.</li>
</ol>
<p>For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sql &lt;-<span class="st"> &quot;SELECT * FROM #children;&quot;</span>
<span class="kw">translate</span>(sql, <span class="dt">targetDialect =</span> <span class="st">&quot;oracle&quot;</span>, <span class="dt">oracleTempSchema =</span> <span class="st">&quot;temp_schema&quot;</span>)</code></pre></div>
<pre><code>## [1] &quot;SELECT * FROM temp_schema.e97s55dtchildren ;&quot;</code></pre>
<p>Note that the user will need to have write privileges on <code>temp_schema</code>.</p>
<p>Also note that because Oracle has a limit on table names of 30 characters, <strong>temp table names are only allowed to be at most 22 characters long</strong> because else the name will become too long after appending the session ID.</p>
<p>Furthermore, remember that temp tables are not automatically dropped on Oracle, so you will need to explicitly <code>TRUNCATE</code> and <code>DROP</code> all temp tables once you’re done with them to prevent orphan tables accumulating in the Oracle temp schema.</p>
<p><strong>Implicit casts</strong></p>
<p>One of the few points where SQL Server is less explicit than other dialects is that it allows implicit casts. For example, this code will work on SQL Server:</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">CREATE</span> <span class="kw">TABLE</span> #temp (txt <span class="dt">VARCHAR</span>);

<span class="kw">INSERT</span> <span class="kw">INTO</span> #temp
<span class="kw">SELECT</span> <span class="st">&#39;1&#39;</span>;

<span class="kw">SELECT</span> * <span class="kw">FROM</span> #temp <span class="kw">WHERE</span> txt = <span class="dv">1</span>;</code></pre></div>
<p>Even though <code>txt</code> is a VARCHAR field and we are comparing it with an integer, SQL Server will automatically cast one of the two to the correct type to allow the comparison. In contrast, other dialects such as PosgreSQL will throw an error when trying to compare a VARCHAR with an INT.</p>
<p>You should therefore always make casts explicit. In the above example, the last statement should be replaced with either</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">SELECT</span> * <span class="kw">FROM</span> #temp <span class="kw">WHERE</span> txt = <span class="fu">CAST</span>(<span class="dv">1</span> <span class="kw">AS</span> <span class="dt">VARCHAR</span>);</code></pre></div>
<p>or</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">SELECT</span> * <span class="kw">FROM</span> #temp <span class="kw">WHERE</span> <span class="fu">CAST</span>(txt <span class="kw">AS</span> <span class="dt">INT</span>) = <span class="dv">1</span>;</code></pre></div>
<p><strong>Case sensitivity in string comparisons</strong></p>
<p>Some DBMS platforms such as SQL Server always perform string comparisons in a case-insensitive way, while others such as PostgreSQL are always case sensitive. It is therefore recommended to always assume case-sensitive comparisons, and to explicitly make comparisons case-insensitive when unsure about the case. For example, instead of</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">SELECT</span> * <span class="kw">FROM</span> concept <span class="kw">WHERE</span> concep_class_id = <span class="st">&#39;Clinical Finding&#39;</span></code></pre></div>
<p>it is preferred to use</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">SELECT</span> * <span class="kw">FROM</span> concept <span class="kw">WHERE</span> <span class="fu">LOWER</span>(concep_class_id) = <span class="st">&#39;clinical finding&#39;</span></code></pre></div>
<p><strong>Schemas and databases</strong></p>
<p>In SQL Server, tables are located in a schema, and schemas reside in a database. For example, <code>cdm_data.dbo.person</code> refers to the <code>person</code> table in the <code>dbo</code> schema in the <code>cdm_data</code> database. In other dialects, even though a similar hierarchy often exists they are used very differently. In SQL Server, there is typically one schema per database (often called <code>dbo</code>), and users can easily use data in different databases. On other platforms, for example in PostgreSQL, it is not possible to use data across databases in a single session, but there are often many schemas in a database. In PostgreSQL one could say that the equivalent of SQL Server’s database is the schema.</p>
<p>We therefore recommend concatenating SQL Server’s database and schema into a single parameter, which we typically call <code>@databaseSchema</code>. For example, we could have the parameterized SQL</p>
<div class="sourceCode"><pre class="sourceCode sql"><code class="sourceCode sql"><span class="kw">SELECT</span> * <span class="kw">FROM</span> @databaseSchema.person</code></pre></div>
<p>where on SQL Server we can include both database and schema names in the value: <code>databaseSchema = &quot;cdm_data.dbo&quot;</code>. On other platforms, we can use the same code, but now only specify the schema as the parameter value: <code>databaseSchema = &quot;cdm_data&quot;</code>.</p>
<p>The one situation where this will fail is the <code>USE</code> command, since <code>USE cdm_data.dbo;</code> will throw an error. It is therefore preferred not to use the <code>USE</code> command, but always specify the database / schema where a table is located.</p>
<p><strong>Debugging parameterized SQL</strong></p>
<p>Debugging parameterized SQL can be a bit complicated; Only the rendered SQL can be tested against a database server, but changes to the code should be made in the parameterized (pre-rendered) SQL.</p>
<p>A Shiny app is included in the SqlRender package for interactively editing source SQL and generating rendered and translated SQL. The app can be started using:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">launchSqlRenderDeveloper</span>()</code></pre></div>
<p>Which will open the default browser with the app.</p>
</div>
</div>
<div id="DatabaseConnector" class="section level2">
<h2><span class="header-section-number">10.2</span> DatabaseConnector</h2>
<p>DatabaseConnector is an R package for connecting to various database platforms using Java’s JDBC drivers. The package already contains most drivers, but because of licensing reasons the drivers for BigQuery, Netezza and Impala are not included but must be obtained by the user. Type <code>?jdbcDrivers</code> for instructions on how to download these drivers. Once downloaded, you can use the <code>pathToDriver</code> argument of the <code>connect</code>, <code>dbConnect</code>, and <code>createConnectionDetails</code> functions.</p>
<div id="creating-a-connection" class="section level3">
<h3><span class="header-section-number">10.2.1</span> Creating a connection</h3>
<p>To connect to a database a number of details need to be specified, such as the database platform, the location of the server, the user name, and password. We can call the <code>connect</code> function and specify these details directly:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">conn &lt;-<span class="st"> </span><span class="kw">connect</span>(<span class="dt">dbms =</span> <span class="st">&quot;postgresql&quot;</span>,
                <span class="dt">server =</span> <span class="st">&quot;localhost/postgres&quot;</span>,
                <span class="dt">user =</span> <span class="st">&quot;joe&quot;</span>,
                <span class="dt">password =</span> <span class="st">&quot;secret&quot;</span>,
                <span class="dt">schema =</span> <span class="st">&quot;cdm&quot;</span>)</code></pre></div>
<pre><code>## Connecting using PostgreSQL driver</code></pre>
<p>See <code>?connect</code> for information on which details are required for each platform. Don’t forget to close any connection afterwards:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">disconnect</span>(conn)</code></pre></div>
<p>Note that, instead of providing the server name, it is also possible to provide the JDBC connection string if this is more convenient:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">conn &lt;-<span class="st"> </span><span class="kw">connect</span>(<span class="dt">dbms =</span> <span class="st">&quot;postgresql&quot;</span>,
                <span class="dt">connectionString =</span> <span class="st">&quot;jdbc:postgresql://localhost:5432/postgres&quot;</span>,
                <span class="dt">user =</span> <span class="st">&quot;joe&quot;</span>,
                <span class="dt">password =</span> <span class="st">&quot;secret&quot;</span>,
                <span class="dt">schema =</span> <span class="st">&quot;cdm&quot;</span>)</code></pre></div>
<pre><code>## Connecting using PostgreSQL driver</code></pre>
<p>Sometimes we may want to first specify the connection details, and defer connecting until later. This may be convenient for example when the connection is established inside a function, and the details need to be passed as an argument. We can use the <code>createConnectionDetails</code> function for this purpose:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">details &lt;-<span class="st"> </span><span class="kw">createConnectionDetails</span>(<span class="dt">dbms =</span> <span class="st">&quot;postgresql&quot;</span>,
                                   <span class="dt">server =</span> <span class="st">&quot;localhost/postgres&quot;</span>,
                                   <span class="dt">user =</span> <span class="st">&quot;joe&quot;</span>,
                                   <span class="dt">password =</span> <span class="st">&quot;secret&quot;</span>,
                                   <span class="dt">schema =</span> <span class="st">&quot;cdm&quot;</span>)
conn &lt;-<span class="st"> </span><span class="kw">connect</span>(details)</code></pre></div>
<pre><code>## Connecting using PostgreSQL driver</code></pre>
</div>
<div id="querying" class="section level3">
<h3><span class="header-section-number">10.2.2</span> Querying</h3>
<p>The main functions for querying database are the <code>querySql</code> and <code>executeSql</code> functions. The difference between these functions is that <code>querySql</code> expects data to be returned by the database, and can handle only one SQL statement at a time. In contrast, <code>executeSql</code> does not expect data to be returned, and accepts multiple SQL statements in a single SQL string.</p>
<p>Some examples:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">querySql</span>(conn, <span class="st">&quot;SELECT TOP 3 * FROM person&quot;</span>)</code></pre></div>
<pre><code>##   PERSON_ID GENDER_CONCEPT_ID YEAR_OF_BIRTH
## 1         1              8507          1975
## 2         2              8507          1976
## 3         3              8507          1977</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">executeSql</span>(conn, <span class="st">&quot;TRUNCATE TABLE foo; DROP TABLE foo; CREATE TABLE foo (bar INT);&quot;</span>)</code></pre></div>
<p>Both function provide extensive error reporting: When an error is thrown by the server, the error message and the offending piece of SQL are written to a text file to allow better debugging. The <code>executeSql</code> function also by default shows a progress bar, indicating the percentage of SQL statements that has been executed. If those attributes are not desired, the package also offers the <code>lowLevelQuerySql</code> and <code>lowLevelExecuteSql</code> functions.</p>
</div>
<div id="querying-using-ffdf-objects" class="section level3">
<h3><span class="header-section-number">10.2.3</span> Querying using ffdf objects</h3>
<p>Sometimes the data to be fetched from the database is too large to fit into memory. In this case one can use the <code>ff</code> package to store R data objects on file, and use them as if they are available in memory. <code>DatabaseConnector</code> can download data directly into ffdf objects:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">querySql.ffdf</span>(conn, <span class="st">&quot;SELECT * FROM person&quot;</span>)</code></pre></div>
<p>Where x is now an ffdf object.</p>
</div>
<div id="querying-different-platforms-using-the-same-sql" class="section level3">
<h3><span class="header-section-number">10.2.4</span> Querying different platforms using the same SQL</h3>
<p>The following convenience functions are available that first call the <code>render</code> and <code>translate</code> functions in the SqlRender package: <code>renderTranslateExecuteSql</code>, <code>renderTranslateQuerySql</code>, <code>renderTranslateQuerySql.ffdf</code>. For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">renderTranslatequerySql</span>(conn, 
                             <span class="dt">sql =</span> <span class="st">&quot;SELECT TOP 10 * FROM @schema.person&quot;</span>,
                             <span class="dt">schema =</span> <span class="st">&quot;cdm_synpuf&quot;</span>)</code></pre></div>
<p>Note that the SQL Server-specific ‘TOP 10’ syntax will be translated to for example ‘LIMIT 10’ on PostgreSQL, and that the SQL parameter <code>@schema</code> will be instantiated with the provided value ‘cdm_synpuf’.</p>
</div>
<div id="inserting-tables" class="section level3">
<h3><span class="header-section-number">10.2.5</span> Inserting tables</h3>
<p>Although it is also possible to insert data in the database by sending SQL statements using the <code>executeSql</code> function, it is often convenient and faster to use the <code>insertTable</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(mtcars)
<span class="kw">insertTable</span>(conn, <span class="st">&quot;mtcars&quot;</span>, mtcars, <span class="dt">createTable =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p>In this example, we’re uploading the mtcars data frame to a table called ‘mtcars’ on the server, that will be automatically created.</p>
</div>
</div>
<div id="querying-the-cdm" class="section level2">
<h2><span class="header-section-number">10.3</span> Querying the CDM</h2>
<p>Querying the CDM</p>
<p>Probably borrow heavily from <a href="https://github.com/OHDSI/QueryLibrary" class="uri">https://github.com/OHDSI/QueryLibrary</a></p>
</div>
<div id="querying-the-vocabulary" class="section level2">
<h2><span class="header-section-number">10.4</span> Querying the vocabulary</h2>
</div>
<div id="using-the-vocabulary-when-querying" class="section level2">
<h2><span class="header-section-number">10.5</span> Using the vocabulary when querying</h2>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="OhdsiAnalyticsTools.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="Cohorts.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/OHDSI/TheBookOfOhdsi/edit/master/SqlAndR.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": ["TheBookOfOhdsi.pdf", "TheBookOfOhdsi.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
