<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 14 Patient Level Prediction | The Book of OHDSI</title>
  <meta name="description" content="A book about the Observational Health Data Science and Informatics (OHDS). It described the OHDSI community, open standards and open source software." />
  <meta name="generator" content="bookdown 0.11.3 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 14 Patient Level Prediction | The Book of OHDSI" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://ohdsi.github.io/TheBookOfOhdsi/" />
  <meta property="og:image" content="https://ohdsi.github.io/TheBookOfOhdsi/images/Cover/Cover.png" />
  <meta property="og:description" content="A book about the Observational Health Data Science and Informatics (OHDS). It described the OHDSI community, open standards and open source software." />
  <meta name="github-repo" content="OHDSI/TheBookOfOhdsi" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 14 Patient Level Prediction | The Book of OHDSI" />
  
  <meta name="twitter:description" content="A book about the Observational Health Data Science and Informatics (OHDS). It described the OHDSI community, open standards and open source software." />
  <meta name="twitter:image" content="https://ohdsi.github.io/TheBookOfOhdsi/images/Cover/Cover.png" />

<meta name="author" content="Observational Health Data Science and Informatics" />


<meta name="date" content="2019-07-06" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon" />
<link rel="prev" href="PopulationLevelEstimation.html">
<link rel="next" href="EvidenceQuality.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-104086677-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-104086677-2');
</script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">The Book of OHDSI</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#goals-of-this-book"><i class="fa fa-check"></i>Goals of this book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#structure-of-the-book"><i class="fa fa-check"></i>Structure of the book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#contributors"><i class="fa fa-check"></i>Contributors</a></li>
</ul></li>
<li class="part"><span><b>I The OHDSI Community</b></span></li>
<li class="chapter" data-level="1" data-path="MissionVissionValues.html"><a href="MissionVissionValues.html"><i class="fa fa-check"></i><b>1</b> Mission, vision, values</a><ul>
<li class="chapter" data-level="1.1" data-path="MissionVissionValues.html"><a href="MissionVissionValues.html#our-mission"><i class="fa fa-check"></i><b>1.1</b> Our Mission</a></li>
<li class="chapter" data-level="1.2" data-path="MissionVissionValues.html"><a href="MissionVissionValues.html#our-vision"><i class="fa fa-check"></i><b>1.2</b> Our Vision</a></li>
<li class="chapter" data-level="1.3" data-path="MissionVissionValues.html"><a href="MissionVissionValues.html#our-objectives"><i class="fa fa-check"></i><b>1.3</b> Our Objectives</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="Collaborators.html"><a href="Collaborators.html"><i class="fa fa-check"></i><b>2</b> Collaborators</a></li>
<li class="chapter" data-level="3" data-path="OpenScience.html"><a href="OpenScience.html"><i class="fa fa-check"></i><b>3</b> Open Science</a><ul>
<li class="chapter" data-level="3.1" data-path="OpenScience.html"><a href="OpenScience.html#open-science"><i class="fa fa-check"></i><b>3.1</b> Open Science</a></li>
<li class="chapter" data-level="3.2" data-path="OpenScience.html"><a href="OpenScience.html#fair-guiding-principles"><i class="fa fa-check"></i><b>3.2</b> FAIR Guiding Principles</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="WhereToBegin.html"><a href="WhereToBegin.html"><i class="fa fa-check"></i><b>4</b> Where to begin</a></li>
<li class="part"><span><b>II Uniform Data Representation</b></span></li>
<li class="chapter" data-level="5" data-path="CommonDataModel.html"><a href="CommonDataModel.html"><i class="fa fa-check"></i><b>5</b> The Common Data Model</a><ul>
<li class="chapter" data-level="5.1" data-path="CommonDataModel.html"><a href="CommonDataModel.html#design-principles"><i class="fa fa-check"></i><b>5.1</b> Design Principles</a></li>
<li class="chapter" data-level="5.2" data-path="CommonDataModel.html"><a href="CommonDataModel.html#data-model-conventions"><i class="fa fa-check"></i><b>5.2</b> Data Model Conventions</a><ul>
<li class="chapter" data-level="5.2.1" data-path="CommonDataModel.html"><a href="CommonDataModel.html#model-conv"><i class="fa fa-check"></i><b>5.2.1</b> General conventions of the model</a></li>
<li class="chapter" data-level="5.2.2" data-path="CommonDataModel.html"><a href="CommonDataModel.html#general-conventions-of-schemas"><i class="fa fa-check"></i><b>5.2.2</b> General conventions of schemas</a></li>
<li class="chapter" data-level="5.2.3" data-path="CommonDataModel.html"><a href="CommonDataModel.html#general-conventions-of-data-tables"><i class="fa fa-check"></i><b>5.2.3</b> General conventions of data tables</a></li>
<li class="chapter" data-level="5.2.4" data-path="CommonDataModel.html"><a href="CommonDataModel.html#general-conventions-of-fields"><i class="fa fa-check"></i><b>5.2.4</b> General conventions of fields</a></li>
<li class="chapter" data-level="5.2.5" data-path="CommonDataModel.html"><a href="CommonDataModel.html#representation-of-content-through-concepts"><i class="fa fa-check"></i><b>5.2.5</b> Representation of content through Concepts</a></li>
<li class="chapter" data-level="5.2.6" data-path="CommonDataModel.html"><a href="CommonDataModel.html#difference-between-concept-ids-and-source-values"><i class="fa fa-check"></i><b>5.2.6</b> Difference between Concept IDs and Source Values</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="CommonDataModel.html"><a href="CommonDataModel.html#omop-cdm-standardized-tables"><i class="fa fa-check"></i><b>5.3</b> OMOP CDM Standardized Tables</a><ul>
<li class="chapter" data-level="5.3.1" data-path="CommonDataModel.html"><a href="CommonDataModel.html#running-example-endometriosis"><i class="fa fa-check"></i><b>5.3.1</b> Running Example: Endometriosis</a></li>
<li class="chapter" data-level="5.3.2" data-path="CommonDataModel.html"><a href="CommonDataModel.html#person"><i class="fa fa-check"></i><b>5.3.2</b> PERSON table</a></li>
<li class="chapter" data-level="5.3.3" data-path="CommonDataModel.html"><a href="CommonDataModel.html#observationPeriod"><i class="fa fa-check"></i><b>5.3.3</b> OBSERVATION_PERIOD table</a></li>
<li class="chapter" data-level="5.3.4" data-path="CommonDataModel.html"><a href="CommonDataModel.html#visitOccurrence"><i class="fa fa-check"></i><b>5.3.4</b> VISIT_OCCURRENCE</a></li>
<li class="chapter" data-level="5.3.5" data-path="CommonDataModel.html"><a href="CommonDataModel.html#conditionOccurrence"><i class="fa fa-check"></i><b>5.3.5</b> CONDITION_OCCURRENCE</a></li>
<li class="chapter" data-level="5.3.6" data-path="CommonDataModel.html"><a href="CommonDataModel.html#drugExposure"><i class="fa fa-check"></i><b>5.3.6</b> DRUG_EXPOSURE</a></li>
<li class="chapter" data-level="5.3.7" data-path="CommonDataModel.html"><a href="CommonDataModel.html#procedureOccurrence"><i class="fa fa-check"></i><b>5.3.7</b> PROCEDURE_OCCURRENCE</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="CommonDataModel.html"><a href="CommonDataModel.html#summary"><i class="fa fa-check"></i><b>5.4</b> Summary</a></li>
<li class="chapter" data-level="5.5" data-path="CommonDataModel.html"><a href="CommonDataModel.html#exercises"><i class="fa fa-check"></i><b>5.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="StandardizedVocabularies.html"><a href="StandardizedVocabularies.html"><i class="fa fa-check"></i><b>6</b> Standardized Vocabularies</a></li>
<li class="chapter" data-level="7" data-path="ExtractTransformLoad.html"><a href="ExtractTransformLoad.html"><i class="fa fa-check"></i><b>7</b> Extract Transform Load</a></li>
<li class="part"><span><b>III Data Analytics</b></span></li>
<li class="chapter" data-level="8" data-path="DataAnalyticsUseCases.html"><a href="DataAnalyticsUseCases.html"><i class="fa fa-check"></i><b>8</b> Data Analytics Use Cases</a><ul>
<li class="chapter" data-level="8.1" data-path="DataAnalyticsUseCases.html"><a href="DataAnalyticsUseCases.html#characterization"><i class="fa fa-check"></i><b>8.1</b> Characterization</a></li>
<li class="chapter" data-level="8.2" data-path="DataAnalyticsUseCases.html"><a href="DataAnalyticsUseCases.html#population-level-estimation"><i class="fa fa-check"></i><b>8.2</b> Population-level estimation</a></li>
<li class="chapter" data-level="8.3" data-path="DataAnalyticsUseCases.html"><a href="DataAnalyticsUseCases.html#patient-level-prediction"><i class="fa fa-check"></i><b>8.3</b> Patient-Level prediction</a></li>
<li class="chapter" data-level="8.4" data-path="DataAnalyticsUseCases.html"><a href="DataAnalyticsUseCases.html#limitations-of-observational-research"><i class="fa fa-check"></i><b>8.4</b> Limitations of observational research</a><ul>
<li class="chapter" data-level="8.4.1" data-path="DataAnalyticsUseCases.html"><a href="DataAnalyticsUseCases.html#missing-data"><i class="fa fa-check"></i><b>8.4.1</b> Missing data</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="DataAnalyticsUseCases.html"><a href="DataAnalyticsUseCases.html#summary-1"><i class="fa fa-check"></i><b>8.5</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html"><i class="fa fa-check"></i><b>9</b> OHDSI Analytics Tools</a><ul>
<li class="chapter" data-level="9.1" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#analysisImplementation"><i class="fa fa-check"></i><b>9.1</b> Analysis implementation</a></li>
<li class="chapter" data-level="9.2" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#analysis-strategy"><i class="fa fa-check"></i><b>9.2</b> Analysis strategy</a></li>
<li class="chapter" data-level="9.3" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#atlas"><i class="fa fa-check"></i><b>9.3</b> ATLAS</a><ul>
<li class="chapter" data-level="9.3.1" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#security"><i class="fa fa-check"></i><b>9.3.1</b> Security</a></li>
<li class="chapter" data-level="9.3.2" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#documentation"><i class="fa fa-check"></i><b>9.3.2</b> Documentation</a></li>
<li class="chapter" data-level="9.3.3" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#system-requirements"><i class="fa fa-check"></i><b>9.3.3</b> System requirements</a></li>
<li class="chapter" data-level="9.3.4" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#how-to-install"><i class="fa fa-check"></i><b>9.3.4</b> How to install</a></li>
</ul></li>
<li class="chapter" data-level="9.4" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#methods-library"><i class="fa fa-check"></i><b>9.4</b> Methods Library</a><ul>
<li class="chapter" data-level="9.4.1" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#support-for-large-scale-analytics"><i class="fa fa-check"></i><b>9.4.1</b> Support for large-scale analytics</a></li>
<li class="chapter" data-level="9.4.2" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#BigDataSupport"><i class="fa fa-check"></i><b>9.4.2</b> Support for big data</a></li>
<li class="chapter" data-level="9.4.3" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#documentation-1"><i class="fa fa-check"></i><b>9.4.3</b> Documentation</a></li>
<li class="chapter" data-level="9.4.4" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#system-requirements-1"><i class="fa fa-check"></i><b>9.4.4</b> System requirements</a></li>
<li class="chapter" data-level="9.4.5" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#how-to-install-1"><i class="fa fa-check"></i><b>9.4.5</b> How to install</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#installing-java"><i class="fa fa-check"></i><b>9.5</b> Installing Java</a></li>
<li class="chapter" data-level="9.6" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#deployment-strategies"><i class="fa fa-check"></i><b>9.6</b> Deployment strategies</a><ul>
<li class="chapter" data-level="9.6.1" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#broadsea"><i class="fa fa-check"></i><b>9.6.1</b> Broadsea</a></li>
<li class="chapter" data-level="9.6.2" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#amazon-aws"><i class="fa fa-check"></i><b>9.6.2</b> Amazon AWS</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#summary-2"><i class="fa fa-check"></i><b>9.7</b> Summary</a></li>
<li class="chapter" data-level="9.8" data-path="OhdsiAnalyticsTools.html"><a href="OhdsiAnalyticsTools.html#exercises-1"><i class="fa fa-check"></i><b>9.8</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="SqlAndR.html"><a href="SqlAndR.html"><i class="fa fa-check"></i><b>10</b> SQL and R</a><ul>
<li class="chapter" data-level="10.1" data-path="SqlAndR.html"><a href="SqlAndR.html#SqlRender"><i class="fa fa-check"></i><b>10.1</b> SqlRender</a><ul>
<li class="chapter" data-level="10.1.1" data-path="SqlAndR.html"><a href="SqlAndR.html#sql-parameterization"><i class="fa fa-check"></i><b>10.1.1</b> SQL parameterization</a></li>
<li class="chapter" data-level="10.1.2" data-path="SqlAndR.html"><a href="SqlAndR.html#translation-to-other-sql-dialects"><i class="fa fa-check"></i><b>10.1.2</b> Translation to other SQL dialects</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="SqlAndR.html"><a href="SqlAndR.html#DatabaseConnector"><i class="fa fa-check"></i><b>10.2</b> DatabaseConnector</a><ul>
<li class="chapter" data-level="10.2.1" data-path="SqlAndR.html"><a href="SqlAndR.html#creating-a-connection"><i class="fa fa-check"></i><b>10.2.1</b> Creating a connection</a></li>
<li class="chapter" data-level="10.2.2" data-path="SqlAndR.html"><a href="SqlAndR.html#querying"><i class="fa fa-check"></i><b>10.2.2</b> Querying</a></li>
<li class="chapter" data-level="10.2.3" data-path="SqlAndR.html"><a href="SqlAndR.html#querying-using-ffdf-objects"><i class="fa fa-check"></i><b>10.2.3</b> Querying using ffdf objects</a></li>
<li class="chapter" data-level="10.2.4" data-path="SqlAndR.html"><a href="SqlAndR.html#querying-different-platforms-using-the-same-sql"><i class="fa fa-check"></i><b>10.2.4</b> Querying different platforms using the same SQL</a></li>
<li class="chapter" data-level="10.2.5" data-path="SqlAndR.html"><a href="SqlAndR.html#inserting-tables"><i class="fa fa-check"></i><b>10.2.5</b> Inserting tables</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="SqlAndR.html"><a href="SqlAndR.html#QueryTheCdm"><i class="fa fa-check"></i><b>10.3</b> Querying the CDM</a></li>
<li class="chapter" data-level="10.4" data-path="SqlAndR.html"><a href="SqlAndR.html#using-the-vocabulary-when-querying"><i class="fa fa-check"></i><b>10.4</b> Using the vocabulary when querying</a></li>
<li class="chapter" data-level="10.5" data-path="SqlAndR.html"><a href="SqlAndR.html#querylibrary"><i class="fa fa-check"></i><b>10.5</b> QueryLibrary</a></li>
<li class="chapter" data-level="10.6" data-path="SqlAndR.html"><a href="SqlAndR.html#designing-a-simple-study"><i class="fa fa-check"></i><b>10.6</b> Designing a simple study</a><ul>
<li class="chapter" data-level="10.6.1" data-path="SqlAndR.html"><a href="SqlAndR.html#problem-definition"><i class="fa fa-check"></i><b>10.6.1</b> Problem definition</a></li>
<li class="chapter" data-level="10.6.2" data-path="SqlAndR.html"><a href="SqlAndR.html#exposure"><i class="fa fa-check"></i><b>10.6.2</b> Exposure</a></li>
<li class="chapter" data-level="10.6.3" data-path="SqlAndR.html"><a href="SqlAndR.html#outcome"><i class="fa fa-check"></i><b>10.6.3</b> Outcome</a></li>
<li class="chapter" data-level="10.6.4" data-path="SqlAndR.html"><a href="SqlAndR.html#time-at-risk"><i class="fa fa-check"></i><b>10.6.4</b> Time-at-risk</a></li>
</ul></li>
<li class="chapter" data-level="10.7" data-path="SqlAndR.html"><a href="SqlAndR.html#implementing-the-study-using-sql-and-r"><i class="fa fa-check"></i><b>10.7</b> Implementing the study using SQL and R</a><ul>
<li class="chapter" data-level="10.7.1" data-path="SqlAndR.html"><a href="SqlAndR.html#exposure-cohort"><i class="fa fa-check"></i><b>10.7.1</b> Exposure cohort</a></li>
<li class="chapter" data-level="10.7.2" data-path="SqlAndR.html"><a href="SqlAndR.html#outcome-cohort"><i class="fa fa-check"></i><b>10.7.2</b> Outcome cohort</a></li>
<li class="chapter" data-level="10.7.3" data-path="SqlAndR.html"><a href="SqlAndR.html#incidence-rate-calculation"><i class="fa fa-check"></i><b>10.7.3</b> Incidence rate calculation</a></li>
<li class="chapter" data-level="10.7.4" data-path="SqlAndR.html"><a href="SqlAndR.html#clean-up"><i class="fa fa-check"></i><b>10.7.4</b> Clean up</a></li>
<li class="chapter" data-level="10.7.5" data-path="SqlAndR.html"><a href="SqlAndR.html#compatibility"><i class="fa fa-check"></i><b>10.7.5</b> Compatibility</a></li>
</ul></li>
<li class="chapter" data-level="10.8" data-path="SqlAndR.html"><a href="SqlAndR.html#summary-3"><i class="fa fa-check"></i><b>10.8</b> Summary</a></li>
<li class="chapter" data-level="10.9" data-path="SqlAndR.html"><a href="SqlAndR.html#exercises-2"><i class="fa fa-check"></i><b>10.9</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="Cohorts.html"><a href="Cohorts.html"><i class="fa fa-check"></i><b>11</b> Building the building blocks: cohorts</a></li>
<li class="chapter" data-level="12" data-path="Characterization.html"><a href="Characterization.html"><i class="fa fa-check"></i><b>12</b> Characterization</a></li>
<li class="chapter" data-level="13" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html"><i class="fa fa-check"></i><b>13</b> Population-level estimation</a><ul>
<li class="chapter" data-level="13.1" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#CohortMethod"><i class="fa fa-check"></i><b>13.1</b> The cohort method design</a><ul>
<li class="chapter" data-level="13.1.1" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#propensity-scores"><i class="fa fa-check"></i><b>13.1.1</b> Propensity scores</a></li>
<li class="chapter" data-level="13.1.2" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#VariableSelection"><i class="fa fa-check"></i><b>13.1.2</b> Variable selection</a></li>
<li class="chapter" data-level="13.1.3" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#caliper"><i class="fa fa-check"></i><b>13.1.3</b> Caliper</a></li>
<li class="chapter" data-level="13.1.4" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#overlap-preference-scores"><i class="fa fa-check"></i><b>13.1.4</b> Overlap: preference scores</a></li>
<li class="chapter" data-level="13.1.5" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#balance"><i class="fa fa-check"></i><b>13.1.5</b> Balance</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#the-self-controlled-cohort-design"><i class="fa fa-check"></i><b>13.2</b> The self-controlled cohort design</a></li>
<li class="chapter" data-level="13.3" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#the-case-control-design"><i class="fa fa-check"></i><b>13.3</b> The case-control design</a></li>
<li class="chapter" data-level="13.4" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#the-case-crossover-design"><i class="fa fa-check"></i><b>13.4</b> The case-crossover design</a></li>
<li class="chapter" data-level="13.5" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#the-self-controlled-case-series-design"><i class="fa fa-check"></i><b>13.5</b> The self-controlled case series design</a></li>
<li class="chapter" data-level="13.6" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#designing-a-hypertension-study"><i class="fa fa-check"></i><b>13.6</b> Designing a hypertension study</a><ul>
<li class="chapter" data-level="13.6.1" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#problem-definition-1"><i class="fa fa-check"></i><b>13.6.1</b> Problem definition</a></li>
<li class="chapter" data-level="13.6.2" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#target-and-comparator"><i class="fa fa-check"></i><b>13.6.2</b> Target and comparator</a></li>
<li class="chapter" data-level="13.6.3" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#outcome-1"><i class="fa fa-check"></i><b>13.6.3</b> Outcome</a></li>
<li class="chapter" data-level="13.6.4" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#time-at-risk-1"><i class="fa fa-check"></i><b>13.6.4</b> Time-at-risk</a></li>
<li class="chapter" data-level="13.6.5" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#model"><i class="fa fa-check"></i><b>13.6.5</b> Model</a></li>
<li class="chapter" data-level="13.6.6" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#study-summary"><i class="fa fa-check"></i><b>13.6.6</b> Study summary</a></li>
<li class="chapter" data-level="13.6.7" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#control-questions"><i class="fa fa-check"></i><b>13.6.7</b> Control questions</a></li>
</ul></li>
<li class="chapter" data-level="13.7" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#PleAtlas"><i class="fa fa-check"></i><b>13.7</b> Implementing the study using ATLAS</a><ul>
<li class="chapter" data-level="13.7.1" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#ComparisonSettings"><i class="fa fa-check"></i><b>13.7.1</b> Comparative cohort settings</a></li>
<li class="chapter" data-level="13.7.2" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#effect-estimation-analysis-settings"><i class="fa fa-check"></i><b>13.7.2</b> Effect estimation analysis settings</a></li>
<li class="chapter" data-level="13.7.3" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#evaluationSettings"><i class="fa fa-check"></i><b>13.7.3</b> Evaluation settings</a></li>
<li class="chapter" data-level="13.7.4" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#running-the-study-package"><i class="fa fa-check"></i><b>13.7.4</b> Running the study package</a></li>
</ul></li>
<li class="chapter" data-level="13.8" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#pleR"><i class="fa fa-check"></i><b>13.8</b> Implementing the study using R</a><ul>
<li class="chapter" data-level="13.8.1" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#cohort-instantiation"><i class="fa fa-check"></i><b>13.8.1</b> Cohort instantiation</a></li>
<li class="chapter" data-level="13.8.2" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#data-extraction"><i class="fa fa-check"></i><b>13.8.2</b> Data extraction</a></li>
<li class="chapter" data-level="13.8.3" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#defining-the-study-population"><i class="fa fa-check"></i><b>13.8.3</b> Defining the study population</a></li>
<li class="chapter" data-level="13.8.4" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#propensity-scores-1"><i class="fa fa-check"></i><b>13.8.4</b> Propensity scores</a></li>
<li class="chapter" data-level="13.8.5" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#outcome-models"><i class="fa fa-check"></i><b>13.8.5</b> Outcome models</a></li>
<li class="chapter" data-level="13.8.6" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#MultipleAnalyses"><i class="fa fa-check"></i><b>13.8.6</b> Running multiple analyses</a></li>
</ul></li>
<li class="chapter" data-level="13.9" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#studyOutputs"><i class="fa fa-check"></i><b>13.9</b> Study outputs</a><ul>
<li class="chapter" data-level="13.9.1" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#propensity-scores-and-model"><i class="fa fa-check"></i><b>13.9.1</b> Propensity scores and model</a></li>
<li class="chapter" data-level="13.9.2" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#covariate-balance"><i class="fa fa-check"></i><b>13.9.2</b> Covariate balance</a></li>
<li class="chapter" data-level="13.9.3" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#follow-up-and-power"><i class="fa fa-check"></i><b>13.9.3</b> Follow up and power</a></li>
<li class="chapter" data-level="13.9.4" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#kaplan-meier"><i class="fa fa-check"></i><b>13.9.4</b> Kaplan Meier</a></li>
<li class="chapter" data-level="13.9.5" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#effect-size-estimate"><i class="fa fa-check"></i><b>13.9.5</b> Effect size estimate</a></li>
</ul></li>
<li class="chapter" data-level="13.10" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#summary-4"><i class="fa fa-check"></i><b>13.10</b> Summary</a></li>
<li class="chapter" data-level="13.11" data-path="PopulationLevelEstimation.html"><a href="PopulationLevelEstimation.html#excercises"><i class="fa fa-check"></i><b>13.11</b> Excercises</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html"><i class="fa fa-check"></i><b>14</b> Patient Level Prediction</a><ul>
<li class="chapter" data-level="14.1" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#introduction"><i class="fa fa-check"></i><b>14.1</b> Introduction</a></li>
<li class="chapter" data-level="14.2" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#progress"><i class="fa fa-check"></i><b>14.2</b> Current Progress in Patient-Level Prediction</a></li>
<li class="chapter" data-level="14.3" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#extracted"><i class="fa fa-check"></i><b>14.3</b> Creating Labelled Data</a></li>
<li class="chapter" data-level="14.4" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#supervised"><i class="fa fa-check"></i><b>14.4</b> Supervised learning</a><ul>
<li class="chapter" data-level="14.4.1" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#regularized-logistic-regression"><i class="fa fa-check"></i><b>14.4.1</b> Regularized Logistic Regression</a></li>
<li class="chapter" data-level="14.4.2" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#gradient-boosting-machines"><i class="fa fa-check"></i><b>14.4.2</b> Gradient boosting machines</a></li>
<li class="chapter" data-level="14.4.3" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#random-forest"><i class="fa fa-check"></i><b>14.4.3</b> Random forest</a></li>
<li class="chapter" data-level="14.4.4" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#k-nearest-neighbors"><i class="fa fa-check"></i><b>14.4.4</b> K-nearest neighbors</a></li>
<li class="chapter" data-level="14.4.5" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#naive-bayes"><i class="fa fa-check"></i><b>14.4.5</b> Naive Bayes</a></li>
<li class="chapter" data-level="14.4.6" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#adaboost"><i class="fa fa-check"></i><b>14.4.6</b> AdaBoost</a></li>
<li class="chapter" data-level="14.4.7" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#decision-tree"><i class="fa fa-check"></i><b>14.4.7</b> Decision Tree</a></li>
<li class="chapter" data-level="14.4.8" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#multilayer-perception"><i class="fa fa-check"></i><b>14.4.8</b> Multilayer Perception</a></li>
<li class="chapter" data-level="14.4.9" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#deep-learning"><i class="fa fa-check"></i><b>14.4.9</b> Deep Learning</a></li>
</ul></li>
<li class="chapter" data-level="14.5" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#evalaution"><i class="fa fa-check"></i><b>14.5</b> Evaluating Patient-Level Prediction Models</a><ul>
<li class="chapter" data-level="14.5.1" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#evaluation-types"><i class="fa fa-check"></i><b>14.5.1</b> Evaluation Types</a></li>
<li class="chapter" data-level="14.5.2" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#performance"><i class="fa fa-check"></i><b>14.5.2</b> Performance Metrics</a></li>
<li class="chapter" data-level="14.5.3" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#inspecting-the-model"><i class="fa fa-check"></i><b>14.5.3</b> Inspecting the model</a></li>
</ul></li>
<li class="chapter" data-level="14.6" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#specfifying-a-patient-level-prediction-study"><i class="fa fa-check"></i><b>14.6</b> Specfifying a Patient-level Prediction Study</a><ul>
<li class="chapter" data-level="14.6.1" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#problem-definition-2"><i class="fa fa-check"></i><b>14.6.1</b> Problem definition</a></li>
<li class="chapter" data-level="14.6.2" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#study-population-definition"><i class="fa fa-check"></i><b>14.6.2</b> Study population definition</a></li>
<li class="chapter" data-level="14.6.3" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#model-development-settings"><i class="fa fa-check"></i><b>14.6.3</b> Model development settings</a></li>
<li class="chapter" data-level="14.6.4" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#model-evaluation"><i class="fa fa-check"></i><b>14.6.4</b> Model evaluation</a></li>
<li class="chapter" data-level="14.6.5" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#study-summary-1"><i class="fa fa-check"></i><b>14.6.5</b> Study summary</a></li>
</ul></li>
<li class="chapter" data-level="14.7" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#implementing-the-study-in-atlas"><i class="fa fa-check"></i><b>14.7</b> Implementing the study in Atlas</a><ul>
<li class="chapter" data-level="14.7.1" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#introduction-1"><i class="fa fa-check"></i><b>14.7.1</b> Introduction</a></li>
<li class="chapter" data-level="14.7.2" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#the-atlas-layout"><i class="fa fa-check"></i><b>14.7.2</b> The Atlas layout</a></li>
<li class="chapter" data-level="14.7.3" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#atlas-specification-tab"><i class="fa fa-check"></i><b>14.7.3</b> Atlas Specification Tab</a></li>
<li class="chapter" data-level="14.7.4" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#prediction-problem-settings"><i class="fa fa-check"></i><b>14.7.4</b> Prediction Problem Settings</a></li>
<li class="chapter" data-level="14.7.5" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#analysis-settings"><i class="fa fa-check"></i><b>14.7.5</b> Analysis Settings</a></li>
<li class="chapter" data-level="14.7.6" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#model-settings"><i class="fa fa-check"></i><b>14.7.6</b> Model Settings</a></li>
<li class="chapter" data-level="14.7.7" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#covariate-settings"><i class="fa fa-check"></i><b>14.7.7</b> Covariate Settings</a></li>
<li class="chapter" data-level="14.7.8" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#population-settings"><i class="fa fa-check"></i><b>14.7.8</b> Population Settings</a></li>
<li class="chapter" data-level="14.7.9" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#execution-settings"><i class="fa fa-check"></i><b>14.7.9</b> Execution settings</a></li>
<li class="chapter" data-level="14.7.10" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#training-settings"><i class="fa fa-check"></i><b>14.7.10</b> Training settings</a></li>
<li class="chapter" data-level="14.7.11" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#atlas-utilities-tab"><i class="fa fa-check"></i><b>14.7.11</b> Atlas Utilities Tab</a></li>
<li class="chapter" data-level="14.7.12" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#how-to-importexport-study"><i class="fa fa-check"></i><b>14.7.12</b> How to import/export study</a></li>
<li class="chapter" data-level="14.7.13" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#how-to-download-package"><i class="fa fa-check"></i><b>14.7.13</b> How to download package</a></li>
<li class="chapter" data-level="14.7.14" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#building-atlas-created-prediction-study-r-package"><i class="fa fa-check"></i><b>14.7.14</b> Building Atlas created prediction study R package</a></li>
<li class="chapter" data-level="14.7.15" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#running-study"><i class="fa fa-check"></i><b>14.7.15</b> Running Study</a></li>
</ul></li>
<li class="chapter" data-level="14.8" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#implementing-the-study-in-r"><i class="fa fa-check"></i><b>14.8</b> Implementing the study in R</a><ul>
<li class="chapter" data-level="14.8.1" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#cohort-instantiation-1"><i class="fa fa-check"></i><b>14.8.1</b> Cohort instantiation</a></li>
<li class="chapter" data-level="14.8.2" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#data-extraction-1"><i class="fa fa-check"></i><b>14.8.2</b> Data extraction</a></li>
<li class="chapter" data-level="14.8.3" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#additional-inclusion-criteria"><i class="fa fa-check"></i><b>14.8.3</b> Additional inclusion criteria</a></li>
<li class="chapter" data-level="14.8.4" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#model-development"><i class="fa fa-check"></i><b>14.8.4</b> Model Development</a></li>
<li class="chapter" data-level="14.8.5" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#internal-validation"><i class="fa fa-check"></i><b>14.8.5</b> Internal Validation</a></li>
</ul></li>
<li class="chapter" data-level="14.9" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#exploring-a-single-plp-shiny-app"><i class="fa fa-check"></i><b>14.9</b> Exploring a single PLP Shiny App</a></li>
<li class="chapter" data-level="14.10" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#exploring-the-atlas-plp-shiny-app"><i class="fa fa-check"></i><b>14.10</b> Exploring the Atlas PLP Shiny App</a></li>
<li class="chapter" data-level="14.11" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#additional-patient-level-prediction-features"><i class="fa fa-check"></i><b>14.11</b> Additional Patient-level Prediction Features</a><ul>
<li class="chapter" data-level="14.11.1" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#journal-paper-generation"><i class="fa fa-check"></i><b>14.11.1</b> Journal paper generation</a></li>
</ul></li>
<li class="chapter" data-level="14.12" data-path="PatientLevelPrediction.html"><a href="PatientLevelPrediction.html#excercises-1"><i class="fa fa-check"></i><b>14.12</b> Excercises</a></li>
</ul></li>
<li class="part"><span><b>IV Evidence Quality</b></span></li>
<li class="chapter" data-level="15" data-path="EvidenceQuality.html"><a href="EvidenceQuality.html"><i class="fa fa-check"></i><b>15</b> Introduction to Evidence Quality</a></li>
<li class="chapter" data-level="16" data-path="DataQuality.html"><a href="DataQuality.html"><i class="fa fa-check"></i><b>16</b> Data Quality</a><ul>
<li class="chapter" data-level="16.1" data-path="DataQuality.html"><a href="DataQuality.html#introduction-2"><i class="fa fa-check"></i><b>16.1</b> Introduction</a></li>
<li class="chapter" data-level="16.2" data-path="DataQuality.html"><a href="DataQuality.html#achilles-heel-tool"><i class="fa fa-check"></i><b>16.2</b> Achilles Heel tool</a><ul>
<li class="chapter" data-level="16.2.1" data-path="DataQuality.html"><a href="DataQuality.html#precomputed-analyses"><i class="fa fa-check"></i><b>16.2.1</b> Precomputed Analyses</a></li>
<li class="chapter" data-level="16.2.2" data-path="DataQuality.html"><a href="DataQuality.html#example-dq-check"><i class="fa fa-check"></i><b>16.2.2</b> Example DQ check</a></li>
<li class="chapter" data-level="16.2.3" data-path="DataQuality.html"><a href="DataQuality.html#overview-of-existing-dq-heel-checks"><i class="fa fa-check"></i><b>16.2.3</b> Overview of existing DQ Heel checks</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="DataQuality.html"><a href="DataQuality.html#study-specific-checks"><i class="fa fa-check"></i><b>16.3</b> Study-specific checks</a><ul>
<li class="chapter" data-level="16.3.1" data-path="DataQuality.html"><a href="DataQuality.html#outcomes"><i class="fa fa-check"></i><b>16.3.1</b> Outcomes</a></li>
<li class="chapter" data-level="16.3.2" data-path="DataQuality.html"><a href="DataQuality.html#laboratory-data"><i class="fa fa-check"></i><b>16.3.2</b> Laboratory data</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="DataQuality.html"><a href="DataQuality.html#etl-unit-testing"><i class="fa fa-check"></i><b>16.4</b> ETL unit testing</a><ul>
<li class="chapter" data-level="16.4.1" data-path="DataQuality.html"><a href="DataQuality.html#unit-testing-framwork-in-rabbit-in-a-hat"><i class="fa fa-check"></i><b>16.4.1</b> Unit testing framwork in Rabbit-in-a-Hat</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="17" data-path="ClinicalValidity.html"><a href="ClinicalValidity.html"><i class="fa fa-check"></i><b>17</b> Clinical Validity</a></li>
<li class="chapter" data-level="18" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html"><i class="fa fa-check"></i><b>18</b> Software Validity</a><ul>
<li class="chapter" data-level="18.1" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#study-code-validity"><i class="fa fa-check"></i><b>18.1</b> Study code validity</a><ul>
<li class="chapter" data-level="18.1.1" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#automation"><i class="fa fa-check"></i><b>18.1.1</b> Automation as a requirement for reproducibility</a></li>
<li class="chapter" data-level="18.1.2" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#programming-best-practices"><i class="fa fa-check"></i><b>18.1.2</b> Programming best practices</a></li>
<li class="chapter" data-level="18.1.3" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#code-validation"><i class="fa fa-check"></i><b>18.1.3</b> Code validation</a></li>
<li class="chapter" data-level="18.1.4" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#using-the-methods-library"><i class="fa fa-check"></i><b>18.1.4</b> Using the Methods Library</a></li>
</ul></li>
<li class="chapter" data-level="18.2" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#methods-library-software-development-process"><i class="fa fa-check"></i><b>18.2</b> Methods Library software development process</a><ul>
<li class="chapter" data-level="18.2.1" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#source-code-management"><i class="fa fa-check"></i><b>18.2.1</b> Source Code Management</a></li>
<li class="chapter" data-level="18.2.2" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#documentation-2"><i class="fa fa-check"></i><b>18.2.2</b> Documentation</a></li>
<li class="chapter" data-level="18.2.3" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#availability-of-current-and-historical-archive-versions"><i class="fa fa-check"></i><b>18.2.3</b> Availability of Current and Historical Archive Versions</a></li>
<li class="chapter" data-level="18.2.4" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#maintenance-support-and-retirement"><i class="fa fa-check"></i><b>18.2.4</b> Maintenance, Support and Retirement</a></li>
<li class="chapter" data-level="18.2.5" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#qualified-personnel"><i class="fa fa-check"></i><b>18.2.5</b> Qualified Personnel</a></li>
<li class="chapter" data-level="18.2.6" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#physical-and-logical-security"><i class="fa fa-check"></i><b>18.2.6</b> Physical and Logical Security</a></li>
<li class="chapter" data-level="18.2.7" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#disaster-recovery"><i class="fa fa-check"></i><b>18.2.7</b> Disaster Recovery</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#methods-library-testing"><i class="fa fa-check"></i><b>18.3</b> Methods Library testing</a><ul>
<li class="chapter" data-level="18.3.1" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#unit-test"><i class="fa fa-check"></i><b>18.3.1</b> Unit test</a></li>
<li class="chapter" data-level="18.3.2" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#simulation"><i class="fa fa-check"></i><b>18.3.2</b> Simulation</a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="SoftwareValidity.html"><a href="SoftwareValidity.html#summary-5"><i class="fa fa-check"></i><b>18.4</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="MethodValidity.html"><a href="MethodValidity.html"><i class="fa fa-check"></i><b>19</b> Method Validity</a><ul>
<li class="chapter" data-level="19.1" data-path="MethodValidity.html"><a href="MethodValidity.html#design-specific-diagnostics"><i class="fa fa-check"></i><b>19.1</b> Design-specific diagnostics</a></li>
<li class="chapter" data-level="19.2" data-path="MethodValidity.html"><a href="MethodValidity.html#diagnostics-for-all-estimation"><i class="fa fa-check"></i><b>19.2</b> Diagnostics for all estimation</a><ul>
<li class="chapter" data-level="19.2.1" data-path="MethodValidity.html"><a href="MethodValidity.html#NegativeControls"><i class="fa fa-check"></i><b>19.2.1</b> Negative controls</a></li>
<li class="chapter" data-level="19.2.2" data-path="MethodValidity.html"><a href="MethodValidity.html#PositiveControls"><i class="fa fa-check"></i><b>19.2.2</b> Positive controls</a></li>
<li class="chapter" data-level="19.2.3" data-path="MethodValidity.html"><a href="MethodValidity.html#metrics"><i class="fa fa-check"></i><b>19.2.3</b> Empirical evaluation</a></li>
<li class="chapter" data-level="19.2.4" data-path="MethodValidity.html"><a href="MethodValidity.html#p-value-calibration"><i class="fa fa-check"></i><b>19.2.4</b> P-value calibration</a></li>
<li class="chapter" data-level="19.2.5" data-path="MethodValidity.html"><a href="MethodValidity.html#confidence-interval-calibration"><i class="fa fa-check"></i><b>19.2.5</b> Confidence interval calibration</a></li>
<li class="chapter" data-level="19.2.6" data-path="MethodValidity.html"><a href="MethodValidity.html#replication-across-sites"><i class="fa fa-check"></i><b>19.2.6</b> Replication across sites</a></li>
<li class="chapter" data-level="19.2.7" data-path="MethodValidity.html"><a href="MethodValidity.html#sensitivity-analyses"><i class="fa fa-check"></i><b>19.2.7</b> Sensitivity analyses</a></li>
</ul></li>
<li class="chapter" data-level="19.3" data-path="MethodValidity.html"><a href="MethodValidity.html#method-validation-in-practice"><i class="fa fa-check"></i><b>19.3</b> Method validation in practice</a><ul>
<li class="chapter" data-level="19.3.1" data-path="MethodValidity.html"><a href="MethodValidity.html#selecting-negative-controls"><i class="fa fa-check"></i><b>19.3.1</b> Selecting negative controls</a></li>
<li class="chapter" data-level="19.3.2" data-path="MethodValidity.html"><a href="MethodValidity.html#including-controls"><i class="fa fa-check"></i><b>19.3.2</b> Including controls</a></li>
<li class="chapter" data-level="19.3.3" data-path="MethodValidity.html"><a href="MethodValidity.html#empirical-performance"><i class="fa fa-check"></i><b>19.3.3</b> Empirical performance</a></li>
<li class="chapter" data-level="19.3.4" data-path="MethodValidity.html"><a href="MethodValidity.html#p-value-calibration-1"><i class="fa fa-check"></i><b>19.3.4</b> P-value calibration</a></li>
<li class="chapter" data-level="19.3.5" data-path="MethodValidity.html"><a href="MethodValidity.html#confidence-interval-calibration-1"><i class="fa fa-check"></i><b>19.3.5</b> Confidence interval calibration</a></li>
<li class="chapter" data-level="19.3.6" data-path="MethodValidity.html"><a href="MethodValidity.html#between-database-heterogeneity"><i class="fa fa-check"></i><b>19.3.6</b> Between-database heterogeneity</a></li>
<li class="chapter" data-level="19.3.7" data-path="MethodValidity.html"><a href="MethodValidity.html#sensitivity-analyses-1"><i class="fa fa-check"></i><b>19.3.7</b> Sensitivity analyses</a></li>
</ul></li>
<li class="chapter" data-level="19.4" data-path="MethodValidity.html"><a href="MethodValidity.html#ohdsi-methods-benchmark"><i class="fa fa-check"></i><b>19.4</b> OHDSI Methods Benchmark</a></li>
<li class="chapter" data-level="19.5" data-path="MethodValidity.html"><a href="MethodValidity.html#summary-6"><i class="fa fa-check"></i><b>19.5</b> Summary</a></li>
<li class="chapter" data-level="19.6" data-path="MethodValidity.html"><a href="MethodValidity.html#exercises-3"><i class="fa fa-check"></i><b>19.6</b> Exercises</a></li>
</ul></li>
<li class="part"><span><b>V OHDSI Studies</b></span></li>
<li class="chapter" data-level="20" data-path="StudySteps.html"><a href="StudySteps.html"><i class="fa fa-check"></i><b>20</b> Study steps</a></li>
<li class="chapter" data-level="21" data-path="NetworkResearch.html"><a href="NetworkResearch.html"><i class="fa fa-check"></i><b>21</b> OHDSI Network Research</a><ul>
<li class="chapter" data-level="21.1" data-path="NetworkResearch.html"><a href="NetworkResearch.html#ohdsi-network-study-examples"><i class="fa fa-check"></i><b>21.1</b> OHDSI Network Study Examples</a><ul>
<li class="chapter" data-level="21.1.1" data-path="NetworkResearch.html"><a href="NetworkResearch.html#endometriosis-study"><i class="fa fa-check"></i><b>21.1.1</b> Endometriosis study</a></li>
</ul></li>
<li class="chapter" data-level="21.2" data-path="NetworkResearch.html"><a href="NetworkResearch.html#excercises-2"><i class="fa fa-check"></i><b>21.2</b> Excercises</a><ul>
<li class="chapter" data-level="21.2.1" data-path="NetworkResearch.html"><a href="NetworkResearch.html#defining-a-cohort"><i class="fa fa-check"></i><b>21.2.1</b> Defining a cohort</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="Glossary.html"><a href="Glossary.html"><i class="fa fa-check"></i><b>A</b> Glossary</a></li>
<li class="chapter" data-level="B" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html"><i class="fa fa-check"></i><b>B</b> Cohort definitions</a><ul>
<li class="chapter" data-level="B.1" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#AceInhibitors"><i class="fa fa-check"></i><b>B.1</b> ACE inhibitors</a></li>
<li class="chapter" data-level="B.2" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#AceInhibitorsMono"><i class="fa fa-check"></i><b>B.2</b> New users of ACE inhibitors as first-line monotherapy for hypertension</a></li>
<li class="chapter" data-level="B.3" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#Ami"><i class="fa fa-check"></i><b>B.3</b> Acute myocardial infarction (AMI)</a></li>
<li class="chapter" data-level="B.4" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#Angioedema"><i class="fa fa-check"></i><b>B.4</b> Angioedema</a></li>
<li class="chapter" data-level="B.5" data-path="CohortDefinitions.html"><a href="CohortDefinitions.html#ThiazidesMono"><i class="fa fa-check"></i><b>B.5</b> New users of Thiazide-like diuretics as first-line monotherapy for hypertension</a></li>
</ul></li>
<li class="chapter" data-level="C" data-path="NegativeControlsAppendix.html"><a href="NegativeControlsAppendix.html"><i class="fa fa-check"></i><b>C</b> Negative controls</a><ul>
<li class="chapter" data-level="C.1" data-path="NegativeControlsAppendix.html"><a href="NegativeControlsAppendix.html#AceiThzNsc"><i class="fa fa-check"></i><b>C.1</b> ACEi and THZ</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The Book of OHDSI</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="PatientLevelPrediction" class="section level1">
<h1><span class="header-section-number">Chapter 14</span> Patient Level Prediction</h1>
<p><em>Chapter leads: Peter Rijnbeek &amp; Jenna Reps</em></p>
<div id="introduction" class="section level2">
<h2><span class="header-section-number">14.1</span> Introduction</h2>
<p>It is widely excepted in medicine that prevention is better than cure. If we could identify patients who are at a high risk of developing some illness, then it might be possible to intervene and slow down the progression of, or even prevent, the illness. Big observational healthcare data capture rich information across a diverse and often large patient population. These data are collected retrospectively. It may be possible to learn associations from the data that can be used to calculate patient-level predictions for various illnesses or health outcomes. In this chapter we consider predicting the general tasks:</p>
<ul>
<li>Disease onset and progression
<ul>
<li><strong>Structure</strong>: Amongst patients who are newly diagnosed with <em>[a disease]</em>, who will go on to have <em>[another disease or complication]</em> within <em>[time horizon from diagnosis]</em>?</li>
<li><strong>Example</strong>: Among newly diagnosed atrial fibrilation patients, who will go on to have ischemic stroke in the next three years?</li>
</ul></li>
<li>Treatment choice
<ul>
<li><strong>Structure</strong>: Amongst patients with <em>[indicated disease]</em> who are treated with either <em>[treatment 1]</em> or <em>[treatment 2]</em>, which patients were treated with <em>[treatment 1]</em> (on day 0).</li>
<li><strong>Example</strong>: Among patients with atrial fibrilation who took either warfarin or rivaroxaban, which patients gets warfarin? (e.g. for a propensity model)</li>
</ul></li>
<li>Treatment response
<ul>
<li><strong>Structure</strong>: Amongst new users of <em>[a treatment]</em>, who will experience <em>[some effect]</em> in <em>[time window]</em> ?</li>
<li><strong>Example</strong>: Which patients with diabetes who start on metformin stay on metform for three years?</li>
</ul></li>
<li>Treatment safety
<ul>
<li><strong>Structure</strong>: Amongst new users of <em>[a treatment]</em>, who will experience <em>[adverse event]</em> in <em>[time window]</em>?</li>
<li><strong>Example</strong>: Amongst new users of warfarin, who will have a GI bleed in one year?</li>
</ul></li>
<li>Treatment adherence
<ul>
<li><strong>Structure</strong>: Amongst new users of <em>[a treatment]</em>, who will achieve <em>[adherence metric]</em> at <em>[time window]</em>?</li>
<li><strong>Example</strong>: Which patients with diabetes who start on metformin achieve &gt;=80% proportion of days covered at one year?</li>
</ul></li>
</ul>
<p>All these examples answer the question, within some target population predict the occurrence of some outcome during some time interval relative to the target population index. Prediction models can be used to find groups of patients that are at a high or low risk of some health outcome or to calculate a patient’s personalized risk. However, prediction does not tell us anything about the causality relationship between the predictors and the outcome. If you are interested in causal inference, then you want to read Chapter [add link to Population level estimation].</p>
<p>In this chapter we first describe the theory behind patient-level prediction, including a <a href="PatientLevelPrediction.html#progress">summary of current progress in patient-level prediction</a>, details about <a href="PatientLevelPrediction.html#extracted">how labeled data are extracted</a> from observational databases, an <a href="PatientLevelPrediction.html#supervised">overview of supervised learning</a> and the various classifiers and how to <a href="#evaluation">evaluate the performance of a model</a>. There are two ways to use the OHDSI tools for patient-level prediction. The first approach is to use the atlas interface to design a study and then atlas creates an R package that goes end to end from data extraction to model develoment and evaluation. This requires only basic R knowledge. The second approach is to manually write R code using our PatientLevelPrediction R library. This requires intermediate R knowledge at a minimum, but enables greater flexibility in the prediction analysis study design. In sections - we provide a complete walk-through demonstrating how to correctly specify a patientl-level prediction problem, how to use Atlas and/or R to develop the prediction model and how to evaluate the model.</p>

</div>
<div id="progress" class="section level2">
<h2><span class="header-section-number">14.2</span> Current Progress in Patient-Level Prediction</h2>
<p>Clinical decision making is a complicated task in which the clinician has to infer a diagnosis or treatment pathway based on the available medical history of the patient and the current clinical guidelines. Clinical prediction models have been developed to support this decision making process and are used in clinical practice in a wide spectrum of specialties. These models predict a diagnostic or prognostic outcome based on a combination of patient characteristics, e.g. demographic information, disease history, treatment history. The number of publications describing clinical prediction models has increased strongly over the last 10 years. An example is the Garvan model that predicts the 5-years and 10-years fractures risk in any elderly man or woman based on age, fracture history, fall history, bone mass density or weight <span class="citation">(Nguyen et al. <a href="#ref-nguyen2008" role="doc-biblioref">2008</a>)</span>. Many prediction models have been developed in patient subgroups at higher risk that need more intensive monitoring, e.g. the prediction of 30-day mortality after an acute myocardial described by <span class="citation">Lee et al. (<a href="#ref-lee1995" role="doc-biblioref">1995</a>)</span>. Also, many models have been developed for asymptomatic subjects in the population, e.g. the famous Framingham risk functions for cardiovascular disease <span class="citation">(Wilson et al. <a href="#ref-wilson1998" role="doc-biblioref">1998</a>)</span>, or the models for breast cancer screening <span class="citation">(Engel and Fischer <a href="#ref-engel2015" role="doc-biblioref">2015</a>)</span>.</p>
<p>Surprisingly, most currently used models are estimated using small datasets and contain a limited set of patient characteristics. For example, in a review of 102 prognostic models in traumatic brain injury showed that three quarters of the models were based on samples with less than 500 patients <span class="citation">(Perel et al. <a href="#ref-perel2006" role="doc-biblioref">2006</a>)</span>. This low sample size, and thus low statistical power, forces the data analyst to make stronger modelling assumptions. The selection of the often limited set of patient characteristics is strongly guided by the expert knowledge at hand. This contrasts sharply with the reality of modern medicine wherein patients generate a rich digital trail, which is well beyond the power of any medical practitioner to fully assimilate. Presently, health care is generating huge amount of patient-specific information contained in the Electronic Health Record (EHR). This includes structured data in the form of diagnose, medication, laboratory test results, and unstructured data contained in clinical narratives. Currently, it is unknown how much predictive accuracy can be gained by leveraging the large amount of data originating from the complete EHR of a patient.</p>
<p>Massive-scale, patient-specific predictive modeling has become reality due the OHDSI initiative in which the common data model (CDM) allows for uniform and transparent analysis at an unprecedented scale. These large standardized populations contain rich data to build highly predictive large-scale models and also provide immediate opportunity to serve large communities of patients who are in most need of improved quality of care. Such models can inform truly personalized medical care leading hopefully to sharply improved patient outcomes. Furthermore, these models could assist in the design and analysis of randomized controlled trials (RCT) by enabling a better patient stratification or can be utilized to adjust for confounding variables in observational research. More accurate prediction models contribute to targeting of treatment and to increasing cost-effectiveness of medical care.</p>
<p>Advances in machine learning for large dataset analysis have led to increased interest in applying patient-level prediction on this type of data. However, many published efforts in patient-level-prediction do not follow the model development guidelines, fail to perform extensive external validation, or provide insufficient model details that limits the ability of independent researchers to reproduce the models and perform external validation. This makes it hard to fairly evaluate the predictive performance of the models and reduces the likelihood of the model being used appropriately in clinical practice. To improve standards, several papers have been written detailing guidelines for best practices in developing and reporting prediction models.</p>
<p>The Transparent Reporting of a multivariable prediction model for Individual Prognosis Or Diagnosis (TRIPOD) statement<a href="references.html#fn14" class="footnote-ref" id="fnref14"><sup>14</sup></a> provides clear recommendations for reporting prediction model development and validation and addresses some of the concerns related to transparency. However, data structure heterogeneity and inconsistent terminologies still make collaboration and model sharing difficult as different researchers are often required to write new code to extract the data from their databases and may define variables differently.</p>
<p>In our paper <span class="citation">(Reps et al. <a href="#ref-reps2018" role="doc-biblioref">2018</a>)</span>, we propose a standardised framework for patient-level prediction that utilizes the OMOP Common Data Model (CDM) and standardized vocabularies, and describe the open-source software that we developed implementing the framework’s pipeline. The framework is the first to support existing best practice guidelines and will enable open dissemination of models that can be extensively validated across the network of OHDSI collaborators.</p>
<p>Figure <a href="PatientLevelPrediction.html#fig:figure1">14.1</a>, illustrates the prediction problem we address. Among a population at risk, we aim to predict which patients at a defined moment in time (t = 0) will experience some outcome during a time-at-risk. Prediction is done using only information about the patients in an observation window prior to that moment in time.</p>
<div class="figure"><span id="fig:figure1"></span>
<img src="images/PatientLevelPrediction/Figure1.png" alt="The prediction problem." width="100%" />
<p class="caption">
Figure 14.1: The prediction problem.
</p>
</div>
<p>As shown in Table <a href="PatientLevelPrediction.html#tab:plpDesign">14.1</a>, to define a prediction problem we have to define t=0 by a target Cohort (T), the outcome we like to predict by an outcome cohort (O), and the time-at-risk (TAR). We define the standard prediction question as:</p>

<div class="rmdimportant">
Amongst [add Target cohort definition], who will go on to have [add outcome definition] within [add time at risk period]
</div>

<p>Furthermore, we have to make design choices for the model we like to develop, and determine the observational datasets to perform internal and external validation.</p>
<table>
<caption><span id="tab:plpDesign">Table 14.1: </span> Main design choices in a prediction design.</caption>
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Choice</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Target cohort</td>
<td align="left">A cohort for whom we wish to predict</td>
</tr>
<tr class="even">
<td align="left">Outcome cohort</td>
<td align="left">A cohort representing the outcome we wish to predict</td>
</tr>
<tr class="odd">
<td align="left">Time-at-risk</td>
<td align="left">For what time relative to t=0 do we want to make the prediction?</td>
</tr>
<tr class="even">
<td align="left">Model</td>
<td align="left">What algorithms using which parameters do we want use, and what predictor variables do we want to include?</td>
</tr>
</tbody>
</table>
<p>This conceptual framework works for all type of prediction problems, see [introduction link]</p>
</div>
<div id="extracted" class="section level2">
<h2><span class="header-section-number">14.3</span> Creating Labelled Data</h2>
<p>The observational datasets we use in OHDSI consist of timestamped records of patient medical interactions. These are represented by tables containing anonymised patient details such as gender and year of birth in addition to tables containing date stamped medical records.</p>
<div class="figure"><span id="fig:figuretheory1"></span>
<img src="images/PatientLevelPrediction/theory/patienttimeline.png" alt="Observational data." width="100%" />
<p class="caption">
Figure 14.2: Observational data.
</p>
</div>
<p>Applying supervised learning techniques for prediction requires having covariate and label pairs for a sufficient number of patients. The covariates (also referred to as features or independant variables) describe a patient. Example covariates could be: the patient’s gender, age and health state based on the presence or absense of medical conditions. Many of these covariates are time dependant, for example age changes over time, as do some medical conditions. The labels correspond to whether a patient has a outcome of interest during some time interval. The label is also time dependant.</p>
<p>To convert the observational data into labelled data consisting of covariate and label pairs for a set of patients, we need to specify a point in time for each patient that will be used as a pivot. Covariates can be constructed at that pivot point in time (using all records up to that point), and we can can determine whether a patient has the outcome of interest during some time interval relative to the pivot point in time (the time at risk).</p>
<div class="figure"><span id="fig:figuretheory2"></span>
<img src="images/PatientLevelPrediction/theory/dataplot1.png" alt="Create laelled data from observational data." width="100%" />
<p class="caption">
Figure 14.3: Create laelled data from observational data.
</p>
</div>
<p>This will then provide us with labelled data. The definition of the target cohort population is what we use to define this pivot point in time. For example, if the target cohort was new users of drug A, then the pivot point in time is the date a patient first had drug A recorded in the database. Alternatively, if the target cohort was diagnoses of cardiovascular disease, then the pivot point in time is the date a patient first has a record indicating cardiovascular disease is present. Our prediction specification directly links to how the labelled data are constructed.</p>
<div class="figure"><span id="fig:figuretheory3"></span>
<img src="images/PatientLevelPrediction/theory/dataplot2.png" alt="Create laelled data from observational data." width="100%" />
<p class="caption">
Figure 14.4: Create laelled data from observational data.
</p>
</div>
</div>
<div id="supervised" class="section level2">
<h2><span class="header-section-number">14.4</span> Supervised learning</h2>
<p>The idea of supervised learning is to be able to generalise what is observed in the labelled data so that when a new patient’s covariates are known but their label is unknown, we can predict their label.</p>
<p>If we consider the situation where we have two covariates, then we can represent each patient as a plot in two dimensional space. The shape/color of a data points corresponds to the patient’s label. The idea of supervised learning is to generalise the what we see and fill in where there are no current data points. A supervised learning model will try to partition the space via a decision boundary, as seen in Figure  that aims to minimise the cases where the data point labels do not match the models prediction. Different supervised learning techniques lead to different decision boundaries and there are often hyper-parameters that can impact the complexity of the decision boundary.</p>
<div class="figure"><span id="fig:figuretheory4"></span>
<img src="images/PatientLevelPrediction/theory/learning.png" alt="Decision boundary." width="100%" />
<p class="caption">
Figure 14.5: Decision boundary.
</p>
</div>
<p>In Figure Figure  you can see three different decision boundaries. The boundaries are used to infer the class of any new data point. In figure Figure  the decision boundaries are used to shade the 2 dimentional space into red regions and green regions. If a new data point falls into the green shaded area then the model will predict ‘no outcome’, otherwise it will predict ‘has outcome’.</p>
<p>Ideally a decision boundary should partition the two classes with no error. However, generlizability is an issue, as complex models can ‘overfit’ where they can correctly partition each data points in the labelled data by using very complex boundaries:</p>
<div class="figure"><span id="fig:figuretheory5"></span>
<img src="images/PatientLevelPrediction/theory/noise.png" alt="Overfitting issues." width="100%" />
<p class="caption">
Figure 14.6: Overfitting issues.
</p>
</div>
<p>The issue here is that these boundaries may be fit too closely to the labelled data used to learn them and may not work for new data. For example, noise causing incorrectly positioned data points can cause issues. This is shown in Figure Figure  where the decision boundary goes around a data point that was incorrectly positioned due to noise and this impacts predictions near this region.</p>
<p>Therefore, you want a model that appears to partition the labelled data well but is also as simple as possible. Techniques such as regularization aim to maximise model performance on the labelled data while minimising complexity. Complexity can also be controlled by picking classifier hyper-parameters such that a simpler decision boundary is used.</p>
<p>Another way to think about supervised learning is finding a function that maps from a patient’s covariates to their label. [add function]. Each supervised learning model has a different way to learn the mapping function and the no free lunch theorem states that no one algorithm is always going to outperform the others. The performance of each type of supervised learning algorithm depends on how the labelled data points are distributed in space. Therefore we recommend trying multiple supervised learning techniques when developing patient-level prediction models.</p>
<div id="regularized-logistic-regression" class="section level3">
<h3><span class="header-section-number">14.4.1</span> Regularized Logistic Regression</h3>
<p>Lasso logistic regression belongs to the family of generalized linear models, where a linear combination of the variables is learned and finally a logistic function maps the linear combination to a value between 0 and 1. The lasso regularization adds a cost based on model complexity to the objective function when training the model. This cost is the sum of the absolute values of the linear combination of the coefficients. The model automatically performs feature selection by minimizing this cost. We use the <a href="https://ohdsi.github.io/Cyclops/">Cyclops</a> (Cyclic coordinate descent for logistic, Poisson and survival analysis) package to perform large-scale regularized logistic regression. <strong>Hyper-parameters</strong>: var (starting variance), seed.</p>
</div>
<div id="gradient-boosting-machines" class="section level3">
<h3><span class="header-section-number">14.4.2</span> Gradient boosting machines</h3>
<p>Gradient boosting machines is a boosting ensemble technique and in our framework it combines multiple decision trees. Boosting works by iteratively adding decision trees but adds more weight to the data-points that are misclassified by prior decision trees in the cost function when training the next tree. We use Extreme Gradient Boosting, which is an efficient implementation of the gradient boosting framework implemented in the xgboost R package available from CRAN. <strong>Hyper-parameters</strong>: ntree (number of trees), max depth (max levels in tree), min rows (minimum data points in in node), learning rate, seed | mtry (number of features in each tree),ntree (number of trees), maxDepth (max levels in tree), minRows (minimum data points in in node),balance (balance class labels), seed.</p>
</div>
<div id="random-forest" class="section level3">
<h3><span class="header-section-number">14.4.3</span> Random forest</h3>
<p>Random forest is a bagging ensemble technique that combines multiple decision trees. The idea behind bagging is to reduce the likelihood of overfitting, by using weak classifiers, but combining multiple diverse weak classifiers into a strong classifier. Random forest accomplishes this by training multiple decision trees but only using a subset of the variables in each tree and the subset of variables differ between trees. Our packages uses the sklearn learn implementation of Random Forest in python. <strong>Hyper-parameters</strong>: mtry (number of features in each tree),ntree (number of trees), maxDepth (max levels in tree), minRows (minimum data points in in node),balance (balance class labels), seed.</p>
</div>
<div id="k-nearest-neighbors" class="section level3">
<h3><span class="header-section-number">14.4.4</span> K-nearest neighbors</h3>
<p>K-nearest neighbors (KNN) is an algorithm that uses some metric to find the K closest labelled data-points, given the specified metric, to a new unlabelled data-point. The prediction of the new data-points is then the most prevalent class of the K-nearest labelled data-points. There is a sharing limitation of KNN, as the model requires labelled data to perform the prediction on new data, and it is often not possible to share this data across data sites. We included the <a href="https://github.com/OHDSI/BigKnn">BigKnn</a> package developed in OHDSI which is a large scale k-nearest neighbor classifier. <strong>Hyper-parameters</strong>: k (number of neighbours), weighted (weight by inverse frequency).</p>
</div>
<div id="naive-bayes" class="section level3">
<h3><span class="header-section-number">14.4.5</span> Naive Bayes</h3>
<p>The Naive Bayes algorithm applies the Bayes theorem with the naive assumption of conditional independence between every pair of features given the value of the class variable. Based on the likelihood the data belongs to a class and the prior distribution of the class, a posterior distribution is obtained. <strong>Hyper-parameters</strong>: none.</p>
</div>
<div id="adaboost" class="section level3">
<h3><span class="header-section-number">14.4.6</span> AdaBoost</h3>
<p>AdaBoost is a boosting ensemble technique. Boosting works by iteratively adding classifiers but adds more weight to the data-points that are misclassified by prior classifiers in the cost function when training the next classifier. We use the sklearn AdaboostClassifier implementation in Python. <strong>Hyper-parameters</strong>: nEstimators (the maximum number of estimators at which boosting is terminated), learningRate (learning rate shrinks the contribution of each classifier by learning_rate. There is a trade-off between learningRate and nEstimators).</p>
</div>
<div id="decision-tree" class="section level3">
<h3><span class="header-section-number">14.4.7</span> Decision Tree</h3>
<p>A decision tree is a classifier that partitions the variable space using individual tests selected using a greedy approach. It aims to find partitions that have the highest information gain to separate the classes. The decision tree can easily overfit by enabling a large number of partitions (tree depth) and often needs some regularization (e.g., pruning or specifying hyper-parameters that limit the complexity of the model). We use the sklearn DecisionTreeClassifier implementation in Python. <strong>Hyper-parameters</strong>: maxDepth (the maximum depth of the tree), minSamplesSplit,minSamplesLeaf, minImpuritySplit (threshold for early stopping in tree growth. A node will split if its impurity is above the threshold, otherwise it is a leaf.), seed,classWeight (“Balance”" or “None”).</p>
</div>
<div id="multilayer-perception" class="section level3">
<h3><span class="header-section-number">14.4.8</span> Multilayer Perception</h3>
<p>Neural networks containing multiple layers that weight their inputs using a non-linear function. The first layer is the input layer, the last layer is the output layer the between are the hidden layers. Neural networks are generally trained using feed forward back-propagation. This is when you go through the network with a data-point and calculate the error between the true label and predicted label, then go backwards through the network and update the linear function weights based on the error. <strong>Hyper-parameters</strong>: size (the number of hidden nodes), alpha (the l2 regularisation), seed.</p>
</div>
<div id="deep-learning" class="section level3">
<h3><span class="header-section-number">14.4.9</span> Deep Learning</h3>
<p>Deep learning such as deep nets, convolutional neural networks or recurrent neural networks are similar to a neural network but have multiple hidden layers that aim to learn latent representations useful for prediction. In a seperate vignette in the <a href="https://ohdsi.github.io/PatientLevelPrediction/">PatientLevelPrediction</a> package we describe these models and hyper-parameters in more detail.</p>
</div>
</div>
<div id="evalaution" class="section level2">
<h2><span class="header-section-number">14.5</span> Evaluating Patient-Level Prediction Models</h2>
<div id="evaluation-types" class="section level3">
<h3><span class="header-section-number">14.5.1</span> Evaluation Types</h3>
<p>There are various ways to evaluate a prediction model: internal validation, external valdiation, temporal validation and spatial validation.</p>
<p>Internal validation is when a prediction model is evaluated using the same dataset used to develop the model. There are three ways to perform internal validation: using a holdout set, using cross validation and using bootstrapping. In the patient-level prediction framework we use a holdout set for internal validation.</p>
<p>A holdout set approach simply splits the labelled data into two independent sets, a train set and a test set (the hold out set). The train set is used to learn the model and the test set is used to evaluate it.</p>
<p>Cross validation is useful when the data are limited. A user needs to specify the number of folds, such as 10, then the data are split into that number of independent sets. For each data split, a model is trained on all other data splits and then applied to the split to obtain the predicted risks for each patient in the split. The model performance can then be estimated using the predicted risk obtained when the patients were held out from model training. A form of cross validation is leave one out validation, where for each patient, the model is trained using all other data except that patient’s data and then applied to the patient to obtain their predicted risk. This is repeated for each patient to obtain risks for all the patients which can be used to evaluate the model. In the patient-level prediction framework we use cross validation to pick the optimal hyper-parameters on the train set.</p>
<p>Bootstrapping is useful when calculating confidence intervals. In bootstrapping multiple sample sets are drawn with replacement from the whole labelled dataset to generate hold out sets, the unsampled patient data are used to develop the models and then evaluated on the sample sets. This gives a range for each metric. We currently do not use bootstrapping in the patient-level prediction framework.</p>
<div class="figure"><span id="fig:figuretheoryval"></span>
<img src="images/PatientLevelPrediction/theory/validationTypes.png" alt="Types of internal valdiation." width="100%" />
<p class="caption">
Figure 14.7: Types of internal valdiation.
</p>
</div>
<p>External validation is when a model trained on one dataset is validated on a new dataset or set of patients. This is important as it helps model developers understand which types of patients the model will transport to.</p>
<div class="figure"><span id="fig:figuretheoryextval"></span>
<img src="images/PatientLevelPrediction/theory/externalValidation.png" alt="Visulisation of external validation." width="100%" />
<p class="caption">
Figure 14.8: Visulisation of external validation.
</p>
</div>
<p>Temporal validation is a type of validation where a model is validated on data that were collected after the data used to develop the model. This can help identify situations where they may be temporal shifts in the data that impact the transportability of the model across time. Another type of validation, spatial validation, is location based where a model is developed on patients for some locations (perhaps certain hospitals or doctor surgeries) and validated on patients at a different location.</p>
</div>
<div id="performance" class="section level3">
<h3><span class="header-section-number">14.5.2</span> Performance Metrics</h3>
<p>** Threhold measures **
A prediction model assigned a value between 0 and 1 for each patient corresponding to the risk of the patient having the outcome during the time at risk. A value of 0 means 0% risk, a value of 0.5 means 50% risk and a value of 1 means 100% risk. Common metrics such as accuracy, sensitivity, specificity, positivity predictive value can be calculated by first specifying a threshold that is used to class patients as having the outcome or not having the outcome during the time at risk. For example, given Table <a href="#tab:tabletheorytab"><strong>??</strong></a>, if we set the threshold as 0.5, the patients 1,3,7 and 10 have a predicted risk greater than or equal to the threshold of 0.5 so they would be predicted to have the outcome. All other patients had a predicted risk less than 0.5, so would be predicted to not have the outcome.</p>
<table>
<colgroup>
<col width="29%" />
<col width="29%" />
<col width="13%" />
<col width="13%" />
<col width="13%" />
</colgroup>
<thead>
<tr class="header">
<th>Patient ID</th>
<th align="center">Predicted risk</th>
<th align="right">Predicted class at 0.5 theshold</th>
<th align="right">Has outcome during TAR</th>
<th align="right">Type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td align="center">0.8</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">TP</td>
</tr>
<tr class="even">
<td>2</td>
<td align="center">0.1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">TN</td>
</tr>
<tr class="odd">
<td>3</td>
<td align="center">0.7</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">FP</td>
</tr>
<tr class="even">
<td>4</td>
<td align="center">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">TN</td>
</tr>
<tr class="odd">
<td>5</td>
<td align="center">0.05</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">TN</td>
</tr>
<tr class="even">
<td>6</td>
<td align="center">0.1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">TN</td>
</tr>
<tr class="odd">
<td>7</td>
<td align="center">0.9</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">TP</td>
</tr>
<tr class="even">
<td>8</td>
<td align="center">0.2</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">FN</td>
</tr>
<tr class="odd">
<td>9</td>
<td align="center">0.3</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">TN</td>
</tr>
<tr class="even">
<td>10</td>
<td align="center">0.5</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">FP</td>
</tr>
</tbody>
</table>
<p>If a patient is predicted to have the outcome and has the outcome during TAR then this is called as a true positive (TP). If a patient is predicted to have the outcome but does not have the outcome during TAR then this I called a false positive (FP). If a patient is predicted to not have the outcome and does not have the outcome during TAR then this is called a true negative (TN). Finally, if a patient is predicted to not have the outcome but does have the outcome during TAR then this is called a false negative (FN).</p>
<p>The following threshold based metrics are:</p>
<ul>
<li>accuracy: (TP+TN)/(TP+TN+FP+FN)</li>
<li>sensitivity: TP/(TP+FN)</li>
<li>specificity: TN/(TN+FP)</li>
<li>positive predictive value: TP/(TP+FP)</li>
</ul>
<p>Note that these values can either decrease or increase if the threshold is lowered. Lowering the threshold of a classifier may increase the denominator, by increasing the number of results returned. If the threshold was previously set too high, the new results may all be true positives, which will increase positive predictive value. If the previous threshold was about right or too low, further lowering the threshold will introduce false positives, decreasing positive predictive value. For sensitivity the denominator does not depend on the classifier threshold (TP+FN is a constant). This means that lowering the classifier threshold may increase sensitivity, by increasing the number of true positive results. It is also possible that lowering the threshold may leave sensitivty unchanged, while the positive predictive value fluctuates.</p>
<p>Figure <a href="PatientLevelPrediction.html#fig:plpPrecisionRecall">14.9</a> shows the tradeoff between positive predictive value (precision) and sensitivity (recall).</p>
<div class="figure" style="text-align: center"><span id="fig:plpPrecisionRecall"></span>
<img src="images/PatientLevelPrediction/precisionRecall.png" alt="Positive predictive value-sensitivy aka Precision-recall plot." width="80%" />
<p class="caption">
Figure 14.9: Positive predictive value-sensitivy aka Precision-recall plot.
</p>
</div>
<p>** Overal Performance **
There are two main criteria used to assess the overal performance of a prediction model; discrimination and calibration.</p>
<p>** Discrimiantion **</p>
<p>Discrimination is the ability to assign a higher risk to patients who will experience the outcome during the time at risk. The Receiver Operating Characteristics (ROC) is determined by plotting 1 – specificity on the x-axis and sensitivity on the y-axis at all possible thresholds, see Figure <a href="PatientLevelPrediction.html#fig:figuretheoryroc">14.10</a>. The dashed diagonal line in Figure <a href="PatientLevelPrediction.html#fig:figuretheoryroc">14.10</a> is the performance of a model that randomly assigns predictions. The area under the receiver operating characteristic curve (AUROC) gives an overall measure of discrimination where a value of 0.5 corresponds to randomly assigning the risk and a value of 1 means perfect discrimination. In reality, most prediction models obtain AUCs between 0.6-0.8. The AUROC is invariant to class imbalance, unlike accuracy, but for rare outcomes even a model with a high AUROC may not be practical. When the outcome is rare another measure known as the area under the precision recall curve (AUPRC) is recommended. A model may obtain a high AUC when the outcome is rare but have a very low positive predictive value. This would mean may false positives. Depending on the severity of the outcome and cost (health risk and/or monetary) of some intervention, a low false positive rate may result in a non-practical model. The AUPRC is the area under the line generated by plotting the sensitivity on the x-axis (also known as the recall) and the positive predictive value (also known as the precision) on the y-axis.</p>
<div class="figure"><span id="fig:figuretheoryroc"></span>
<img src="images/PatientLevelPrediction/theory/discrimination.png" alt="Example discrimination plots generated by the patient-level prediction framework." width="100%" />
<p class="caption">
Figure 14.10: Example discrimination plots generated by the patient-level prediction framework.
</p>
</div>
<p>The AUROC provides a way to determine how different the predicted risk distributions are between the patients who experience the outcome during the time at risk and those who do not. If the AUROC is high, then the distributions will be mostly disjointed, whereas when there is a lot of overlap, the AUROC will be closer to 0.5, see Figure <a href="PatientLevelPrediction.html#fig:figuretheoryroctheory">14.11</a>.</p>
<div class="figure"><span id="fig:figuretheoryroctheory"></span>
<img src="images/PatientLevelPrediction/theory/roctheory.png" alt="How the ROC plots are linked to discrimination." width="100%" />
<p class="caption">
Figure 14.11: How the ROC plots are linked to discrimination.
</p>
</div>
<p><em>Preference distribution</em></p>
<p>The preference distribution plot (Figure <a href="PatientLevelPrediction.html#fig:plpPreference">14.12</a>) shows the preference score distributions for people in the test set with the outcome (red) without the outcome (blue).</p>
<div class="figure" style="text-align: center"><span id="fig:plpPreference"></span>
<img src="images/PatientLevelPrediction/preferencePDF.png" alt="Preference distribution plot." width="90%" />
<p class="caption">
Figure 14.12: Preference distribution plot.
</p>
</div>
<p><em>Predicted probability distribution</em></p>
<p>The prediction distribution box plot shows the predicted risks of the people in the test set with the outcome (blue) and without the outcome (red).</p>
<p>The box plots in Figure <a href="PatientLevelPrediction.html#fig:plpPredProb">14.13</a> show that the predicted probability of the outcome is indeed higher for those with the outcome but there is also overlap between the two distribution which lead to an imperfect discrimination.</p>
<div class="figure" style="text-align: center"><span id="fig:plpPredProb"></span>
<img src="images/PatientLevelPrediction/predictionDistribution.png" alt="Predicted probability distribution." width="90%" />
<p class="caption">
Figure 14.13: Predicted probability distribution.
</p>
</div>
<p>** Calibration **</p>
<p>Calibration is the ability of the model to assign a correct risk. For example, if the model assigned one hundred patients a risk of 10% then ten of the patients should experience the outcome during the time at risk. If the model assigned 100 patients a risk of 80% then eighty of the patients should experience the outcome during the time at risk. The calibration is generally calculated by partitioning the patients into deciles based on the predicted risk and in each group calculating the mean predicted risk and the fraction of the patients who experienced the outcome during the time at risk. We then plot these ten points (predicted risk on the y-axis and observed risk on the x-axis) and see whether they fall on the x = y line, indicating the model is well calibrated. We also fit a linear model using the points to calculate the intercept (which should be close to 0) and the gradient (which should be close to 1). If the gradient is greater than 1 then the model is assigning a higher risk than the true risk and if the gradient is less than 1 the model is assigning a lower risk than the true risk.</p>
<p>AN example calibration plot generated by the Patient-level prediction package is shown in Figure <a href="PatientLevelPrediction.html#fig:figuretheorycal">14.14</a>. The diagonal dashed line thus indicates a perfectly calibrated model. The ten (or fewer) dots represent the mean predicted values for each quantile plotted against the observed fraction of people in that quantile who had the outcome (observed fraction). The straight black line is the linear regression using these 10 plotted quantile mean predicted vs observed fraction points. The straight vertical lines represented the 95% lower and upper confidence intervals of the slope of the fitted line.</p>
<div class="figure"><span id="fig:figuretheorycal"></span>
<img src="images/PatientLevelPrediction/theory/calibration.png" alt="Example calibration plots generated by the patient-level prediction framework." width="100%" />
<p class="caption">
Figure 14.14: Example calibration plots generated by the patient-level prediction framework.
</p>
</div>
<p><em>Smooth Calibration</em></p>
<p>Similar to the traditional calibration shown above the Smooth Calibration plot shows the relationship between predicted and observed risk. the major difference is that the smooth fit allows for a more fine grained examination of this. Whereas the traditional plot will be heavily influenced by the areas with the highest density of data the smooth plot will provide the same information for this region as well as a more accurate interpretation of areas with lower density. the plot also contains information on the distribution of the outcomes relative to predicted risk.</p>
<p>Figure <a href="PatientLevelPrediction.html#fig:plpSmoothCal">14.15</a> shows an example that better demonstrates the impact of using a smooth calibration plot. The default line fit would not highlight the miss-calibration at the lower predicted probability levels that well.</p>
<div class="figure" style="text-align: center"><span id="fig:plpSmoothCal"></span>
<img src="images/PatientLevelPrediction/smoothCalibration.jpeg" alt="Smooth calibration plot." width="100%" />
<p class="caption">
Figure 14.15: Smooth calibration plot.
</p>
</div>
<p><em>Demographic summary</em>
It can also be useful to determine how well calibrated a model is for different demographics (age and gender groups). This can be calculated by partitioning the patients into groups of similar age and gender and comparing the mean predicted risk within the group with the observed fraction of the patients who experience the outcome during the time at risk. This can identify demographic groups where the model does not perform well when applied. Figure <a href="PatientLevelPrediction.html#fig:plpDemoSummary">14.16</a> shows for females and males the expected and observed risk in different age groups together with a confidence area. This example shows that the model is well calibrated across gender and age groups.</p>
<div class="figure" style="text-align: center"><span id="fig:plpDemoSummary"></span>
<img src="images/PatientLevelPrediction/demographicSummary.png" alt="Precision-recall plot." width="100%" />
<p class="caption">
Figure 14.16: Precision-recall plot.
</p>
</div>
</div>
<div id="inspecting-the-model" class="section level3">
<h3><span class="header-section-number">14.5.3</span> Inspecting the model</h3>
<p><em>Test-Train similarity</em></p>
<p>The test-train similarity is assessed by plotting the mean covariate values in the train set against those in the test set for people with and without the outcome. This can be a useful way to see how similar the test and train sets are.</p>
<p>The results in Figure <a href="PatientLevelPrediction.html#fig:plpTestTrain">14.17</a> show that the mean values of the covariates in both the test and train sets are comparable as the points are on the diagonal. If some of the points were off the diagonal then this would tell us the test and train datasets differed.</p>
<div class="figure" style="text-align: center"><span id="fig:plpTestTrain"></span>
<img src="images/PatientLevelPrediction/generalizability.png" alt="Predicted probability distribution." width="100%" />
<p class="caption">
Figure 14.17: Predicted probability distribution.
</p>
</div>
<p><em>Variable scatter plot</em></p>
<p>The variable scatter plot shows the mean covariate value for the people with the outcome against the mean covariate value for the people without the outcome. The color of the dots corresponds to the inclusion (green) or exclusion in the model (blue), respectively. Figure <a href="PatientLevelPrediction.html#fig:plpVarScatter">14.18</a> shows that the mean of most of the covariates is higher for subjects with the outcome compared to those without. This would indicate that the patients with the outcome are generally sicker.</p>
<div class="figure" style="text-align: center"><span id="fig:plpVarScatter"></span>
<img src="images/PatientLevelPrediction/variableScatterplot.png" alt="Predicted probability distribution." width="100%" />
<p class="caption">
Figure 14.18: Predicted probability distribution.
</p>
</div>

</div>
</div>
<div id="specfifying-a-patient-level-prediction-study" class="section level2">
<h2><span class="header-section-number">14.6</span> Specfifying a Patient-level Prediction Study</h2>
<p>In this section we will demonstrate how to define a prediction problem using an example for hypertension.</p>
<p>The first step is to clearly define the prediction problem. Interestingly, in many published papers the prediction problem is poorly defined, e.g. it is unclear how the index date (start of the target Cohort) is defined. A poorly defined prediction problem does not allow for external validation by others let alone implementation in clinical practice. In the PLP framework we have enforced that we have to define the prediction problem we like to address, in which population we will build the model, which model we will build and how we will evaluate its performance. In this section we will guide you through this process and we will use a “Treatment safety” prediction type as an example.</p>
<div id="problem-definition-2" class="section level3">
<h3><span class="header-section-number">14.6.1</span> Problem definition</h3>
<p>Angioedema is a well known side-effect of ACE inhibitors, and the incidence of angioedema reported in the labeling for ACE inhibitors is in the range of 0.1% to 0.7% <span class="citation">(Byrd, Adam, and Brown <a href="#ref-byrd_2006" role="doc-biblioref">2006</a>)</span>. Monitoring patients for this adverse effect is important, because although angioedema is rare, it may be life-threatening, leading to respiratory arrest and death <span class="citation">(Norman et al. <a href="#ref-norman_2013" role="doc-biblioref">2013</a>)</span>. Further, if angioedema is not initially recognized, it may lead to extensive and expensive workups before it is identified as a cause <span class="citation">(Norman et al. <a href="#ref-norman_2013" role="doc-biblioref">2013</a>; Thompson and Frable <a href="#ref-thompson_1993" role="doc-biblioref">1993</a>)</span>. Other than the higher risk among African-American patients, there are no known predisposing factors for the development of ACE inhibitor related angioedema <span class="citation">(Byrd, Adam, and Brown <a href="#ref-byrd_2006" role="doc-biblioref">2006</a>)</span>. Most reactions occur within the first week or month of initial therapy and often within hours of the initial dose <span class="citation">(Cicardi et al. <a href="#ref-circardi_2004" role="doc-biblioref">2004</a>)</span>. However, some cases may occur years after therapy has begun <span class="citation">(O’Mara and O’Mara <a href="#ref-mara_1996" role="doc-biblioref">1996</a>)</span>.No diagnostic test is available that specifically identifies those at risk. If we could identify those at risk, doctors could act, for example by discontinuing the ACE inhibitorin favor of another hypertension drug.</p>
<p>We will apply the PLP framework to observational healthcare data to address the following patient-level prediction question:</p>
<blockquote>
<p>Amongst patients who have just started on an ACE inhibitor for the first time, who will experience angioedema in the following year?</p>
</blockquote>
</div>
<div id="study-population-definition" class="section level3">
<h3><span class="header-section-number">14.6.2</span> Study population definition</h3>
<p>The final study population in which we will develop our model is often a subset of the target population, because we will e.g. apply criteria that are dependent on T and O or we want to do sensitivity analyses with subpopulations of T. For this we have to answer the following questions:</p>
<ul>
<li><p><em>What is the minimum amount of observation time we require before the start of the target cohort?</em> This choice could depend on the available patient time in your training data, but also on the time you expect to be available in the data sources you want to apply the model on in the future. The longer the minimum observation time, the more baseline history time is available for each person to use for feature extraction, but the fewer patients will qualify for analysis. Moreover, there could be clinical reasons to choose a short or longer lookback period. For our example, we will use a prior history as lookback period (washout period).</p></li>
<li><p><em>Can patients enter the target cohort multiple times?</em> In the target cohort definition, a person may qualify for the cohort multiple times during different spans of time, for example if they had different episodes of a disease or separate periods of exposure to a medical product. The cohort definition does not necessarily apply a restriction to only let the patients enter once, but in the context of a particular patient-level prediction problem, a user may want to restrict the cohort to the first qualifying episode. In our example, a person can only enter the target cohort once since our criteria was based on first use of an ACE inhibitor.</p></li>
<li><p><em>Do we allow persons to enter the cohort if they experienced the outcome before?</em> Do we allow persons to enter the target cohort if they experienced the outcome before qualifying for the target cohort? Depending on the particular patient-level prediction problem, there may be a desire to predict incident first occurrence of an outcome, in which case patients who have previously experienced the outcome are not at-risk for having a first occurrence and therefore should be excluded from the target cohort. In other circumstances, there may be a desire to predict prevalent episodes, whereby patients with prior outcomes can be included in the analysis and the prior outcome itself can be a predictor of future outcomes. For our prediction example, we will choose not to include those with prior angioedema.</p></li>
<li><p><em>How do we define the period in which we will predict our outcome relative to the target cohort start?</em> We actually have to make two decisions to answer that question. First, does the time-at-risk window start at the date of the start of the target cohort or later? Arguments to make it start later could be that you want to avoid outcomes that were entered late in the record that actually occurred before the start of the target cohort or you want to leave a gap where interventions to prevent the outcome could theoretically be implemented. Second, you need to define the time-at-risk by setting the risk window end, as some specification of days offset relative to the target cohort start or end dates. For our problem we will predict in a time-at-risk window starting 1 day after the start of the target cohort up to 365 days later.</p></li>
<li><p><em>Do we require a minimum amount of time-at-risk?</em> We have to decide if we want to include patients that did not experience the outcome but did leave the database earlier than the end of our time-at-risk period. These patients may experience the outcome when we do not observe them. For our prediction problem we decide to answer this question with Yes, require a mimimum time-at-risk for that reason. Furthermore, we have to decide if this constraint also applies to persons who experienced the outcome or we will include all persons with the outcome irrespective of their total time at risk. For example, if the outcome is death, then persons with the outcome are likely censored before the full time-at-risk period is complete.</p></li>
</ul>
</div>
<div id="model-development-settings" class="section level3">
<h3><span class="header-section-number">14.6.3</span> Model development settings</h3>
<p>To develop the model we have to decide which algorithm(s) we like to train. We see the selection of the best algorithm for a certain prediction problem as an empirical question, i.e. you need to let the data speak for itself and try different approaches to find the best one. There is no algorithm that will work best for all problems (no free lunch). In our framework we therefore aim to implement many algorithms. Furthermore, we made the system modular so you can add your own custom algorithms. This out-of-scope for this chapter but mode details can be found in the <em>AddingCustomAlgorithms</em> vignette in the <a href="https://ohdsi.github.io/PatientLevelPrediction/">PatientLevelPrediction</a> package.</p>
<p>Our framework currently contains the following algorithms to choose from:</p>
<p>Furthermore, we have to decide on the <strong>covariates</strong> that we will use to train our model. In our example, we like to add gender, age, all conditions, drugs and drug groups, and visit counts. We also have to specify in which time windows we will look and we decide to look in year before and any time prior.</p>
</div>
<div id="model-evaluation" class="section level3">
<h3><span class="header-section-number">14.6.4</span> Model evaluation</h3>
<p>Finally, we have to define how we will train and test our model on our data, i.e. how we perform <strong>internal validation</strong>. For this we have to decide how we divide our dataset in a training and testing dataset and how we randomly assign patients to these two sets. Dependent on the size of the training set we can decide how much data we like to use for training, typically this is a 75% - 25% split. If you have very large datasets you can use more data for training. To randomly assign patients to the training and testing set, there are two commonly used approaches:</p>
<ol style="list-style-type: decimal">
<li>split by person. In this case a random seed is used to assign the patient to either sets.</li>
<li>split by time. In this case a time point is used to split the persons, e.g. 75% of the data is before and 25% is after this date. The advantage of this is that you take into consideration that the health care system has changed over time.</li>
</ol>
<p>For our prediction model we decide to start with a Regularized Logistic Regression and will use the default parameters. We will do a 75%-25% split by person.</p>
</div>
<div id="study-summary-1" class="section level3">
<h3><span class="header-section-number">14.6.5</span> Study summary</h3>
<p>We now completely defined our study as shown in Table <a href="PatientLevelPrediction.html#tab:plpSummary">14.2</a>.</p>
<table>
<caption><span id="tab:plpSummary">Table 14.2: </span> Main design choices for our study.</caption>
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Choice</th>
<th align="left">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Target cohort</td>
<td align="left">Patients who have just started on an ACE inhibitor for the first time.</td>
</tr>
<tr class="even">
<td align="left">Outcome cohort</td>
<td align="left">Angioedema.</td>
</tr>
<tr class="odd">
<td align="left">Time-at-risk</td>
<td align="left">1 day till 365 days from cohort start. We will require at least 364 days at risk.</td>
</tr>
<tr class="even">
<td align="left">Model</td>
<td align="left">Gradient Boosting Machine with hyper-parameters ntree: 5000, max depth: 4 or 7 or 10 and learning rate: 0.001 or 0.01 or 0.1 or 0.9. Covariates will include gender, age, conditions, drugs, drug groups, and visit count. Data split: 75% train - 25% test, randomly assigned by person.</td>
</tr>
</tbody>
</table>
<p>We define the target cohort as the first exposure to any ACE inhibitor. Patients are excluded if they have less than 365 days of prior observation time or have prior angioedema.</p>

</div>
</div>
<div id="implementing-the-study-in-atlas" class="section level2">
<h2><span class="header-section-number">14.7</span> Implementing the study in Atlas</h2>
<div id="introduction-1" class="section level3">
<h3><span class="header-section-number">14.7.1</span> Introduction</h3>
<p>The atlas interface to patient-level prediction enables a users to design a prediction study analysis containing multiple prediction questions and analyses settings. The atlas interface creates a prediction study R package populated with all the code ready to develop and evaluate the specified models. All a user needs to develop the models is R studio with:</p>
<ul>
<li>OHDSI’s PatientLevelPrediction R package installed</li>
<li>devtools R package installed</li>
<li>connection details for the OMOP CDM databases</li>
</ul>
<p>The atlas created prediction study R package has additional functionality to:</p>
<ul>
<li>Create a study protocol template</li>
<li>Create a shiny app for interactively exploring the results</li>
<li>Create a validation study R package that can be shared to externally validate the developed models</li>
</ul>
<p>In this section we will detail the design choices for the prediction problem specification, the analysis settings and the executing settings. We will then guide the user through the process of reviewing analysis, downloading and running the prediction study package and interpreting the results via the shiny app.</p>
</div>
<div id="the-atlas-layout" class="section level3">
<h3><span class="header-section-number">14.7.2</span> The Atlas layout</h3>
<p>The interface for designing a prediction study can be opened by clicking on the ‘Prediction’ button in the left hand side atlas menu.</p>
<p>Once in the ‘Prediction’ view you should see Figure <a href="PatientLevelPrediction.html#fig:figure2b">14.19</a></p>
<div class="figure"><span id="fig:figure2b"></span>
<img src="images/PatientLevelPrediction/atlasImplementation/prediction_page.png" alt="The Atlas prediction page." width="100%" />
<p class="caption">
Figure 14.19: The Atlas prediction page.
</p>
</div>
<p>You can create a new study by clicking on the blue ‘New Patient Level Prediction’’ button or by clicking on a row in the table with the name of the study you want to open. Once inside the prediction study (either by clicking the blue ‘New Patient Level Prediction’’ button or an existing row in the table) you should see a specification options as shown in <a href="PatientLevelPrediction.html#fig:specification1">14.20</a>-<a href="PatientLevelPrediction.html#fig:specification2">14.21</a> with the top stating ‘Patient Level Prediction’ with a number such as ‘#46’, as highlighed by the red A. This tells us the cohort definition id is 46.</p>
<div class="figure"><span id="fig:specification1"></span>
<img src="images/PatientLevelPrediction/atlasImplementation/specification_p1.png" alt="The atlas prediction specification part 1." width="100%" />
<p class="caption">
Figure 14.20: The atlas prediction specification part 1.
</p>
</div>
<p>To the right of the ‘Patient Level Prediction #46’ there are buttons to save (green button), exit (blue button with x), copy (blue button with double paper) and delete (red button with bin) the current study highlighted by C-F respectively in Figure <a href="PatientLevelPrediction.html#fig:specification1">14.20</a>.</p>
<div class="figure"><span id="fig:specification2"></span>
<img src="images/PatientLevelPrediction/atlasImplementation/specification_p2.png" alt="The atlas prediction specification part 2" width="100%" />
<p class="caption">
Figure 14.21: The atlas prediction specification part 2
</p>
</div>
<p>Below these is a white text form where you can name the study (B in Figure <a href="PatientLevelPrediction.html#fig:specification1">14.20</a>). The ‘Specification’ tab (G in Figure <a href="PatientLevelPrediction.html#fig:specification1">14.20</a>) contains all the settings a user needs to define for the prediction study. The first part is the ‘Prediction Problem Settings’ (J in Figure <a href="PatientLevelPrediction.html#fig:specification1">14.20</a>), this is where the user defines the Target cohorts and Outcome cohorts for the prediction analyses. These cohorts need to be created in atlas using the ‘Cohort Definition’ view and can then be imported into the Prediction study. Instantiating cohorts is described in Chapter <a href="Cohorts.html#Cohorts">11</a>.</p>
<p>The next part of the ‘Specification’ is the ‘Analysis Settings’ (N in Figure <a href="PatientLevelPrediction.html#fig:specification1">14.20</a>). This is where the user specifies the models to train (classifiers or survival models), the candidate covariates (these are standard OHDSI covariates), the time-at-risk and additional inclusion criteria.</p>
<p>Then the ‘Execution Settings’ (R in Figure <a href="PatientLevelPrediction.html#fig:specification2">14.21</a>) define how many patients to extract for the model development, whether to remove rare covariates and whether to normalise the covariates.</p>
<p>Finally, the last part in the ‘Specification’ is the ‘Training Settings’ (S in Figure <a href="PatientLevelPrediction.html#fig:specification2">14.21</a>) which specifies’ how to split the labelled data into data used to develop the model (including how many folds you want to use when applying cross validation) and validate the model.</p>
<p>Each of the ‘Specification’ settings are described in more detail in the following sections. We also describe the ‘Utilities’ tab (H in Figure <a href="PatientLevelPrediction.html#fig:specification1">14.20</a>) where a user can review, import/export and download their study as an executional R library.</p>
</div>
<div id="atlas-specification-tab" class="section level3">
<h3><span class="header-section-number">14.7.3</span> Atlas Specification Tab</h3>
<p>The specification section is where a user can specify her prediction question, covariates, additional study population inclusion criteria, model type and hyper-parameters and execution settings.</p>
</div>
<div id="prediction-problem-settings" class="section level3">
<h3><span class="header-section-number">14.7.4</span> Prediction Problem Settings</h3>
<p>The prediction problem settings enables you to select the target population cohorts and outcome cohorts for the analysis. A prediction model will be developed for all combinations of the target population cohorts and the outcome cohorts.</p>
<p>For example, if you specify two target populations:</p>
<ul>
<li>‘T1: new users of ACE inhibitors’</li>
<li>‘T2: new users of ACE inhibitors with no prior anti-hypertensive’</li>
</ul>
<p>and three outcomes:</p>
<ul>
<li>‘O1: angioedema’</li>
<li>‘O2: stroke’</li>
<li>‘O3: myocardial infarction’</li>
</ul>
<p>then six prediction problems will be investigated in the study:</p>
<ul>
<li>‘In T1: new users of ACE inhibitors predict O1: angioedema during TAR’</li>
<li>‘In T1: new users of ACE inhibitors predict O1: stroke during TAR’</li>
<li>‘In T1: new users of ACE inhibitors predict O1: myocardial infarction during TAR’</li>
<li>‘In T2: new users of ACE inhibitors with no prior anti-hypertensive predict O1: angioedema during TAR’</li>
<li>‘In T2: new users of ACE inhibitors with no prior anti-hypertensive predict O1: stroke during TAR’</li>
<li>‘In T2: new users of ACE inhibitors with no prior anti-hypertensive predict O1: myocardial infarction during TAR’</li>
</ul>
<p>To select a target population cohort you need to have previously defined it atlas. Instantiating cohorts is described in Chapter <a href="Cohorts.html#Cohorts">11</a>. The Appendix provides the full definitions of the target (Appendix <a href="CohortDefinitions.html#AceInhibitors">B.1</a>) and outcome (Appendix <a href="CohortDefinitions.html#Angioedema">B.4</a>) cohorts used in this example. To add a target population to the cohort you then need to click on the blue ‘+ Add Target Cohort’ button, see K in Figure <a href="PatientLevelPrediction.html#fig:specification1">14.20</a>.</p>
<p>This will open up a table of cohorts that have been created in atlas, see Figure <a href="PatientLevelPrediction.html#fig:figure2k">14.22</a>.</p>
<div class="figure"><span id="fig:figure2k"></span>
<img src="images/PatientLevelPrediction/atlasImplementation/target_pop_cohort_table.png" alt="The Training Settings area" width="100%" />
<p class="caption">
Figure 14.22: The Training Settings area
</p>
</div>
<p>You can simple click on any row in the table to add that cohort. If you have many cohorts, using the filter option on the top right may help (just make sure to remember the cohort name). We filtered the book of ohdsi cohorts by adding ‘book’ to the filter as the cohort names all included the work ‘book’, see Figure <a href="PatientLevelPrediction.html#fig:figure2l">14.23</a>.</p>
<div class="figure"><span id="fig:figure2l"></span>
<img src="images/PatientLevelPrediction/atlasImplementation/target_pop_cohort_filter.png" alt="The Training Settings area" width="100%" />
<p class="caption">
Figure 14.23: The Training Settings area
</p>
</div>
<p>By clicking on the row ‘[BookOfOHDSI] New users of ACE inhibitors as first-line monotherapy for hypertension’ this is now added as a target population cohort in the study. This process can be repeated to add more target population cohorts. Adding outcome cohorts is a similar process, but requires click on the blue ‘+ Add Outcome Cohort’ button (M in Figure <a href="PatientLevelPrediction.html#fig:specification1">14.20</a>).</p>
<p>You need to specify, at minimum, one target population cohort and one outcome cohort. Once you have added all the target population cohorts and outcome cohorts you are now ready to procede to the analysis settings.</p>
</div>
<div id="analysis-settings" class="section level3">
<h3><span class="header-section-number">14.7.5</span> Analysis Settings</h3>
<p>The analysis settings enables you to pick the supervised learning models, the covariates and population settings.</p>
</div>
<div id="model-settings" class="section level3">
<h3><span class="header-section-number">14.7.6</span> Model Settings</h3>
<p>You can pick one or more supervised learning models to investigate using for model development. To add a supervised learning model click on the blue ‘+ Add Model Settings’ button (O in Figure <a href="PatientLevelPrediction.html#fig:specification1">14.20</a>). A dropdown containing all the models currently supported in the Atlas interface will appear (note: more models may be available outside of Atlas).</p>
<p>You can select the supervised learning model you want to include in the study by clicking on the name in the dropdown menu. This will then take you to a view for that specific model and the hyper-parameters you can include into a grid search. For example, if I click on ‘Lasso Logistic Regression’ the following view shown in Figure <a href="PatientLevelPrediction.html#fig:figureAS2">14.24</a> will appear.</p>
<div class="figure"><span id="fig:figureAS2"></span>
<img src="images/PatientLevelPrediction/atlasImplementation/analysis_lasso_lr_view.png" alt="The lasso logistic regression view" width="100%" />
<p class="caption">
Figure 14.24: The lasso logistic regression view
</p>
</div>
<p>As the Lasso Logistic Regression model only has one hyper-parameter, we do an automatic search for the optimal value rather than a grid search so a user just needs to specify the starting value, see Figure <a href="PatientLevelPrediction.html#fig:figureAS2">14.24</a>. Once you are happy with the hyper-parameter settings you can return to the main settings view by clicking on the grey ‘&lt;’ button.</p>
<p>You will now see your chosen supervised learning model added tosection N in Figure <a href="PatientLevelPrediction.html#fig:specification1">14.20</a>. To edit the model you added, click on the corresponding row and it will take you back to the model view where you can edit the hyper-parameter settings.</p>
To add a gradient boosting machine model we can follow the same process and click on ‘Gradient Boosting Machine’ in the drop down menu. This will take us into the gradient boosting machine view:
<div class="figure"><span id="fig:figureAS5"></span>
<img src="images/PatientLevelPrediction/atlasImplementation/analysis_gbm_view.png" alt="The gradient boosting machine view" width="100%" />
<p class="caption">
Figure 14.25: The gradient boosting machine view
</p>
</div>
The gradient boosting machine model has four hyper-parameters you can define a grid search for (boosting learn rate, maximum number of interactions, minimum number of trees and number of trees to build). Initially the default values are shown, but a user can add a new value by typing it into the text field at the bottom of the hyper-parameter box and clicking on the blue ‘Add’ button.<br />

<div class="figure"><span id="fig:figureAS6"></span>
<img src="images/PatientLevelPrediction/atlasImplementation/analysis_adding_hyper.png" alt="Adding a hyper-parameter value into the grid search" width="100%" />
<p class="caption">
Figure 14.26: Adding a hyper-parameter value into the grid search
</p>
</div>
It is also possible to remove a hyper-parameter value from the grid search by clicking on ‘Remove’ for the corresponding row:
<div class="figure"><span id="fig:figureAS7"></span>
<img src="images/PatientLevelPrediction/atlasImplementation/analysis_removing_hyper.png" alt="Removing a hyper-parameter value into the grid search" width="100%" />
<p class="caption">
Figure 14.27: Removing a hyper-parameter value into the grid search
</p>
</div>
<p>Once happy with the hyper-parameters, click on the grey ‘&lt;’ button on the top left to add the model into the prediction study. You will now see you model and hyper-parameter settings in the ‘Model Setttings’ table. Repeat the process to include all the supervised learning models you want to investigate.</p>
</div>
<div id="covariate-settings" class="section level3">
<h3><span class="header-section-number">14.7.7</span> Covariate Settings</h3>
<p>We have defined a set of <em>standard</em> covariates that can be extracted from the observational data in the OMOP CDM format. In the covariate settings view, it is possible to select which of the standard covariates to include. It is possible to add many different types of covariate settings.</p>
To add a covariate setting into the study, click on the blue ‘+ Add Covariate Settings’ button (P in Figure <a href="PatientLevelPrediction.html#fig:specification2">14.21</a>). This will take you into the covariate setting view:
<div class="figure"><span id="fig:covariate1"></span>
<img src="images/PatientLevelPrediction/atlasImplementation/covariates_p1.png" alt="The covariate settings view part 1" width="100%" />
<p class="caption">
Figure 14.28: The covariate settings view part 1
</p>
</div>
<div class="figure"><span id="fig:covariate2"></span>
<img src="images/PatientLevelPrediction/atlasImplementation/covariates_p2.png" alt="The covariate settings view part 2" width="100%" />
<p class="caption">
Figure 14.29: The covariate settings view part 2
</p>
</div>
<p>The <em>standard</em> OHDSI covariates includes indicator covariates corresponding to any concept id that is recorded in the database. The indicator covariates are binary and indicate whether a patient had a concept id recorded during some time interval relative to the target cohort start date. The user can specify up to three time intervals, longterm, mediumterm and shortterm in addition to using anytime prior. There is also the option of whether to include the target cohort start date.</p>
<p>Although the <em>standard</em> OHDSI covariates iclude 4 time intervals (all time prior, longterm, mediumterm and short term) and all concept ids, generally only a subset of these covariates will be chosen. The concept ids can be restricted by OHDSI vocabulary domain (condition, drug, procedure, measurement and observation). Generally, a user will select one or two time intervals and some of the domains. For example, if a user selects long term (using default set to 365 days prior) conditions and drugs and anytime prior measurements with end days set to 0, then there could be covariates for any condition or drug concept id record 365 days prior to and up to the cohort start day for any patient in the target cohort and covariates for any measurement concept id recorded on the cohort start day or anytime prior.</p>
<p>Age group and gender are also binary covariates, with age group covariates for every 5 years (0-4, 5-9, 10-14, …, 95+).</p>
<p>Non binary covariates include age, domain counts, such as the number of condition concept ids that were recorded for each time interval per patient or the number of inpatient visits a patient had during the time interval. Measurement covaraites can be binary (indicating a measurement was taken or whether it was abnormal) or non-binary (the value of the measurement). Existing risk scores can also be chosen.</p>
<p><strong>Include/Exclude options</strong></p>
<p>The first part is of the covariate settings is the exclude/include option, see A Figure <a href="PatientLevelPrediction.html#fig:covariate1">14.28</a>. Previously we mentioned that covariates are generally constructed for any concept id in the chosen time intervals and domains. However, you may be in a situation where you only want to include certain concept ids or you may want to exlcude concept ids (e.g., if the concept id is linked to the target cohort definition).</p>
<p>To only include certain concepts, create a concept set in atlas and then under the “What concepts do you want to include in baseline covariates in the patient-level prediction model? (Leave blank if you want to include everything)” select the concept set by clicking on the blue button with a folder icon (see A in Figure <a href="PatientLevelPrediction.html#fig:covariate1">14.28</a>). This will then open up a table with all the concept sets, select the one you want. You can include the concept ids in the concept set and all descendants by select ‘yes’ to the “Should descendant concepts be added to the list of included concepts?” option. This option will mean after you select the covariates you want, only covariates corresponding to these included concept ids will be included.</p>
<p>The same process can be repeated for the “What concepts do you want to exclude in baseline covariates in the patient-level prediction model? (Leave blank if you want to include everything)” but this will mean after you select the covariates you want, any covariates corresponding to these concept ids will be removed.</p>
<p>To remove any include/exclude setting, click on the red button with an X (see B in Figure <a href="PatientLevelPrediction.html#fig:covariate1">14.28</a>).</p>
<p>The final option “A comma delimited list of covariate IDs that should be restricted to:” (see C in Figure <a href="PatientLevelPrediction.html#fig:covariate1">14.28</a>) enables you to add a set of covariate ids (rather than concept ids) comma seperated that will only be included in the model. For example if you wanted covariate ids 340504504 and 8373747504 then you would type “340504504,8373747504” into the text box. You must ensure the domain/time interval corresponding to these covariates are selected below.</p>
<p><strong>Non time bound options</strong></p>
<p>The next section enables the selection of non-time bound variables (see D in Figure <a href="PatientLevelPrediction.html#fig:covariate1">14.28</a>).</p>
<ul>
<li>Gender: a binary variable indicating male or female gender</li>
<li>Age: a continuous variable corresponding to age in years</li>
<li>Age group: binary variables for every 5 years of age (0-4, 5-9, 10-14, …, 95+)</li>
<li>Race: a binary variable for each race, 1 means the patient has that race recorded, 0 otherwise</li>
<li>Ethnicity: a binary variable for each ethnicity, 1 means the patient has that ethnicity recorded, 0 otherwise</li>
<li>Index year: [Not recommended for prediction] a binary variable for each cohort start date year, 1 means that was the patients cohort start date year, 0 otherwise</li>
<li>Index month - a binary variable for each cohort start date month, 1 means that was the patients cohort start date month, 0 otherwise</li>
<li>Prior observation time: [Not recommended for prediction] a continuous variable corresponding to how long in days the patient was in the database prior to the cohort start date</li>
<li>Post observation time: [Not recommended for prediction] a continuous variable corresponding to how long in days the patient was in the database post cohort start date</li>
<li>Time in cohort: a continuous variable corresponding to how long in days the patient was in the cohort (cohort end date minus cohort start date)</li>
<li>Index year and month: [Not recommended for prediction] a binary variable for each cohort start date year and month combination, 1 means that was the patients cohort start date year and month, 0 otherwise</li>
</ul>
<p>To include any of these variables, click the corresponding unticked box to add a tick (clicking a ticked box will remove the variable).</p>
<p><strong>Time interval options</strong></p>
<p>The standard covariates enable three flexible time intervals for the covariates:</p>
<ul>
<li>end days: when to end the time intervals relative to the cohort start date [default is 0]</li>
<li>long term [default -365 days to end days prior to cohort start date]</li>
<li>medium term [default -180 days to end days prior to cohort start date]</li>
<li>short term [default -30 days to end days prior to cohort start date]</li>
</ul>
<p>These settings can be input into the text boxes to update them at E-H in Figure <a href="PatientLevelPrediction.html#fig:covariate1">14.28</a>.</p>
<p><strong>Domain covariates</strong></p>
<p>The next option is the covariates extracted from the era tables (see J in Figure <a href="PatientLevelPrediction.html#fig:covariate1">14.28</a>):</p>
<ul>
<li>Condition: Construct covariates for each condition concept id and time interval selected and if a patient has the concept id with an era (i.e., the condition starts or ends during the time interval or starts before and ends after the time interval) during the specified time interval prior to the cohort start date in the condition era table, the covariate value is 1, otherwise 0.</li>
<li>Condition group: Construct covariates for each condition concept id and time interval selected and if a patient has the concept id <strong>or any descendant concept id</strong> with an era during the specified time interval prior to the cohort start date in the condition era table, the covariate value is 1, otherwise 0.</li>
<li>Drug: Construct covariates for each drug concept id and time interval selected and if a patient has the concept id with an era during the specified time interval prior to the cohort start date in ths drug era table, the covariate value is 1, otherwise 0.</li>
<li>Drug group: Construct covariates for each drug concept id and time interval selected and if a patient has the concept id <strong>or any descendant concept id</strong> with an era during the specified time interval prior to the cohort start date in ths drug era table, the covariate value is 1, otherwise 0.</li>
</ul>
<p>Click on a box with no tick to add a tick and select that covariate into the covariate settings. Clicking on a box with a tick with untick it and remove that covariate from the covaraite settings.</p>
<p>[need to check this] Overlapping time inverval setting means you want the drug or condition to start prior to the cohort start date and end after the cohort start date (so it overlaps with the cohort start date). The <strong>era start</strong> option restricts to finding condition or drug eras that start during the time interval selected. These options are at K in Figure <a href="PatientLevelPrediction.html#fig:covariate1">14.28</a>.</p>
<p>The domain tables covariates enable you to pick whether to include covariates corresponding to concept ids in each domain for the various time intervals (see L in Figure <a href="PatientLevelPrediction.html#fig:covariate2">14.29</a>):</p>
<ul>
<li>Condition: Construct covariates for each condition concept id and time interval selected and if a patient has the concept id recorded during the specified time interval prior to the cohort start date in the condition occurrence table, the covariate value is 1, otherwise 0.</li>
<li>Condition Primary Inpatient: ?</li>
<li>Drug: Construct covariates for each drug concept id and time interval selected and if a patient has the concept id recorded during the specified time interval prior to the cohort start date in the drug exposure table, the covariate value is 1, otherwise 0.</li>
<li>Procedure: Construct covariates for each procedure concept id and time interval selected and if a patient has the concept id recorded during the specified time interval prior to the cohort start date in the procedure occurrence table, the covariate value is 1, otherwise 0.</li>
<li>Measurement: Construct covariates for each measurement concept id and time interval selected and if a patient has the concept id recorded during the specified time interval prior to the cohort start date in the measurement table, the covariate value is 1, otherwise 0.</li>
<li>Measurement Value: Construct covariates for each measurement concept id with a value and time interval selected and if a patient has the concept id recorded during the specified time interval prior to the cohort start date in the measurement table, the covariate value is the measurement value, otherwise 0.</li>
<li>Measurement range group: ?</li>
<li>Observation: Construct covariates for each observation concept id and time interval selected and if a patient has the concept id recorded during the specified time interval prior to the cohort start date in the observation table, the covariate value is 1, otherwise 0.</li>
<li>Device: Construct covariates for each device concept id and time interval selected and if a patient has the concept id recorded during the specified time interval prior to the cohort start date in the device table, the covariate value is 1, otherwise 0.</li>
<li>Visit Count: Construct covariates for each visit and time interval selected and count the number of visits recorded during the time interval as the covariate value</li>
<li>Visit Concept Count: Construct covariates for each visit, domain and time interval selected and count the number of records per domain recorded during the visit type and time interval as the covariate value</li>
</ul>
<p>The distinct count option counds the number of records per domain and time interval [expand].</p>
<p><strong>Risk score covariates</strong></p>
<p>The final option is whether to include commonly used risk scores as covariate, M in Figure <a href="PatientLevelPrediction.html#fig:covariate2">14.29</a>.</p>
<p>Once happy with the covariate settings, click the ‘&lt;’ button (see N Figure <a href="PatientLevelPrediction.html#fig:covariate1">14.28</a>) on the top left corner to return to the main prediction settings. Your covariate options you picked will now show in the covaraite settings table. You can edit an exisitng setting by clicking on the corresponding row or add more covariate settings by clicking on the blue ‘+ Add Covariate Settings’ button again.</p>
</div>
<div id="population-settings" class="section level3">
<h3><span class="header-section-number">14.7.8</span> Population Settings</h3>
<p>The population settings is where addition inclusion criteria can be applied to the target population (this may be useful for sensitivity investigations) and is also where the time-at-risk is defined. To add a population setting into the study, click on the blue ‘+ Add Population Settings’ button (Q in Figure <a href="PatientLevelPrediction.html#fig:specification2">14.21</a>).</p>
<p>This will open up the population setting view containing various setting to define, see Figure <a href="PatientLevelPrediction.html#fig:figureAS19">14.30</a>.</p>
<div class="figure"><span id="fig:figureAS19"></span>
<img src="images/PatientLevelPrediction/atlasImplementation/analysis_population_settings.png" alt="The population setting options" width="100%" />
<p class="caption">
Figure 14.30: The population setting options
</p>
</div>
<p>The first set of options, A and B, enable the user to specify the time-at-risk period. This is a time interval relative to the target cohort dates where we look to see whether the outcome of interest occurs. If a patient has the outcome during the time at risk period then we will class them as ‘outcome’, otherwise they are classed as ‘non-outcome’.</p>
<p>The first option labelled with a red A is: “Define the time-at-risk window start, relative to target cohort entry:” - this settings lets you define the start of the time-at-risk. It is relative to the target cohort dates (cohort start date or cohort end date). You can pick an offset corresponding to the number of days and whether it is relative to the target cohort start date or the target cohort end date.</p>
<p>The second option labelled with a red B is: “Define the time-at-risk window end:” - this settings lets you define the end of the time-at-risk. It is relative to the target cohort dates (cohort start date or cohort end date). You can pick an offset corresponding to the number of days and whether it is relative to the target cohort start date or the target cohort end date.</p>
<p>See Figure <a href="PatientLevelPrediction.html#fig:figureAS20">14.31</a> for an illustration of how these settings define the time-at-risk period:</p>
<div class="figure"><span id="fig:figureAS20"></span>
<img src="images/PatientLevelPrediction/atlasImplementation/analysis_population_plot.png" alt="How the population setting options define the time-at-risk" width="100%" />
<p class="caption">
Figure 14.31: How the population setting options define the time-at-risk
</p>
</div>
<p>The next option, marked by the red C, is “Minimum lookback period applied to target cohort:”. This is where you can specify the minimum baseline period, specifically the minimum number of days prior to the cohort start date that a patient has been continuously observed. The default is 365 days. Expanding the minimum lookback will give a more complete picture of a patient (as they must have been observed for longer) but will filter many patienst (who do not have the minimum number of days prior observation).</p>
<p>The option maked by the red D is “Should subjects without time at risk be removed?”. If this is set to yes, then a value for “Minimum time at risk:” is also required. This option lets you deal with people who are lost to follow-up (e.g., they leave the database during the time-at-risk period). If you select ‘yes’ then you need to specify the minimum time a patient needs to be in the time-at-risk period for them to be included in the labelled data (if they do not have the minimum time they are excluded from the population). For example, if the time-at-risk period was 1 day from cohort start until 365 days from cohort start, then the full time-at-risk interval is 364 days (365-1). If you only want to include patients who are observed the whole interval, then set the minimum time at risk to be 364. If you are happy as long as people are in the time-at-risk for the first 100 days, then select minimum time at risk to be 100. In this case as the time-at-risk start as 1 day from the cohort start, a patient will be include if they remain in the database for at least 101 days from the cohort start date. If you set “Should subjects without time at risk be removed?” to ‘No’, then this will keep every patient, even those who drop out from the database during the time-at-risk.</p>
<p>The option E “Include people with outcomes who are not observed for the whole at risk period?” is also linked to D. This option lets you treat people with the outcome who drop out of the database during time-at-risk differently to those who do not have the outcome observed before dropping out. If “Include people with outcomes who are not observed for the whole at risk period?” is set to ‘No’, then people who are not observed for the whole time-at-risk are include/excluded depending on your settings for D. However, if “Include people with outcomes who are not observed for the whole at risk period?” is set to ‘Yes’, then this means people who have the outcome recorded during the time-at-risk interval are included in the labelled data even if they drop out from the database before the end of the time-at-risk interval.</p>
<p>The option “Should only the first exposure per subject be included?” labelled in F is only useful if you have a target cohort that contains patients multiple times but with different cohort start dates. In this situation, picking ‘yes’ for “Should only the first exposure per subject be included?” will result in only keeping the earliest target cohort date per patient in the analysis (i.e., unique patients); otherwise a patient can be in the labbelled dataset multiple times but the covariates and time-at-risk will be at different time points in the patients observation.</p>
<p>The final option G is “Remove patients who have observed the outcome prior to cohort entry?”. Selecting ‘Yes’ to this option will remove patients who have the outcome prior to the time-at-risk start date, so the model is in patients who have never experience the outcome prior. If ‘No’ is selected, then patients could have had the outcome prior. Generally, having the outcome prior is very predictive of having the outcome during the time-at-risk.</p>
<p>Once you are happy with the population settings, click on the grey ‘&lt;’ button in the top left and this will return you to the main setting view. You will now see your population settings as a new row in the population settings table. To edit the settings click on the corresponding row. This will take you to the population setting view where you can change any of the settings.</p>
<p>To add more population settings, repeat the process detailed in this section.</p>
</div>
<div id="execution-settings" class="section level3">
<h3><span class="header-section-number">14.7.9</span> Execution settings</h3>
<p>Execution settings (R in Figure <a href="PatientLevelPrediction.html#fig:specification2">14.21</a>) determine whether to use sampling, how to manage rare events, and whether to normalize covariates. Sampling can be an efficient means to determine if a model for a large population (i.e. 10 million patients) is accurate, by creating and testing the model with a subgroup of patients (e.g. if AUC is close to 0.5 on your sampling, you might abandon the model). The user specifies the size of the subgroup to be sampled. A minimum threshold value for covariate occurrence is necessary to remove rare events that are not representative of the overall population. Normalization of the covariates is usually necessary for successful implementation of a LASSO model.</p>
<p>There are three options:</p>
<ul>
<li>“Perform sampling”: here you can choosen whether to perform sampling (default = ‘No’). If you set this to ‘yes’, another option will appear “How many patients to use for a subset?”, here you can add the sample size you wish to extract.</li>
<li>“Minimum covariate occurrence: If a covariate occurs in a fraction of the target population less than this value, it will be removed:”: here you can choose then minimum covariate occurrence (default = 0.001)</li>
<li>“Normalize covariate”: here you can choose whether to normalize covariates (default = ‘Yes)</li>
</ul>
</div>
<div id="training-settings" class="section level3">
<h3><span class="header-section-number">14.7.10</span> Training settings</h3>
<p>Training settings (S in Figure <a href="PatientLevelPrediction.html#fig:specification2">14.21</a>) determine how to distribute the data between training and testing groups. Most of the data will be used to train the model and the rest will be used to test it. The data can be divided by either unit person or time. The percentage of data attributed to training or testing the model is specified by the user. Additionally, the number of folds for cross-validation is specified, which partitions the training data for hyper-parametric analysis. The user has the option of specifying the seed used to split the training and testing data for consistent distribution of the outcomes between the groups. This option is only needed for person based splitting.</p>
<p>There are four options:</p>
<ul>
<li>"Specify how to split the test/train set:: Select whether to differentiate the train/test data by person (stratified by outcome) or by time (older data to train the model, later data to evaluate the model)</li>
<li>“Percentage of the data to be used as the test set (0-100%)”: Select the percentage of data to be used as test data (default = 25%)</li>
<li>“The number of folds used in the cross validation”: Select the number of folds for cross-validation (default = 3)</li>
<li>“The seed used to split the test/train set when using a person type testSplit (optional):”: Select the seed used to split the train/test set when using a person type test split</li>
</ul>
</div>
<div id="atlas-utilities-tab" class="section level3">
<h3><span class="header-section-number">14.7.11</span> Atlas Utilities Tab</h3>
<p>The Utilities tab (H in Figure <a href="PatientLevelPrediction.html#fig:specification1">14.20</a>) is where a user can review the prediction study (once minimum required settings are defined), export/import existing atlas prediction studies and download the prediction study R package.</p>
<p><strong>Review and Download Tab</strong></p>
<p>If you have not completed all pre-requisites needed to run the study, you will see the same as Figure <a href="PatientLevelPrediction.html#fig:insuf">14.32</a>.</p>
<div class="figure"><span id="fig:insuf"></span>
<img src="images/PatientLevelPrediction/atlasImplementation/utilities_review_insuf.png" alt="Reviewing when insufficient design" width="100%" />
<p class="caption">
Figure 14.32: Reviewing when insufficient design
</p>
</div>
<p>Assuming your study contains all necessary components, you will see Figure <a href="PatientLevelPrediction.html#fig:utilities">14.33</a>, showing the tabs Full Analysis List, Prediction Problem Settings, and Analysis Settings.</p>
<div class="figure"><span id="fig:utilities"></span>
<img src="images/PatientLevelPrediction/atlasImplementation/utilities_p1.png" alt="The utilities tab reviewing valid study" width="100%" />
<p class="caption">
Figure 14.33: The utilities tab reviewing valid study
</p>
</div>
<p>Clicking on the Prediction Problem Settings (see Y in Figure <a href="PatientLevelPrediction.html#fig:utilities">14.33</a>) will show all the combinations of the Target Cohort and Outcome Cohort names specfied in the analysis.</p>
<p>Finally, clicking on the Analysis Settings tab (see Z in Figure <a href="PatientLevelPrediction.html#fig:utilities">14.33</a>) shows a table allowing you to review all of the Model Names, Model Settings, Covariate Settings, Risk Window Start and Risk Window End combinations.</p>
</div>
<div id="how-to-importexport-study" class="section level3">
<h3><span class="header-section-number">14.7.12</span> How to import/export study</h3>
<p>To export a study, click on the Export tab under utilities (see V in Figure <a href="PatientLevelPrediction.html#fig:utilities">14.33</a>). ATLAS will produce JSON file that can be directly copied and pasted into a file that contains all of the data (study name, cohort definitions, models selected, covariates, settings, etc.) needed to run the study. This is displayed in Figure <a href="PatientLevelPrediction.html#fig:export">14.34</a>.</p>
<div class="figure"><span id="fig:export"></span>
<img src="images/PatientLevelPrediction/atlasImplementation/utilities_export.png" alt="Exporting a study design" width="100%" />
<p class="caption">
Figure 14.34: Exporting a study design
</p>
</div>
<p>To import a study, first go back to the main ATLAS menu and click on Prediction. Click on the New Patient Level Prediction button, give your study a name, and Save. Next, click on the Utilities tab, then the Import tab (see U in Figure <a href="PatientLevelPrediction.html#fig:utilities">14.33</a>). Paste the contents of a Patient Level Prediction JSON file into this window, then click on the Import button below the other tab buttons.</p>
</div>
<div id="how-to-download-package" class="section level3">
<h3><span class="header-section-number">14.7.13</span> How to download package</h3>
<p>The Download Study button is available at the bottom of the Utilities screen (see X in Figure <a href="PatientLevelPrediction.html#fig:utilities">14.33</a>). Enter a descriptive name for the R package, noting that any illegal characters in R will automatically be removed from the file name by ATLAS.</p>
<p>ATLAS will generate an R package for the study, see Figure <a href="PatientLevelPrediction.html#fig:figureU9">14.35</a>.</p>
<div class="figure"><span id="fig:figureU9"></span>
<img src="images/PatientLevelPrediction/atlasImplementation/utilities_downloading.png" alt="The downloaded study design R package" width="100%" />
<p class="caption">
Figure 14.35: The downloaded study design R package
</p>
</div>
</div>
<div id="building-atlas-created-prediction-study-r-package" class="section level3">
<h3><span class="header-section-number">14.7.14</span> Building Atlas created prediction study R package</h3>
<p><strong>Setting up R</strong></p>
<p>To run the atlas generated prediction R package study requires having R studio () installed, the devtools R package [in R run: install.packages(‘devtools’)] and the OHDSI PatientLevelPrediction package installed (see …).</p>
<p><strong>Unzipping atlas compressed folder</strong></p>
<p>Atlas generates a zipped directory containing the R package. This zipped directory needs to be extracted. Once extracted the directory will look like:</p>
<div class="figure"><span id="fig:figureU10"></span>
<img src="images/PatientLevelPrediction/atlasImplementation/download_folder.png" alt="The directory of study design R package" width="100%" />
<p class="caption">
Figure 14.36: The directory of study design R package
</p>
</div>
<p><strong>Opening package project in R</strong></p>
<p>The easiest way to open the atlas created package in R is to double click on the project file:</p>
<div class="figure"><span id="fig:figureU11"></span>
<img src="images/PatientLevelPrediction/atlasImplementation/download_folder_project.png" alt="Opening the study design R package" width="100%" />
<p class="caption">
Figure 14.37: Opening the study design R package
</p>
</div>
<p>This will then open a new R studio session:</p>
<div class="figure"><span id="fig:figureU12"></span>
<img src="images/PatientLevelPrediction/atlasImplementation/rstudio_start.png" alt="Rstudio open with the study design project" width="100%" />
<p class="caption">
Figure 14.38: Rstudio open with the study design project
</p>
</div>
<p><strong>Building project</strong></p>
Once R studio has opened the project, you can then build the package by clicking on the ‘build’ option in the top right hand side:
<div class="figure"><span id="fig:figureU13"></span>
<img src="images/PatientLevelPrediction/atlasImplementation/building.png" alt="Building the R project into a local R library" width="100%" />
<p class="caption">
Figure 14.39: Building the R project into a local R library
</p>
</div>
If you find a message like (but with the text in red matching the name you called your study):
<div class="figure"><span id="fig:figureU14"></span>
<img src="images/PatientLevelPrediction/atlasImplementation/buildComplete.png" alt="Building the R project completed" width="100%" />
<p class="caption">
Figure 14.40: Building the R project completed
</p>
</div>
<p>Your package has now been created and will be available to run. If you have a message with an error then there was an issue with building the package and the package did not get built. Common issues causing the build to fail are missing dependencies, to find out the R packages required for your built, open the ‘DESCRIPTION’ file in the main directory:</p>
<div class="figure"><span id="fig:figureU15"></span>
<img src="images/PatientLevelPrediction/atlasImplementation/download_folder_desc.png" alt="Finding the DECSRIPTION file" width="100%" />
<p class="caption">
Figure 14.41: Finding the DECSRIPTION file
</p>
</div>
<p>This will open up in R studio and show what R packages are required (the packages in the Imports section)</p>
<div class="figure"><span id="fig:figureU16"></span>
<img src="images/PatientLevelPrediction/atlasImplementation/description.png" alt="The DECSRIPTION file content" width="100%" />
<p class="caption">
Figure 14.42: The DECSRIPTION file content
</p>
</div>
<p>If you do not have any of the packages listed in ‘Imports:’ then you will need to install them before building the atlas generated package.</p>
</div>
<div id="running-study" class="section level3">
<h3><span class="header-section-number">14.7.15</span> Running Study</h3>
<p><strong>Readme and extras/codetorun.R</strong></p>
<p>The key file in the atlas generated package directory is the one that contains code for running the study, the CodeToRun.R file found in the extras directory:</p>
<div class="figure"><span id="fig:figureU17"></span>
<img src="images/PatientLevelPrediction/atlasImplementation/download_folder_extras.png" alt="The CodeToRun.R file is in the extras folder" width="100%" />
<p class="caption">
Figure 14.43: The CodeToRun.R file is in the extras folder
</p>
</div>
We recommend opening the file CodeToRun.R
<div class="figure"><span id="fig:figureU18"></span>
<img src="images/PatientLevelPrediction/atlasImplementation/code_to_run.png" alt="The CodeToRun.R file" width="100%" />
<p class="caption">
Figure 14.44: The CodeToRun.R file
</p>
</div>
<p><strong>CodeToRun.R Settings</strong></p>
<p>The final step to running the study is to connect to the database through R and specify where the results should be saved.,</p>
The CodeToRun.R file looks like:
<div class="figure"><span id="fig:figureU19"></span>
<img src="images/PatientLevelPrediction/atlasImplementation/code_to_run_open.png" alt="The CodeToRun.R default setting" width="100%" />
<p class="caption">
Figure 14.45: The CodeToRun.R default setting
</p>
</div>
<p>The inputs for the CodeToRun file are:</p>
<ul>
<li>outputFolder: This is a string specifying where in your computer to save the results. This location needs to have sufficient space as data will be extracted from the database into this location and the lcoation must have read/write access.</li>
<li>options(fftempdir = ’’): this is a location in your computer that must have read/write access and large amounts of space. It will be used to store temporary data.</li>
<li>dbms: The database management system you use</li>
<li>user: Your username for the database connection (contact database administrator if unknown)</li>
<li>pw: Your password for the database connection (contact database administrator if unknown)</li>
<li>server: a string specifying the database server (contact database administrator if unknown)</li>
<li>port: (optional) the port number (contact database administrator if unknown)</li>
<li>cdmDatabaseSchema: a string specifying the database schema containing the OMOP CDM instance</li>
<li>cohortDatabaseSchema: a string specifying the database schema either containing the cohorts or where to create the cohorts.</li>
<li>oracleTempSchema: if using oracle, this is your temp database schema</li>
<li>cohortTable: the name of the cohort table (if using atlas cohorts then this will be ‘cohort’)</li>
</ul>
Once the settings are filled out, the final step is to pick what parts of the study to execute:
<div class="figure"><span id="fig:figureU20"></span>
<img src="images/PatientLevelPrediction/atlasImplementation/execute.png" alt="Executing the study" width="100%" />
<p class="caption">
Figure 14.46: Executing the study
</p>
</div>
<p>The following options specify:</p>
<ul>
<li>A: createProtocol - set to ‘True’ if you want to create a word document protocol template that automatically inserts the study design settings. This can be shared if creating a network study.</li>
<li>B: createCohorts - do you need to create the cohorts for this study? If you are using atlas cohorts you can set this to ‘False’ otherwise set this to ‘True’ and the cohorts you picked for the study will all be generated.</li>
<li>C: runAnalyses - setting this to ‘True’ will result in models being developed and evaluated for each setting you specified in the study design. This requires cohorts to have been generated (in atlas or using B createCohorts set to ‘True’).</li>
<li>D: createResultsDoc - if you set A: createProtocol to ‘True’ and generated a protocol and also ran the analysis by setting C: runAnalyses to ‘True’ then you can add the results into the protocol to create a word document with the protocol and results.</li>
<li>E: packageResults - if you set C: runAnalyses to ‘True’ and have results, you can set packageResults to ‘True’ to create a zipped folder containing your results with any sensitive data removed. This can be easily shared with other OHDSI colabortors.</li>
<li>F: createValidationPackage - if a model seems to do, we can use this option to create a new R package for validating the model. Set to ‘True’ to create a validation package containing all the models for external validation. In later Atlas versions there is another input where you can specify the analysis id of a model rather than validating all models.</li>
<li>G: minCellCount - this is linked to E: packageResults and F: createValidationPackage and specifies the minimum cell count for any result to be included when sharing the models. For example, if the minCellCount is 5, then any count with a value less than 5 will be removed.</li>
</ul>
<p><strong>Viewing the Results</strong></p>
<p>After running the R package analysis you can view the results in an interactive shiny app by running:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="PatientLevelPrediction.html#cb86-1"></a>PatientLevelPrediction<span class="op">::</span><span class="kw">viewMultiplePlp</span>(outputFolder)</span></code></pre></div>

</div>
</div>
<div id="implementing-the-study-in-r" class="section level2">
<h2><span class="header-section-number">14.8</span> Implementing the study in R</h2>
<p>Now we have completely designed our study we have to implement the study in R. This will be done using the <a href="https://ohdsi.github.io/PatientLevelPrediction/">PatientLevelPrediction</a> package to build patient-level predictive models. The package enables data extraction, model building, and model evaluation using data from databases that are translated into the OMOP CDM.</p>
<div id="cohort-instantiation-1" class="section level3">
<h3><span class="header-section-number">14.8.1</span> Cohort instantiation</h3>
<p>We first need to instantiate the target and outcome cohorts. Instantiating cohorts is described in Chapter <a href="Cohorts.html#Cohorts">11</a>. The Appendix provides the full definitions of the target (Appendix <a href="CohortDefinitions.html#AceInhibitors">B.1</a>) and outcome (Appendix <a href="CohortDefinitions.html#Angioedema">B.4</a>) cohorts. In this example we will assume the ACE inhibitors cohort has ID 1, and the angioedema cohort has ID 2.</p>
</div>
<div id="data-extraction-1" class="section level3">
<h3><span class="header-section-number">14.8.2</span> Data extraction</h3>
<p>We first need to tell R how to connect to the server. <a href="https://ohdsi.github.io/PatientLevelPrediction/"><code>PatientLevelPrediction</code></a> uses the <a href="https://ohdsi.github.io/DatabaseConnector/"><code>DatabaseConnector</code></a> package, which provides a function called <code>createConnectionDetails</code>. Type <code>?createConnectionDetails</code> for the specific settings required for the various database management systems (DBMS). For example, one might connect to a PostgreSQL database using this code:</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="PatientLevelPrediction.html#cb87-1"></a><span class="kw">library</span>(PatientLevelPrediction)</span>
<span id="cb87-2"><a href="PatientLevelPrediction.html#cb87-2"></a>connDetails &lt;-<span class="st"> </span><span class="kw">createConnectionDetails</span>(<span class="dt">dbms =</span> <span class="st">&quot;postgresql&quot;</span>,</span>
<span id="cb87-3"><a href="PatientLevelPrediction.html#cb87-3"></a>                                       <span class="dt">server =</span> <span class="st">&quot;localhost/ohdsi&quot;</span>,</span>
<span id="cb87-4"><a href="PatientLevelPrediction.html#cb87-4"></a>                                       <span class="dt">user =</span> <span class="st">&quot;joe&quot;</span>,</span>
<span id="cb87-5"><a href="PatientLevelPrediction.html#cb87-5"></a>                                       <span class="dt">password =</span> <span class="st">&quot;supersecret&quot;</span>)</span>
<span id="cb87-6"><a href="PatientLevelPrediction.html#cb87-6"></a></span>
<span id="cb87-7"><a href="PatientLevelPrediction.html#cb87-7"></a>cdmDbSchema &lt;-<span class="st"> &quot;my_cdm_data&quot;</span></span>
<span id="cb87-8"><a href="PatientLevelPrediction.html#cb87-8"></a>cohortsDbSchema &lt;-<span class="st"> &quot;scratch&quot;</span></span>
<span id="cb87-9"><a href="PatientLevelPrediction.html#cb87-9"></a>cohortsDbTable &lt;-<span class="st"> &quot;my_cohorts&quot;</span></span>
<span id="cb87-10"><a href="PatientLevelPrediction.html#cb87-10"></a>cdmVersion &lt;-<span class="st"> &quot;5&quot;</span></span></code></pre></div>
<p>The last four lines define the <code>cdmDbSchema</code>, <code>cohortsDbSchema</code>, and <code>cohortsDbTable</code> variables, as well as the CDM version. We will use these later to tell R where the data in CDM format live, where the cohorts of interest have been created, and what version CDM is used. Note that for Microsoft SQL Server, database schemas need to specify both the database and the schema, so for example <code>cdmDbSchema &lt;- "my_cdm_data.dbo"</code>.</p>
<p>First it makes sense to verify that the cohort creation has succeeded, by counting the number of cohort entries:</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="PatientLevelPrediction.html#cb88-1"></a>sql &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;SELECT cohort_definition_id, COUNT(*) AS count&quot;</span>,</span>
<span id="cb88-2"><a href="PatientLevelPrediction.html#cb88-2"></a><span class="st">&quot;FROM @cohortsDbSchema.cohortsDbTable&quot;</span>,</span>
<span id="cb88-3"><a href="PatientLevelPrediction.html#cb88-3"></a><span class="st">&quot;GROUP BY cohort_definition_id&quot;</span>)</span>
<span id="cb88-4"><a href="PatientLevelPrediction.html#cb88-4"></a>conn &lt;-<span class="st"> </span><span class="kw">connect</span>(connDetails)</span>
<span id="cb88-5"><a href="PatientLevelPrediction.html#cb88-5"></a><span class="kw">renderTranslateQuerySql</span>(<span class="dt">connection =</span> conn, </span>
<span id="cb88-6"><a href="PatientLevelPrediction.html#cb88-6"></a>                        <span class="dt">sql =</span> sql,</span>
<span id="cb88-7"><a href="PatientLevelPrediction.html#cb88-7"></a>                        <span class="dt">cohortsDbSchema =</span> cohortsDbSchema,</span>
<span id="cb88-8"><a href="PatientLevelPrediction.html#cb88-8"></a>                        <span class="dt">cohortsDbTable =</span> cohortsDbTable)</span></code></pre></div>
<pre><code>##   cohort_definition_id  count
## 1                    1 527616
## 2                    2   3201</code></pre>
<p>Now we can tell <a href="https://ohdsi.github.io/PatientLevelPrediction/">PatientLevelPrediction</a> to extract all necessary data for our analysis. Covariates are extracted using the <a href="https://ohdsi.github.io/FeatureExtraction/"><code>FeatureExtraction</code></a> package. For more detailed information on the FeatureExtraction package see its vignettes. For our example study we decided to use these settings:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="PatientLevelPrediction.html#cb90-1"></a>covSettings &lt;-<span class="st"> </span><span class="kw">createCovariateSettings</span>(<span class="dt">useDemographicsGender =</span> <span class="ot">TRUE</span>,</span>
<span id="cb90-2"><a href="PatientLevelPrediction.html#cb90-2"></a>                                       <span class="dt">useDemographicsAge =</span> <span class="ot">TRUE</span>,</span>
<span id="cb90-3"><a href="PatientLevelPrediction.html#cb90-3"></a>                                       <span class="dt">useConditionGroupEraLongTerm =</span> <span class="ot">TRUE</span>,</span>
<span id="cb90-4"><a href="PatientLevelPrediction.html#cb90-4"></a>                                       <span class="dt">useConditionGroupEraAnyTimePrior =</span> <span class="ot">TRUE</span>,</span>
<span id="cb90-5"><a href="PatientLevelPrediction.html#cb90-5"></a>                                       <span class="dt">useDrugGroupEraLongTerm =</span> <span class="ot">TRUE</span>,</span>
<span id="cb90-6"><a href="PatientLevelPrediction.html#cb90-6"></a>                                       <span class="dt">useDrugGroupEraAnyTimePrior =</span> <span class="ot">TRUE</span>,</span>
<span id="cb90-7"><a href="PatientLevelPrediction.html#cb90-7"></a>                                       <span class="dt">useVisitConceptCountLongTerm =</span> <span class="ot">TRUE</span>,</span>
<span id="cb90-8"><a href="PatientLevelPrediction.html#cb90-8"></a>                                       <span class="dt">longTermStartDays =</span> <span class="dv">-365</span>,</span>
<span id="cb90-9"><a href="PatientLevelPrediction.html#cb90-9"></a>                                       <span class="dt">endDays =</span> <span class="dv">-1</span>)</span></code></pre></div>
<p>The final step for extracting the data is to run the <code>getPlpData</code> function and input the connection details, the database schema where the cohorts are stored, the cohort definition ids for the cohort and outcome, and the washoutPeriod which is the minimum number of days prior to cohort index date that the person must have been observed to be included into the data, and finally input the previously constructed covariate settings.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="PatientLevelPrediction.html#cb91-1"></a>plpData &lt;-<span class="st"> </span><span class="kw">getPlpData</span>(<span class="dt">connectionDetails =</span> connDetails,</span>
<span id="cb91-2"><a href="PatientLevelPrediction.html#cb91-2"></a>                      <span class="dt">cdmDatabaseSchema =</span> cdmDbSchema,</span>
<span id="cb91-3"><a href="PatientLevelPrediction.html#cb91-3"></a>                      <span class="dt">cohortDatabaseSchema =</span> cohortsDbSchema,</span>
<span id="cb91-4"><a href="PatientLevelPrediction.html#cb91-4"></a>                      <span class="dt">cohortTable =</span> cohortsDbSchema,</span>
<span id="cb91-5"><a href="PatientLevelPrediction.html#cb91-5"></a>                      <span class="dt">cohortId =</span> <span class="dv">1</span>,</span>
<span id="cb91-6"><a href="PatientLevelPrediction.html#cb91-6"></a>                      <span class="dt">covariateSettings =</span> covariateSettings,</span>
<span id="cb91-7"><a href="PatientLevelPrediction.html#cb91-7"></a>                      <span class="dt">outcomeDatabaseSchema =</span> cohortsDbSchema,</span>
<span id="cb91-8"><a href="PatientLevelPrediction.html#cb91-8"></a>                      <span class="dt">outcomeTable =</span> cohortsDbSchema,</span>
<span id="cb91-9"><a href="PatientLevelPrediction.html#cb91-9"></a>                      <span class="dt">outcomeIds =</span> <span class="dv">2</span>,</span>
<span id="cb91-10"><a href="PatientLevelPrediction.html#cb91-10"></a>                      <span class="dt">sampleSize =</span> <span class="dv">10000</span></span>
<span id="cb91-11"><a href="PatientLevelPrediction.html#cb91-11"></a>)</span></code></pre></div>
<p>There are many additional parameters for the <code>getPlpData</code> function which are all documented in the <a href="https://ohdsi.github.io/PatientLevelPrediction/">PatientLevelPrediction</a> manual. The resulting <code>plpData</code> object uses the package <code>ff</code> to store information in a way that ensures R does not run out of memory, even when the data are large.</p>
<p>Creating the <code>plpData</code> object can take considerable computing time, and it is probably a good idea to save it for future sessions. Because <code>plpData</code> uses <code>ff</code>, we cannot use R’s regular save function. Instead, we’ll have to use the <code>savePlpData()</code> function:</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="PatientLevelPrediction.html#cb92-1"></a><span class="kw">savePlpData</span>(plpData, <span class="st">&quot;angio_in_ace_data&quot;</span>)</span></code></pre></div>
<p>We can use the <code>loadPlpData()</code> function to load the data in a future session.</p>
</div>
<div id="additional-inclusion-criteria" class="section level3">
<h3><span class="header-section-number">14.8.3</span> Additional inclusion criteria</h3>
<p>To completely define the prediction problem the final study population is obtained by applying additional constraints on the two earlier defined cohorts, e.g., a minumim time at risk can be enforced (<code>requireTimeAtRisk, minTimeAtRisk</code>) and we can specify if this also applies to patients with the outcome (<code>includeAllOutcomes</code>). Here we also specify the start and end of the risk window relative to target cohort start. For example, if we like the risk window to start 30 days after the at-risk cohort start and end a year later we can set <code>riskWindowStart = 30</code> and <code>riskWindowEnd = 365</code>. In some cases the risk window needs to start at the cohort end date. This can be achieved by setting <code>addExposureToStart = TRUE</code> which adds the cohort (exposure) time to the start date.</p>
<p>In the example below all the settings we defined for our study are imposed:</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="PatientLevelPrediction.html#cb93-1"></a>population &lt;-<span class="st"> </span><span class="kw">createStudyPopulation</span>(<span class="dt">plpData =</span> plpData,</span>
<span id="cb93-2"><a href="PatientLevelPrediction.html#cb93-2"></a>                                    <span class="dt">outcomeId =</span> <span class="dv">2</span>,</span>
<span id="cb93-3"><a href="PatientLevelPrediction.html#cb93-3"></a>                                    <span class="dt">washoutPeriod =</span> <span class="dv">364</span>,</span>
<span id="cb93-4"><a href="PatientLevelPrediction.html#cb93-4"></a>                                    <span class="dt">firstExposureOnly =</span> <span class="ot">FALSE</span>,</span>
<span id="cb93-5"><a href="PatientLevelPrediction.html#cb93-5"></a>                                    <span class="dt">removeSubjectsWithPriorOutcome =</span> <span class="ot">TRUE</span>,</span>
<span id="cb93-6"><a href="PatientLevelPrediction.html#cb93-6"></a>                                    <span class="dt">priorOutcomeLookback =</span> <span class="dv">9999</span>,</span>
<span id="cb93-7"><a href="PatientLevelPrediction.html#cb93-7"></a>                                    <span class="dt">riskWindowStart =</span> <span class="dv">1</span>,</span>
<span id="cb93-8"><a href="PatientLevelPrediction.html#cb93-8"></a>                                    <span class="dt">riskWindowEnd =</span> <span class="dv">365</span>,</span>
<span id="cb93-9"><a href="PatientLevelPrediction.html#cb93-9"></a>                                    <span class="dt">addExposureDaysToStart =</span> <span class="ot">FALSE</span>,</span>
<span id="cb93-10"><a href="PatientLevelPrediction.html#cb93-10"></a>                                    <span class="dt">addExposureDaysToEnd =</span> <span class="ot">FALSE</span>,</span>
<span id="cb93-11"><a href="PatientLevelPrediction.html#cb93-11"></a>                                    <span class="dt">minTimeAtRisk =</span> <span class="dv">364</span>,</span>
<span id="cb93-12"><a href="PatientLevelPrediction.html#cb93-12"></a>                                    <span class="dt">requireTimeAtRisk =</span> <span class="ot">TRUE</span>,</span>
<span id="cb93-13"><a href="PatientLevelPrediction.html#cb93-13"></a>                                    <span class="dt">includeAllOutcomes =</span> <span class="ot">TRUE</span>,</span>
<span id="cb93-14"><a href="PatientLevelPrediction.html#cb93-14"></a>                                    <span class="dt">verbosity =</span> <span class="st">&quot;DEBUG&quot;</span></span>
<span id="cb93-15"><a href="PatientLevelPrediction.html#cb93-15"></a>)</span></code></pre></div>
</div>
<div id="model-development" class="section level3">
<h3><span class="header-section-number">14.8.4</span> Model Development</h3>
<p>In the set function of an algorithm the user can specify a list of eligible values for each hyper-parameter. All possible combinations of the hyper-parameters are included in a so-called grid search using cross-validation on the training set. If a user does not specify any value then the default value is used instead.</p>
<p>For example, if we use the following settings for the gradientBoostingMachine: ntrees=c(100,200), maxDepth=4 the grid search will apply the gradient boosting machine algorithm with ntrees=100 and maxDepth=4 plus the default settings for other hyper-parameters and ntrees=200 and maxDepth=4 plus the default settings for other hyper-parameters. The hyper-parameters that lead to the bestcross-validation performance will then be chosen for the final model. For our problem we choose to build a logistic regression model with the default hyper-parameters</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="PatientLevelPrediction.html#cb94-1"></a>gbmModel &lt;-<span class="st"> </span><span class="kw">setGradientBoostingMachine</span>(<span class="dt">ntrees =</span> <span class="dv">5000</span>, </span>
<span id="cb94-2"><a href="PatientLevelPrediction.html#cb94-2"></a>                                       <span class="dt">maxDepth =</span> <span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">7</span>,<span class="dv">10</span>), </span>
<span id="cb94-3"><a href="PatientLevelPrediction.html#cb94-3"></a>                                       <span class="dt">learnRate =</span> <span class="kw">c</span>(<span class="fl">0.001</span>,<span class="fl">0.01</span>,<span class="fl">0.1</span>,<span class="fl">0.9</span>))</span></code></pre></div>
<p>The <code>runPlP</code> function uses the population, <code>plpData</code>, and model settings to train and evaluate the model. We can use the testSplit (person/time) and testFraction parameters to split the data in a 75%-25% split and run the patient-level prediction pipeline:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="PatientLevelPrediction.html#cb95-1"></a>gbmResults &lt;-<span class="st"> </span><span class="kw">runPlp</span>(<span class="dt">population =</span> population, </span>
<span id="cb95-2"><a href="PatientLevelPrediction.html#cb95-2"></a>                     <span class="dt">plpData =</span> plpData, </span>
<span id="cb95-3"><a href="PatientLevelPrediction.html#cb95-3"></a>                     <span class="dt">modelSettings =</span> gbmModel, </span>
<span id="cb95-4"><a href="PatientLevelPrediction.html#cb95-4"></a>                     <span class="dt">testSplit =</span> <span class="st">&#39;person&#39;</span>,</span>
<span id="cb95-5"><a href="PatientLevelPrediction.html#cb95-5"></a>                     <span class="dt">testFraction =</span> <span class="fl">0.25</span>, </span>
<span id="cb95-6"><a href="PatientLevelPrediction.html#cb95-6"></a>                     <span class="dt">nfold =</span> <span class="dv">2</span>, </span>
<span id="cb95-7"><a href="PatientLevelPrediction.html#cb95-7"></a>                     <span class="dt">splitSeed =</span> <span class="dv">1234</span>)</span></code></pre></div>
<p>Under the hood the package will now use the R xgboost package to fit a a gradient boosting machine model using 75% of the data and will evaluate the model on the remaining 25%. A results data structure is returned containing information about the model, its performance etc.</p>
<p>In the <code>runPlp</code> function there are several parameters to save the <code>plpData</code>, <code>plpResults</code>, <code>plpPlots</code>, <code>evaluation</code>, etc. objects which are all set to <code>TRUE</code> by default.</p>
<p>You can save the model using:</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="PatientLevelPrediction.html#cb96-1"></a><span class="kw">savePlpModel</span>(gbmResults<span class="op">$</span>model, <span class="dt">dirPath =</span> <span class="st">&quot;model&quot;</span>)</span></code></pre></div>
<p>You can load the model using:</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="PatientLevelPrediction.html#cb97-1"></a>plpModel &lt;-<span class="st"> </span><span class="kw">loadPlpModel</span>(<span class="st">&quot;model&quot;</span>)</span></code></pre></div>
<p>You can also save the full results structure using:</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="PatientLevelPrediction.html#cb98-1"></a><span class="kw">savePlpResult</span>(gbmResults, <span class="dt">location =</span> <span class="st">&quot;gbmResults&quot;</span>)</span></code></pre></div>
<p>To load the full results structure use:</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="PatientLevelPrediction.html#cb99-1"></a>gbmResults &lt;-<span class="st"> </span><span class="kw">loadPlpResult</span>(<span class="st">&quot;gbmResults&quot;</span>)</span></code></pre></div>
</div>
<div id="internal-validation" class="section level3">
<h3><span class="header-section-number">14.8.5</span> Internal Validation</h3>
<p>Once we execute the study, the <code>runPlp</code> function returns the trained model and the evaluation of the model on the train/test sets. You can interactively view the results by running: <code>viewPlp(runPlp = gbmResults)</code>. This will open a Shiny App in your browser in which you can view all performance measures created by the framework, including interactive plots, as shown in Figure <a href="#fig:shinysummary"><strong>??</strong></a>.</p>
<p><img src="images/PatientLevelPrediction/shinysummary.png" width="100%" /></p>
<p>To generate and save all the evaluation plots to a folder run the following code:</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="PatientLevelPrediction.html#cb100-1"></a><span class="kw">plotPlp</span>(gbmResults, <span class="st">&quot;plots&quot;</span>)</span></code></pre></div>
<p>The plots are described in more detail <a href="PatientLevelPrediction.html#performance">here</a></p>
<div id="external-validation" class="section level5">
<h5><span class="header-section-number">14.8.5.0.1</span> External validation</h5>
<p>We recommend to always perform external validation, i.e. apply the final model on as much new datasets as feasible and evaluate its performance. Here we assume the data extraction has already been peformed on a second database and stored in the <code>newData</code> folder. We load the model we previously fitted from the <code>model</code> folder:</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="PatientLevelPrediction.html#cb101-1"></a><span class="co"># load the trained model</span></span>
<span id="cb101-2"><a href="PatientLevelPrediction.html#cb101-2"></a>plpModel &lt;-<span class="st"> </span><span class="kw">loadPlpModel</span>(<span class="st">&quot;model&quot;</span>)</span>
<span id="cb101-3"><a href="PatientLevelPrediction.html#cb101-3"></a></span>
<span id="cb101-4"><a href="PatientLevelPrediction.html#cb101-4"></a><span class="co">#load the new plpData and create the population</span></span>
<span id="cb101-5"><a href="PatientLevelPrediction.html#cb101-5"></a>plpData &lt;-<span class="st"> </span><span class="kw">loadPlpData</span>(<span class="st">&quot;newData&quot;</span>)</span>
<span id="cb101-6"><a href="PatientLevelPrediction.html#cb101-6"></a></span>
<span id="cb101-7"><a href="PatientLevelPrediction.html#cb101-7"></a>population &lt;-<span class="st"> </span><span class="kw">createStudyPopulation</span>(<span class="dt">plpData =</span> plpData,</span>
<span id="cb101-8"><a href="PatientLevelPrediction.html#cb101-8"></a>                                    <span class="dt">outcomeId =</span> <span class="dv">2</span>,</span>
<span id="cb101-9"><a href="PatientLevelPrediction.html#cb101-9"></a>                                    <span class="dt">washoutPeriod =</span> <span class="dv">364</span>,</span>
<span id="cb101-10"><a href="PatientLevelPrediction.html#cb101-10"></a>                                    <span class="dt">firstExposureOnly =</span> <span class="ot">FALSE</span>,</span>
<span id="cb101-11"><a href="PatientLevelPrediction.html#cb101-11"></a>                                    <span class="dt">removeSubjectsWithPriorOutcome =</span> <span class="ot">TRUE</span>,</span>
<span id="cb101-12"><a href="PatientLevelPrediction.html#cb101-12"></a>                                    <span class="dt">priorOutcomeLookback =</span> <span class="dv">9999</span>,</span>
<span id="cb101-13"><a href="PatientLevelPrediction.html#cb101-13"></a>                                    <span class="dt">riskWindowStart =</span> <span class="dv">1</span>,</span>
<span id="cb101-14"><a href="PatientLevelPrediction.html#cb101-14"></a>                                    <span class="dt">riskWindowEnd =</span> <span class="dv">365</span>,</span>
<span id="cb101-15"><a href="PatientLevelPrediction.html#cb101-15"></a>                                    <span class="dt">addExposureDaysToStart =</span> <span class="ot">FALSE</span>,</span>
<span id="cb101-16"><a href="PatientLevelPrediction.html#cb101-16"></a>                                    <span class="dt">addExposureDaysToEnd =</span> <span class="ot">FALSE</span>,</span>
<span id="cb101-17"><a href="PatientLevelPrediction.html#cb101-17"></a>                                    <span class="dt">minTimeAtRisk =</span> <span class="dv">364</span>,</span>
<span id="cb101-18"><a href="PatientLevelPrediction.html#cb101-18"></a>                                    <span class="dt">requireTimeAtRisk =</span> <span class="ot">TRUE</span>,</span>
<span id="cb101-19"><a href="PatientLevelPrediction.html#cb101-19"></a>                                    <span class="dt">includeAllOutcomes =</span> <span class="ot">TRUE</span></span>
<span id="cb101-20"><a href="PatientLevelPrediction.html#cb101-20"></a>)</span>
<span id="cb101-21"><a href="PatientLevelPrediction.html#cb101-21"></a></span>
<span id="cb101-22"><a href="PatientLevelPrediction.html#cb101-22"></a><span class="co"># apply the trained model on the new data</span></span>
<span id="cb101-23"><a href="PatientLevelPrediction.html#cb101-23"></a>validationResults &lt;-<span class="st"> </span><span class="kw">applyModel</span>(population, plpData, plpModel)</span></code></pre></div>
<p>To make things easier we also provide the <code>externalValidatePlp</code> function for performing external validation that also extracts the required data. Assuming you ran <code>result &lt;- runPlp(...)</code> then you can extract the data required for the model and evaluated it on new data. Assuming the validation cohorts are in the table <code>mainschema.dob.cohort</code> with ids 1 and 2 and the cdm data is in the schema <code>cdmschema.dob</code>:</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="PatientLevelPrediction.html#cb102-1"></a>valResult &lt;-<span class="st"> </span><span class="kw">externalValidatePlp</span>(<span class="dt">plpResult =</span> result, </span>
<span id="cb102-2"><a href="PatientLevelPrediction.html#cb102-2"></a>                    <span class="dt">connectionDetails =</span> connectionDetails,</span>
<span id="cb102-3"><a href="PatientLevelPrediction.html#cb102-3"></a>                    <span class="dt">validationSchemaTarget =</span> <span class="st">&#39;mainschema.dob&#39;</span>,</span>
<span id="cb102-4"><a href="PatientLevelPrediction.html#cb102-4"></a>                    <span class="dt">validationSchemaOutcome =</span> <span class="st">&#39;mainschema.dob&#39;</span>,</span>
<span id="cb102-5"><a href="PatientLevelPrediction.html#cb102-5"></a>                    <span class="dt">validationSchemaCdm =</span> <span class="st">&#39;cdmschema.dbo&#39;</span>,</span>
<span id="cb102-6"><a href="PatientLevelPrediction.html#cb102-6"></a>                    <span class="dt">databaseNames =</span> <span class="st">&#39;new database&#39;</span>,</span>
<span id="cb102-7"><a href="PatientLevelPrediction.html#cb102-7"></a>                    <span class="dt">validationTableTarget =</span> <span class="st">&#39;cohort&#39;</span>,</span>
<span id="cb102-8"><a href="PatientLevelPrediction.html#cb102-8"></a>                    <span class="dt">validationTableOutcome =</span> <span class="st">&#39;cohort&#39;</span>,</span>
<span id="cb102-9"><a href="PatientLevelPrediction.html#cb102-9"></a>                    <span class="dt">validationIdTarget =</span> <span class="dv">1</span>,</span>
<span id="cb102-10"><a href="PatientLevelPrediction.html#cb102-10"></a>                    <span class="dt">validationIdOutcome =</span> <span class="dv">2</span></span>
<span id="cb102-11"><a href="PatientLevelPrediction.html#cb102-11"></a>                    )</span></code></pre></div>
<p>If you have multiple databases to validate the model on then you can run:</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="PatientLevelPrediction.html#cb103-1"></a>valResults &lt;-<span class="st"> </span><span class="kw">externalValidatePlp</span>(<span class="dt">plpResult =</span> result, </span>
<span id="cb103-2"><a href="PatientLevelPrediction.html#cb103-2"></a>                    <span class="dt">connectionDetails =</span> connectionDetails,</span>
<span id="cb103-3"><a href="PatientLevelPrediction.html#cb103-3"></a>                    <span class="dt">validationSchemaTarget =</span> <span class="kw">list</span>(<span class="st">&#39;mainschema.dob&#39;</span>,<span class="st">&#39;difschema.dob&#39;</span>, <span class="st">&#39;anotherschema.dob&#39;</span>),</span>
<span id="cb103-4"><a href="PatientLevelPrediction.html#cb103-4"></a>                    <span class="dt">validationSchemaOutcome =</span> <span class="kw">list</span>(<span class="st">&#39;mainschema.dob&#39;</span>,<span class="st">&#39;difschema.dob&#39;</span>, <span class="st">&#39;anotherschema.dob&#39;</span>),</span>
<span id="cb103-5"><a href="PatientLevelPrediction.html#cb103-5"></a>                    <span class="dt">validationSchemaCdm =</span> <span class="kw">list</span>(<span class="st">&#39;cdms1chema.dbo&#39;</span>,<span class="st">&#39;cdm2schema.dbo&#39;</span>,<span class="st">&#39;cdm3schema.dbo&#39;</span>),</span>
<span id="cb103-6"><a href="PatientLevelPrediction.html#cb103-6"></a>                    <span class="dt">databaseNames =</span> <span class="kw">list</span>(<span class="st">&#39;new database 1&#39;</span>,<span class="st">&#39;new database 2&#39;</span>,<span class="st">&#39;new database 3&#39;</span>)</span>
<span id="cb103-7"><a href="PatientLevelPrediction.html#cb103-7"></a>                    <span class="dt">validationTableTarget =</span> <span class="kw">list</span>(<span class="st">&#39;cohort1&#39;</span>,<span class="st">&#39;cohort2&#39;</span>,<span class="st">&#39;cohort3&#39;</span>),</span>
<span id="cb103-8"><a href="PatientLevelPrediction.html#cb103-8"></a>                    <span class="dt">validationTableOutcome =</span> <span class="kw">list</span>(<span class="st">&#39;cohort1&#39;</span>,<span class="st">&#39;cohort2&#39;</span>,<span class="st">&#39;cohort3&#39;</span>),</span>
<span id="cb103-9"><a href="PatientLevelPrediction.html#cb103-9"></a>                    <span class="dt">validationIdTarget =</span> <span class="kw">list</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>),</span>
<span id="cb103-10"><a href="PatientLevelPrediction.html#cb103-10"></a>                    <span class="dt">validationIdOutcome =</span> <span class="kw">list</span>(<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">6</span>)</span>
<span id="cb103-11"><a href="PatientLevelPrediction.html#cb103-11"></a>                    )</span></code></pre></div>

</div>
</div>
</div>
<div id="exploring-a-single-plp-shiny-app" class="section level2">
<h2><span class="header-section-number">14.9</span> Exploring a single PLP Shiny App</h2>
<p>Exploring the performance of a single plp model is easiest with the <code>viewPlp()</code> function. This requires a plpResult as the input. If developing models in R you can use the result of <code>plpResult &lt;- runPLp(...)</code> as the input. If using the Atlas generated study package, then you need to load one of the models (in this example we will load Analysis_1):</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="PatientLevelPrediction.html#cb104-1"></a>plpResult &lt;-<span class="st"> </span><span class="kw">loadPlpResult</span>(<span class="kw">file.path</span>(outputFolder, <span class="st">&#39;Analysis_1&#39;</span>, <span class="st">&#39;plpResult&#39;</span>))</span></code></pre></div>
<p>Analysis_1 corresponds to the lasso logistic regression for the prediction problem: <strong>Withing new users of ACE inhibitors as first-line monotherapy for hypertension who will develop Acute myocardial infarction (AMI) events within a year.</strong></p>
<p>You can then launch the shiny app by running:</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="PatientLevelPrediction.html#cb105-1"></a><span class="kw">viewPlp</span>(plpResult)</span></code></pre></div>
<p>The shiny launches with a summary of the performance metrics on the test and train sets, see Figure <a href="PatientLevelPrediction.html#fig:shinySum">14.47</a>. The results show that the AUROC on the train set was 0.78 and this dropped to 0.74 on the test set. The test set AUC is the more accurrate measure. Overal, the model appears to be able to discriminate those who will develop AMI in new users of ACE inhibitors but it slightly over fit as the performance on the train set is higher than the test set. The ROC plot is presented in Figure <a href="PatientLevelPrediction.html#fig:shinyROC">14.48</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:shinySum"></span>
<img src="images/PatientLevelPrediction/shiny/singleShiny/singleShinySummary.png" alt="The starting summary page of the viewPlp() shiny app" width="80%" />
<p class="caption">
Figure 14.47: The starting summary page of the viewPlp() shiny app
</p>
</div>
<div class="figure" style="text-align: center"><span id="fig:shinyROC"></span>
<img src="images/PatientLevelPrediction/shiny/singleShiny/singleShinyRoc.png" alt="The ROC plot for predicting AMI within a year in new users of ACE inhibitors" width="80%" />
<p class="caption">
Figure 14.48: The ROC plot for predicting AMI within a year in new users of ACE inhibitors
</p>
</div>
<p>The calibration plot in Figure <a href="PatientLevelPrediction.html#fig:shinyCal">14.49</a> shows that generally the observed risk matches the predicted risk as the dots are around the diagonal line. The demographic calibration plot in Figure <a href="PatientLevelPrediction.html#fig:shinyDemo">14.50</a> however shows that the model is not well calibrated for the younger patients, as the blue line (the predicted risk) differs from the red line (the observed risk) for those aged below 40. This may indicate we need to remove the under 40s from the target population (as the observed risk for the younger patients is nearly zero).</p>
<div class="figure" style="text-align: center"><span id="fig:shinyCal"></span>
<img src="images/PatientLevelPrediction/shiny/singleShiny/singleShinyCal.png" alt="The calibration of the model" width="80%" />
<p class="caption">
Figure 14.49: The calibration of the model
</p>
</div>
<div class="figure" style="text-align: center"><span id="fig:shinyDemo"></span>
<img src="images/PatientLevelPrediction/shiny/singleShiny/singleShinyDemo.png" alt="The demographic calibration of the model" width="80%" />
<p class="caption">
Figure 14.50: The demographic calibration of the model
</p>
</div>
<p>Finally, the attrition plot shows the loss of patients from the labelled data based on inclusion/exclusion criteria, see Figure <a href="PatientLevelPrediction.html#fig:shinyAtt">14.51</a>. The plot shows that we lost a large portion of the target population due to them not being observed for the whole time at risk (1 year follow up). Interestingly, not as many patients with the outcome lacked the complete time at risk.</p>
<div class="figure" style="text-align: center"><span id="fig:shinyAtt"></span>
<img src="images/PatientLevelPrediction/shiny/singleShiny/singleShinyAtt.png" alt="The attrition plot for the prediction problem" width="80%" />
<p class="caption">
Figure 14.51: The attrition plot for the prediction problem
</p>
</div>
</div>
<div id="exploring-the-atlas-plp-shiny-app" class="section level2">
<h2><span class="header-section-number">14.10</span> Exploring the Atlas PLP Shiny App</h2>
<p>To view the atlas generated analysis results via an interactive shiny app, run:
<code>PatientLevelPrediction::viewMultiplePlp(outputFolder)</code> where <em>outputFolder</em> is the directory path containing the analysis results (e.g., ‘C:/atlasResults/Example’), it will look like:</p>
<div class="figure" style="text-align: center"><span id="fig:shinyResults"></span>
<img src="images/PatientLevelPrediction/shiny/shinyResults.png" alt="The directory where the atlas models and results were saved" width="80%" />
<p class="caption">
Figure 14.52: The directory where the atlas models and results were saved
</p>
</div>
<p>The interactive shiny app will start at the summary page:</p>
<div class="figure" style="text-align: center"><span id="fig:shinySummary"></span>
<img src="images/PatientLevelPrediction/shiny/shinySummary.png" alt="The shiny summary page containing key hold out set performance metrics for each model trained" width="80%" />
<p class="caption">
Figure 14.53: The shiny summary page containing key hold out set performance metrics for each model trained
</p>
</div>
<p>This summary page table contains:</p>
<ul>
<li>basic information about the model (e.g., database information, classifier type, time at risk settings, target population and outcome names)</li>
<li>hold out target population count and incidence of outcome</li>
<li>discrimination metrics: AUC, AUPRC</li>
</ul>
To the left of the table is the filter option:
<div class="figure" style="text-align: center"><span id="fig:shinyFilter"></span>
<img src="images/PatientLevelPrediction/shiny/shinyFilter.png" alt="Demonstration of the filter option" width="80%" />
<p class="caption">
Figure 14.54: Demonstration of the filter option
</p>
</div>
<p>Here a user can specify the development/valdiation databases to focus on, the type of model, the time at risk settings of interest and/or the cohorts of interest. For example, to pick the models corresponding to the target population “New users of ACE inhibitors as first line monotherapy for hypertension”, select this in the <em>Target Cohort</em> option.</p>
To explore a model click on the corresponding row, a selected row will be highlighted. To unselect simply click on the selected row again or select a new row.
<div class="figure" style="text-align: center"><span id="fig:shinySelect"></span>
<img src="images/PatientLevelPrediction/shiny/shinySelect.png" alt="The highlighted row shows a selected model.  We can then use other tab to explore the settings and results for the selected model" width="80%" />
<p class="caption">
Figure 14.55: The highlighted row shows a selected model. We can then use other tab to explore the settings and results for the selected model
</p>
</div>
With a row selected, you can now explore the model settings used when developing the model by clicking on the <em>Model Settings</em> tab:
<div class="figure" style="text-align: center"><span id="fig:shinyModel"></span>
<img src="images/PatientLevelPrediction/shiny/shinyModel.png" alt="To view the model settings used when developing the model." width="80%" />
<p class="caption">
Figure 14.56: To view the model settings used when developing the model.
</p>
</div>
To explore the population settings, click on the <em>Population Settings</em> tab to display the settings used when developing the model:
<div class="figure" style="text-align: center"><span id="fig:shinyPopSet"></span>
<img src="images/PatientLevelPrediction/shiny/shinyPopSet.png" alt="To view the model settings used when developing the model." width="80%" />
<p class="caption">
Figure 14.57: To view the model settings used when developing the model.
</p>
</div>
Simialrly, to explore the covariates settings, click on the <em>Covariate Settings</em> tab to display which covariates were used as candidate covariates in the model:
<div class="figure" style="text-align: center"><span id="fig:shinyCovSet"></span>
<img src="images/PatientLevelPrediction/shiny/shinyCovSet.png" alt="To view the covariate settings used when developing the model." width="80%" />
<p class="caption">
Figure 14.58: To view the covariate settings used when developing the model.
</p>
</div>
The row selection also works for displaying the model performance. To view the performance you need to select ‘Performance’ from the left menu:
<div class="figure" style="text-align: center"><span id="fig:shinyBar"></span>
<img src="images/PatientLevelPrediction/shiny/shinyBar.png" alt="The shiny option bar for navigating around the interface." width="80%" />
<p class="caption">
Figure 14.59: The shiny option bar for navigating around the interface.
</p>
</div>
<p>By clicking the ‘Performance’ option from the menu you will be taken to a threshold performance summary:</p>
<div class="figure" style="text-align: center"><span id="fig:shinyPerformanceSum"></span>
<img src="images/PatientLevelPrediction/shiny/shinyPerformanceSum.png" alt="The summary performance measures at a set threshold." width="80%" />
<p class="caption">
Figure 14.60: The summary performance measures at a set threshold.
</p>
</div>
<p>This summary view shows the selected prediction question in the standard format, a threshold selector and a dashboard containing key threshold based metrics such as positive predictive value (PPV), negative predictive value (NPV), sensitivity and specificity. See Section … for more details about these measurements. In Figure <a href="PatientLevelPrediction.html#fig:shinyPerformanceSum">14.60</a> we see the selected prediction model is: “within new users of ACE inhibitors as first line monotherapy for hypertension predict who will developed acute myocardial infarction during 1 day after cohort start and 365 days after cohort start”. At a threshold of 0.00482 the sensitivity is 83.4% (83.4% of patients with the acute MI in the following year have a risk greater than or equal to 0.00482) and the PPV is 1.2% (1.2% of patients with a risk greater than or equal to 0.00482 have an acute MI in the following year). As the incidence of the acute MI within the year is 0.741%, identifying patients with a risk greater than or equal to 0.00482 would find a subgroup of patients that have nearly double the risk of the population average risk.</p>
You can adjust the threshold by moving the dot in the <em>Input</em> box:
<div class="figure" style="text-align: center"><span id="fig:shinyPerformanceThres"></span>
<img src="images/PatientLevelPrediction/shiny/shinyPerformanceThres.png" alt="Moving this changes the threshold and the values in the Dashboard will update." width="80%" />
<p class="caption">
Figure 14.61: Moving this changes the threshold and the values in the Dashboard will update.
</p>
</div>
To look at the overal discrimination ability of the model click on the ‘Discrimination’ tab, this then takes you to a view with the ROC plot, PR plot, and distribution plots (the line on the plots corresponds to the selected threshold point):
<div class="figure" style="text-align: center"><span id="fig:shinyPerformanceDisc"></span>
<img src="images/PatientLevelPrediction/shiny/shinyPerformanceDisc.png" alt="The ROC and PR plots used to access the overal discrimination ability of the model." width="80%" />
<p class="caption">
Figure 14.62: The ROC and PR plots used to access the overal discrimination ability of the model.
</p>
</div>
<p>We see in Figure <a href="PatientLevelPrediction.html#fig:shinyPerformanceDisc">14.62</a> that the ROC plot shows the model was able to discriminate between those who will have the acute MI within the year and those who will not. However, the performance looks less impressive when we see the PR plot, as the low incidence of the acute MI means there is a high false positive rate.</p>
<div class="figure" style="text-align: center"><span id="fig:shinyPerformanceDist"></span>
<img src="images/PatientLevelPrediction/shiny/shinyPerformanceDist.png" alt="The predicted risk distribtion for those with and without the outcome.  The more these overlap the worse the discrimination" width="80%" />
<p class="caption">
Figure 14.63: The predicted risk distribtion for those with and without the outcome. The more these overlap the worse the discrimination
</p>
</div>
Finally, you can also inspect the calibration of the model by clicking on the ‘Calibration’ tab. This displays the calibration plot and the demographic calibration:
<div class="figure" style="text-align: center"><span id="fig:shinyPerformanceCal"></span>
<img src="images/PatientLevelPrediction/shiny/shinyPerformanceCal.png" alt="The risk stratified calibration and demographic calibration" width="80%" />
<p class="caption">
Figure 14.64: The risk stratified calibration and demographic calibration
</p>
</div>
<p>Figure <a href="PatientLevelPrediction.html#fig:shinyPerformanceCal">14.64</a> shows the average predicted risk appears to match the observed fraction who experienced the acute MI within a year, so the model is well calibrated. Interestingly, the demographic calibration shows that the blue line is higher than the red line for young patients, so we are predicting a higher risk for young age groups. Conversely, for the patients above 80 the model is predicting a lower risk than the observed risk. This may prompt us to develop seperate models for the younger or older patients.</p>
To inspect the final model, select the “Model” option from the left hand menu. This will open a view containing plots for each variable in the model and a table summarising all the candidate covariates. The variable plots are seperated into binary variables and continuous variables. The x-axis is the prevalance/mean in patients without the outcome and the y-axis is the prevalance/mean in patients with the outcome. Therefore, any variable’s dot falling above the diagonal is more common in patients with the outcome and any variable’s dot falling below the diagonal is less common in patients with the outcome:
<div class="figure" style="text-align: center"><span id="fig:shinyModelPlots"></span>
<img src="images/PatientLevelPrediction/shiny/shinyModelPlots.png" alt="Each dot corresponds to a varible included in the model." width="80%" />
<p class="caption">
Figure 14.65: Each dot corresponds to a varible included in the model.
</p>
</div>
The table below displays the Name, Value (coefficient if using a glm or variable importance otherwise) all the candidate covariates, Outcome mean (the mean value for those who have the outcome) and non-outcome mean (the mean value for those who do not have the outcome):
<div class="figure" style="text-align: center"><span id="fig:shinyModelTable"></span>
<img src="images/PatientLevelPrediction/shiny/shinyModelTable.png" alt="Each dot corresponds to a varible included in the model." width="80%" />
<p class="caption">
Figure 14.66: Each dot corresponds to a varible included in the model.
</p>
</div>
<p>You can click on the columns headers to order by the chosen column. For example, to order by Value, click on the ‘Value’ heading.</p>
The shiny interface also enables you to view the model development and evaluation log file. Click on ‘Log’ in the left hand option bar:
<div class="figure" style="text-align: center"><span id="fig:shinyLog"></span>
<img src="images/PatientLevelPrediction/shiny/shinyLog.png" alt="Example log display." width="80%" />
<p class="caption">
Figure 14.67: Example log display.
</p>
</div>
Finally, for instructions on accessing a youtube video demonstrating how to use the interactive shiny result viewer click on “Help” in the left hand option bar:
<div class="figure" style="text-align: center"><span id="fig:shinyHelp"></span>
<img src="images/PatientLevelPrediction/shiny/shinyHelp.png" alt="Instructions for viewing a demo video." width="80%" />
<p class="caption">
Figure 14.68: Instructions for viewing a demo video.
</p>
</div>

</div>
<div id="additional-patient-level-prediction-features" class="section level2">
<h2><span class="header-section-number">14.11</span> Additional Patient-level Prediction Features</h2>
<div id="journal-paper-generation" class="section level3">
<h3><span class="header-section-number">14.11.1</span> Journal paper generation</h3>
<p>We have added functionality to automatically generate a word document you can use as start of a journal paper. It contains many of the generated study details and results. If you have performed external validation these results will can be added as well. Optionally, you can add a “Table 1” that contains data on many covariates for the target population. You can create the draft journal paper by running this function:</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="PatientLevelPrediction.html#cb106-1"></a> <span class="kw">createPlpJournalDocument</span>(<span class="dt">plpResult =</span> <span class="op">&lt;</span>your plp results<span class="op">&gt;</span>,</span>
<span id="cb106-2"><a href="PatientLevelPrediction.html#cb106-2"></a>                          <span class="dt">plpValidation =</span> <span class="op">&lt;</span>your validation results<span class="op">&gt;</span>,</span>
<span id="cb106-3"><a href="PatientLevelPrediction.html#cb106-3"></a>                          <span class="dt">plpData =</span> <span class="op">&lt;</span>your plp data<span class="op">&gt;</span>,</span>
<span id="cb106-4"><a href="PatientLevelPrediction.html#cb106-4"></a>                          <span class="dt">targetName =</span> <span class="st">&quot;&lt;target population&gt;&quot;</span>,</span>
<span id="cb106-5"><a href="PatientLevelPrediction.html#cb106-5"></a>                          <span class="dt">outcomeName =</span> <span class="st">&quot;&lt;outcome&gt;&quot;</span>,</span>
<span id="cb106-6"><a href="PatientLevelPrediction.html#cb106-6"></a>                          <span class="dt">table1 =</span> F,</span>
<span id="cb106-7"><a href="PatientLevelPrediction.html#cb106-7"></a>                          <span class="dt">connectionDetails =</span> <span class="ot">NULL</span>,</span>
<span id="cb106-8"><a href="PatientLevelPrediction.html#cb106-8"></a>                          <span class="dt">includeTrain =</span> <span class="ot">FALSE</span>,</span>
<span id="cb106-9"><a href="PatientLevelPrediction.html#cb106-9"></a>                          <span class="dt">includeTest =</span> <span class="ot">TRUE</span>,</span>
<span id="cb106-10"><a href="PatientLevelPrediction.html#cb106-10"></a>                          <span class="dt">includePredictionPicture =</span> <span class="ot">TRUE</span>,</span>
<span id="cb106-11"><a href="PatientLevelPrediction.html#cb106-11"></a>                          <span class="dt">includeAttritionPlot =</span> <span class="ot">TRUE</span>,</span>
<span id="cb106-12"><a href="PatientLevelPrediction.html#cb106-12"></a>                          <span class="dt">outputLocation =</span> <span class="st">&quot;&lt;your location&gt;&quot;</span>)</span></code></pre></div>
<p>For more details see the help page of the function.</p>
</div>
</div>
<div id="excercises-1" class="section level2">
<h2><span class="header-section-number">14.12</span> Excercises</h2>

</div>
</div>



<h3>References</h3>
<div id="refs" class="references">
<div id="ref-byrd_2006">
<p>Byrd, J. B., A. Adam, and N. J. Brown. 2006. “Angiotensin-converting enzyme inhibitor-associated angioedema.” <em>Immunol Allergy Clin North Am</em> 26 (4): 725–37.</p>
</div>
<div id="ref-circardi_2004">
<p>Cicardi, M., L. C. Zingale, L. Bergamaschini, and A. Agostoni. 2004. “Angioedema associated with angiotensin-converting enzyme inhibitor use: outcome after switching to a different treatment.” <em>Arch. Intern. Med.</em> 164 (8): 910–13.</p>
</div>
<div id="ref-engel2015">
<p>Engel, C., and C. Fischer. 2015. “Breast cancer risks and risk prediction models.” <em>Breast Care (Basel)</em> 10 (1): 7–12.</p>
</div>
<div id="ref-lee1995">
<p>Lee, K. L., L. H. Woodlief, E. J. Topol, W. D. Weaver, A. Betriu, J. Col, M. Simoons, P. Aylward, F. Van de Werf, and R. M. Califf. 1995. “Predictors of 30-day mortality in the era of reperfusion for acute myocardial infarction. Results from an international trial of 41,021 patients. GUSTO-I Investigators.” <em>Circulation</em> 91 (6): 1659–68.</p>
</div>
<div id="ref-nguyen2008">
<p>Nguyen, N. D., S. A. Frost, J. R. Center, J. A. Eisman, and T. V. Nguyen. 2008. “Development of prognostic nomograms for individualizing 5-year and 10-year fracture risks.” <em>Osteoporos Int</em> 19 (10): 1431–44.</p>
</div>
<div id="ref-norman_2013">
<p>Norman, J. L., W. L. Holmes, W. A. Bell, and S. W. Finks. 2013. “Life-threatening ACE inhibitor-induced angioedema after eleven years on lisinopril.” <em>J Pharm Pract</em> 26 (4): 382–88.</p>
</div>
<div id="ref-mara_1996">
<p>O’Mara, N. B., and E. M. O’Mara. 1996. “Delayed onset of angioedema with angiotensin-converting enzyme inhibitors: case report and review of the literature.” <em>Pharmacotherapy</em> 16 (4): 675–79.</p>
</div>
<div id="ref-perel2006">
<p>Perel, P., P. Edwards, R. Wentz, and I. Roberts. 2006. “Systematic review of prognostic models in traumatic brain injury.” <em>BMC Med Inform Decis Mak</em> 6 (November): 38.</p>
</div>
<div id="ref-reps2018">
<p>Reps, J. M., M. J. Schuemie, M. A. Suchard, P. B. Ryan, and P. R. Rijnbeek. 2018. “Design and implementation of a standardized framework to generate and evaluate patient-level prediction models using observational healthcare data.” <em>Journal of the American Medical Informatics Association</em> 25 (8): 969–75. <a href="https://doi.org/10.1093/jamia/ocy032">https://doi.org/10.1093/jamia/ocy032</a>.</p>
</div>
<div id="ref-thompson_1993">
<p>Thompson, T., and M. A. Frable. 1993. “Drug-induced, life-threatening angioedema revisited.” <em>Laryngoscope</em> 103 (1 Pt 1): 10–12.</p>
</div>
<div id="ref-wilson1998">
<p>Wilson, P. W., R. B. D’Agostino, D. Levy, A. M. Belanger, H. Silbershatz, and W. B. Kannel. 1998. “Prediction of coronary heart disease using risk factor categories.” <em>Circulation</em> 97 (18): 1837–47.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="PopulationLevelEstimation.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="EvidenceQuality.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/OHDSI/TheBookOfOhdsi/edit/master/PatientLevelPrediction.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": ["TheBookOfOhdsi.pdf", "TheBookOfOhdsi.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
